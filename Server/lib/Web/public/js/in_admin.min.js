/*!
 * Rule the words! KKuTu Online
 * Copyright (C) 2017 JJoriping(op@jjo.kr)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */!function(){var t={y:50,t:50,g:100,l:200,m:600},e={};function n(e,n,a){return $("<input>").attr("id",e).css("width",t[n]).val(a)}function a(t,e,a,d,i){return n("word-"+[t,e,a,d].join("-"),d,i)}function d(t,e,n){var a=["wa",t,e,n].join("-")+"-";return $("<td>").append($("<button>").attr("id",a+"u").css("float","left").html("▲").on("click",i)).append($("<button>").attr("id",a+"x").css("float","left").html("X").on("click",i)).append($("<button>").attr("id",a+"e").css("float","left").html("?").on("click",i)).append($("<button>").attr("id",a+"d").css("float","left").html("▼").on("click",i))}function i(t){var e,n=$(t.currentTarget).attr("id").slice(3).split("-"),a=n.pop(),d=$("#wr-"+n.join("-"));switch(a){case"u":t.shiftKey&&(p(d,d.prev().attr("id").slice(3)),p(d.prev(),n.join("-"))),d.prev().before(d);break;case"x":d.remove();break;case"e":(e=prompt("새 key"))&&p(d,e);break;case"d":t.shiftKey&&(p(d,d.next().attr("id").slice(3)),p(d.next(),n.join("-"))),d.next().after(d)}}function p(t,e){var n=t.attr("id").slice(3);t.attr("id","wr-"+e).children("td").first().html(e),t.find("*").each((function(t,a){var d=$(a);d.attr("id")&&-1!=d.attr("id").indexOf(n)&&d.attr("id",d.attr("id").replace(n,e))}))}$(document).ready((function(){$("#db-ok").on("click",(function(t){"~"==$("#db-theme").val().charAt()?($("#db-list").val(""),$.get("/gwalli/kkututheme?theme="+$("#db-theme").val().slice(1)+"&lang="+$("#db-lang").val(),(function(t){$("#db-list").val(t.list.join("\n"))}))):$.post("/gwalli/kkutudb",{pw:$("#db-password").val(),lang:$("#db-lang").val(),theme:$("#db-theme").val(),list:$("#db-list").val()},(function(t){alert(t)}))})),$("#injeong-go").on("click",(function(t){$.get("/gwalli/injeong",(function(t){var e,a=$("#injeong-data").empty();t.list.forEach((function(t){a.append(e=$("<tr>").attr("id",["ir",t._id.replace(/ /g,"-")].join("-"))),e.append($("<td>").append(n("ij-"+t._id+"-check","y").attr("type","checkbox"))).append($("<td>").append($("<a>").attr({target:"_blank",href:"https://namu.moe/w/"+encodeURI(t._id)}).html("이동"))).append($("<td>").append(n("ij-"+t._id+"-_id","l",t._id))).append($("<td>").append(n("ij-"+t._id+"-theme","g",t.theme))).append($("<td>").append(n("ij-"+t._id+"-writer","g",t.writer))).append($("<td>").append(n("ij-"+t._id+"-createdAt","g",t.createdAt)))}))}))})),$("#injeong-everything").on("click",(function(t){$("#injeong-data input[type='checkbox']").prop("checked",!0)})),$("#injeong-nothing").on("click",(function(t){$("#injeong-data input[type='checkbox']").prop("checked",!1)})),$("#injeong-apply").on("click",(function(t){var e=[];$("#injeong-data tr:visible").each((function(t,n){var a=$(n).find("td>input");e.push({_origin:n.id.slice(3).replace(/-/g," "),_id:a.get(1).value,theme:a.get(2).value,ok:$(a.get(0)).is(":checked")})})),$.post("/gwalli/injeong",{list:JSON.stringify({list:e}),pw:$("#db-password").val()},(function(t){alert(t)}))})),$("#shop-go").on("click",(function(t){$.get("/gwalli/shop/"+$("#shop-word").val(),(function(t){var e,a,d=$("#shop-data").empty();t.goods.forEach((function(t){d.append(a=$("<tr>").attr("id",["gu",t._id].join("-"))),a.append($("<td>").append(n("si-"+t._id+"-_id","g",t._id))).append($("<td>").append(n("si-"+t._id+"-cost","y",t.cost))).append($("<td>").append(n("si-"+t._id+"-hit","y",t.hit))).append($("<td>").append(n("si-"+t._id+"-term","y",t.term))).append($("<td>").append(n("si-"+t._id+"-group","y",t.group))).append($("<td>").append(n("si-"+t._id+"-updatedAt","y",t.updatedAt))).append($("<td>").append(n("si-"+t._id+"-options","l",JSON.stringify(t.options||{})))).append($("<td>").append(n("si-"+t._id+"-name_ko_KR","l"))).append($("<td>").append(n("si-"+t._id+"-desc_ko_KR","l"))).append($("<td>").append(n("si-"+t._id+"-name_en_US","l"))).append($("<td>").append(n("si-"+t._id+"-desc_en_US","l")))})),t.desc.forEach((function(t){var n=t._id.replace("$","\\$");for(e in t)"_id"!=e&&$("#si-"+n+"-"+e).val(t[e])}))}))})),$("#shop-hide").on("click",(function(t){$("#shop-data tr:not(.gu-new)").toggle()})),$("#shop-add").on("click",(function(t){var e=prompt("식별자");e&&$("#shop-data").append($("<tr>").attr("id","gu-"+e).addClass("gu-new").append($("<td>").append(n("si-"+e+"-_id","g",e))).append($("<td>").append(n("si-"+e+"-cost","y"))).append($("<td>").append(n("si-"+e+"-hit","y"))).append($("<td>").append(n("si-"+e+"-term","y"))).append($("<td>").append(n("si-"+e+"-group","y"))).append($("<td>").append(n("si-"+e+"-updatedAt","y"))).append($("<td>").append(n("si-"+e+"-options","l","{}"))).append($("<td>").append(n("si-"+e+"-name_ko_KR","l"))).append($("<td>").append(n("si-"+e+"-desc_ko_KR","l"))).append($("<td>").append(n("si-"+e+"-name_en_US","l"))).append($("<td>").append(n("si-"+e+"-desc_en_US","l"))))})),$("#shop-apply").on("click",(function(t){var e=[];$("#shop-data tr:visible").each((function(t,n){var a=$(n).find("td>input");e.push({_id:a.get(0).value,core:{cost:a.get(1).value,hit:a.get(2).value||0,term:a.get(3).value||0,group:a.get(4).value,updatedAt:a.get(5).value||(new Date).getTime(),options:a.get(6).value},text:{name_ko_KR:a.get(7).value,desc_ko_KR:a.get(8).value,name_en_US:a.get(9).value,desc_en_US:a.get(10).value}})})),$.post("/gwalli/shop",{list:JSON.stringify({list:e}),pw:$("#db-password").val()},(function(t){alert(t)}))})),$("#user-go").on("click",(function(t){$.get("/gwalli/users?id="+$("#user-id").val()+"&name="+$("#user-nick").val(),(function(t){var e,a=$("#user-data").empty();t.list.forEach((function(t){a.append(e=$("<tr>").attr("id",["ur",t._id].join("-"))),e.append($("<td>").append(n("ud-"+t._id+"-_id","g",t._id))).append($("<td>").append(n("ud-"+t._id+"-money","g",t.money))).append($("<td>").append(n("ud-"+t._id+"-kkutu","l",JSON.stringify(t.kkutu||{})))).append($("<td>").append(n("ud-"+t._id+"-box","l",JSON.stringify(t.box||{})))).append($("<td>").append(n("ud-"+t._id+"-equip","l",JSON.stringify(t.equip||{})))).append($("<td>").append(n("ud-"+t._id+"-exordial","g",t.exordial))).append($("<td>").append(n("ud-"+t._id+"-server","t",t.server))).append($("<td>").append(n("ud-"+t._id+"-lastLogin","t",t.lastLogin))).append($("<td>").append(n("ud-"+t._id+"-black","g",t.black))).append($("<td>").append(n("ud-"+t._id+"-blockedUntil","g",t.blockedUntil))).append($("<td>").append(n("ud-"+t._id+"-friends","g",JSON.stringify(t.friends||{}))))}))}))})),$("#user-apply").on("click",(function(t){var e=[];$("#user-data tr:visible").each((function(t,n){var a=$(n).find("td>input");e.push({_id:a.get(0).value,money:a.get(1).value,kkutu:a.get(2).value,box:a.get(3).value,equip:a.get(4).value,exordial:a.get(5).value,server:a.get(6).value,lastLogin:a.get(7).value,black:a.get(8).value,blockedUntil:a.get(9).value,friends:a.get(10).value})})),$.post("/gwalli/users",{list:JSON.stringify({list:e}),pw:$("#db-password").val()},(function(t){alert(t)}))})),$("#gamsi-go").on("click",(function(t){clearInterval(e._gamsi);var n,a=$("#gamsi-data").empty(),d=$("#gamsi-id").val().split(/,\s*/),i=d.length;for(n in d)a.append($("<tr>").attr("id","gamsi-"+d[n]).html("<td>("+d[n]+") 감시 시작</td>")),p();function p(){var t=d[n],e=$("#gamsi-"+t);$.get("/gwalli/gamsi?id="+t,(function(n){if(!n)return e.html("(없는 사용자)"+t);e.html([n._id,n.title||"-","<a target='_blank' href='/?server="+n.server+"'>"+n.server+"</a>"].map((function(t){return"<td>"+t+"</td>"})))})),n=(n+1)%i}n=0,e._gamsi=setInterval(p,1e4)})),$("#db-go").on("click",(function(t){$.get("/gwalli/kkutudb/"+$("#db-word").val()+"?lang="+$("#db-lang").val(),(function(t){var e=$("#wd-data").empty(),n=t.type?t.type.split(","):[],i=t.theme?t.theme.split(","):[],p=t.mean?t.mean.split(/＂[0-9]+＂/).slice(1).map((function(t){return-1==t.indexOf("［")?[[t]]:t.split(/［[0-9]+］/).slice(1).map((function(t){return t.split(/（[0-9]+）/).slice(1)}))})):[[[]]];$("#wd-flag").val(t.flag),p.forEach((function(t,p){t.forEach((function(t,l){var o,r=n.shift();t.forEach((function(t,n){o=i.shift(),e.append($("<tr>").attr("id",["wr",p,l,n].join("-")).append($("<td>").html([p,l,n].join("-"))).append($("<td>").append(a(p,l,n,"y",r))).append($("<td>").append(a(p,l,n,"t",o))).append($("<td>").append(a(p,l,n,"m",t))).append(d(p,l,n)))}))}))}))}))})),$("#word-add").on("click",(function(t){var e=prompt("key (-로 구분)");e&&(e=e.split("-"),$("#wd-data").append($("<tr>").attr("id",["wr",e[0],e[1],e[2]].join("-")).append($("<td>").html([e[0],e[1],e[2]].join("-"))).append($("<td>").append(a(e[0],e[1],e[2],"y",""))).append($("<td>").append(a(e[0],e[1],e[2],"t",""))).append($("<td>").append(a(e[0],e[1],e[2],"m",""))).append(d(e[0],e[1],e[2]))))})),$("#db-apply").on("click",(function(t){var e={_id:$("#db-word").val(),flag:$("#wd-flag").val(),type:[],theme:[],mean:[]},n=!1;$("#wd-data tr").each((function(t,a){var d=$(a).children("td").first().html().split("-"),i=d[0]+"-"+d[1],p={type:$("#word-"+[d[0],d[1],d[2],"y"].join("-")).val(),theme:$("#word-"+[d[0],d[1],d[2],"t"].join("-")).val(),mean:$("#word-"+[d[0],d[1],d[2],"m"].join("-")).val()};n!=i&&(e.type.push(p.type),n=i),e.theme.push(p.theme),e.mean[d[0]]||(e.mean[d[0]]=[]),e.mean[d[0]][d[1]]||(e.mean[d[0]][d[1]]=[]),e.mean[d[0]][d[1]][d[2]]=p.mean})),e.type=e.type.join(","),e.theme=e.theme.join(","),e.mean=e.mean.map((function(t,e){return"ko"==$("#db-lang").val()?"＂"+(e+1)+"＂"+t.map((function(t,e){return"［"+(e+1)+"］"+t.map((function(t,e){return"（"+(e+1)+"）"+t})).join("")})).join(""):"＂"+(e+1)+"＂"+t})).join(""),$.post("/gwalli/kkutudb/"+$("#db-word").val(),{pw:$("#db-password").val(),lang:$("#db-lang").val(),data:JSON.stringify(e)},(function(t){alert(t)}))})),$("#kpw-query").on("click",(function(t){var e=["한국어 종합","한국어 최근","한국어 3글자","한국어 어인정","영어 종합"];$.get("/gwalli/kkutuhot",(function(t){var n,a=$("#kpw-table").empty();t.data.splice(1,0,(n=t.prev,t.data[0].slice(0).sort((function(t,e){return e.hit-(n[e._id]||0)-t.hit+(n[t._id]||0)})))),e.forEach((function(e,n){a.append($("<div>").append($("<h3>").html(e)).append(function(t,e){var n,a=$("<table>"),d=0;return e.forEach((function(e,i){if(!(i>=30)){var p=t[e._id]||0,l=e.hit==n?d:i;p=e.hit-p,e.delta=p?"(+"+p+")":"-",a.append($("<tr>").append($("<td style='width: 20px; text-align: center; background-color: #EEEEEE;'>").html(l+1)).append($("<td style='width: 200px;'>").html(e._id)).append($("<td style='width: 40px;'>").html(e.hit)).append($("<td style='width: 40px;'>").html(e.delta))),d=l,n=e.hit}})),a}(t.prev,t.data[n])))})),$("#kpw-html").html(a.html())}))})),$("#kpw-flush").on("click",(function(t){$.post("/gwalli/kkutuhot",{pw:$("#db-password").val()},(function(t){alert(t)}))}))}))}();