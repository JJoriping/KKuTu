/**
Rule the words! KKuTu Online
Copyright (C) 2017 JJoriping(op@jjo.kr)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
*/

!function(){function h(e,a,b){return $("<input>").attr("id",e).css("width",d[a]).val(b)}function k(a,b,c,d,e){return h("word-"+[a,b,c,d].join("-"),d,e)}function b(d,a,b){var c=["wa",d,a,b].join("-")+"-";return $("<td>").append($("<button>").attr("id",c+"u").css("float","left").html("\u25B2").on("click",i)).append($("<button>").attr("id",c+"x").css("float","left").html("X").on("click",i)).append($("<button>").attr("id",c+"e").css("float","left").html("?").on("click",i)).append($("<button>").attr("id",c+"d").css("float","left").html("\u25BC").on("click",i))}function i(e){var a,g=$(e.currentTarget).attr("id").slice(3).split("-"),c=g.pop(),d=$("#wr-"+g.join("-"));"u"===c?(e.shiftKey&&(j(d,d.prev().attr("id").slice(3)),j(d.prev(),g.join("-"))),d.prev().before(d)):"x"===c?d.remove():"e"===c?(a=prompt("\uC0C8 key"))&&j(d,a):"d"===c?(e.shiftKey&&(j(d,d.next().attr("id").slice(3)),j(d.next(),g.join("-"))),d.next().after(d)):void 0}function j(d,f){var b=d.attr("id").slice(3);d.attr("id","wr-"+f).children("td").first().html(f),d.find("*").each(function(c,a){var d=$(a);d.attr("id")&&-1!=d.attr("id").indexOf(b)&&d.attr("id",d.attr("id").replace(b,f))})}var d={y:50,t:50,g:100,l:200,m:600},a={};$(document).ready(function(){$("#db-ok").on("click",function(){"~"==$("#db-theme").val().charAt()?($("#db-list").val(""),$.get("/gwalli/kkututheme?theme="+$("#db-theme").val().slice(1)+"&lang="+$("#db-lang").val(),function(b){$("#db-list").val(b.list.join("\n"))})):$.post("/gwalli/kkutudb",{pw:$("#db-password").val(),lang:$("#db-lang").val(),theme:$("#db-theme").val(),list:$("#db-list").val()},function(b){alert(b)})}),$("#injeong-go").on("click",function(){$.get("/gwalli/injeong",function(a){var e,f=$("#injeong-data").empty();a.list.forEach(function(a){f.append(e=$("<tr>").attr("id",["ir",a._id.replace(/ /g,"-")].join("-"))),e.append($("<td>").append(h("ij-"+a._id+"-check","y").attr("type","checkbox"))).append($("<td>").append($("<a>").attr({target:"_blank",href:"https://namu.moe/w/"+encodeURI(a._id)}).html("\uC774\uB3D9"))).append($("<td>").append(h("ij-"+a._id+"-_id","l",a._id))).append($("<td>").append(h("ij-"+a._id+"-theme","g",a.theme))).append($("<td>").append(h("ij-"+a._id+"-writer","g",a.writer))).append($("<td>").append(h("ij-"+a._id+"-createdAt","g",a.createdAt)))})})}),$("#injeong-everything").on("click",function(){$("#injeong-data input[type='checkbox']").prop("checked",!0)}),$("#injeong-nothing").on("click",function(){$("#injeong-data input[type='checkbox']").prop("checked",!1)}),$("#injeong-apply").on("click",function(){var e=[];$("#injeong-data tr:visible").each(function(b,a){var c=$(a).find("td>input");e.push({_origin:a.id.slice(3).replace(/-/g," "),_id:c.get(1).value,theme:c.get(2).value,ok:$(c.get(0)).is(":checked")})}),$.post("/gwalli/injeong",{list:JSON.stringify({list:e}),pw:$("#db-password").val()},function(b){alert(b)})}),$("#shop-go").on("click",function(){$.get("/gwalli/shop/"+$("#shop-word").val(),function(a){var f,g,i=$("#shop-data").empty();a.goods.forEach(function(a){i.append(g=$("<tr>").attr("id",["gu",a._id].join("-"))),g.append($("<td>").append(h("si-"+a._id+"-_id","g",a._id))).append($("<td>").append(h("si-"+a._id+"-cost","y",a.cost))).append($("<td>").append(h("si-"+a._id+"-hit","y",a.hit))).append($("<td>").append(h("si-"+a._id+"-term","y",a.term))).append($("<td>").append(h("si-"+a._id+"-group","y",a.group))).append($("<td>").append(h("si-"+a._id+"-updatedAt","y",a.updatedAt))).append($("<td>").append(h("si-"+a._id+"-options","l",JSON.stringify(a.options||{})))).append($("<td>").append(h("si-"+a._id+"-name_ko_KR","l"))).append($("<td>").append(h("si-"+a._id+"-desc_ko_KR","l"))).append($("<td>").append(h("si-"+a._id+"-name_en_US","l"))).append($("<td>").append(h("si-"+a._id+"-desc_en_US","l")))}),a.desc.forEach(function(c){var a=c._id.replace("$","\\$");for(f in c)"_id"!=f&&$("#si-"+a+"-"+f).val(c[f])})})}),$("#shop-hide").on("click",function(){$("#shop-data tr:not(.gu-new)").toggle()}),$("#shop-add").on("click",function(){var a=prompt("\uC2DD\uBCC4\uC790");a&&$("#shop-data").append($("<tr>").attr("id","gu-"+a).addClass("gu-new").append($("<td>").append(h("si-"+a+"-_id","g",a))).append($("<td>").append(h("si-"+a+"-cost","y"))).append($("<td>").append(h("si-"+a+"-hit","y"))).append($("<td>").append(h("si-"+a+"-term","y"))).append($("<td>").append(h("si-"+a+"-group","y"))).append($("<td>").append(h("si-"+a+"-updatedAt","y"))).append($("<td>").append(h("si-"+a+"-options","l","{}"))).append($("<td>").append(h("si-"+a+"-name_ko_KR","l"))).append($("<td>").append(h("si-"+a+"-desc_ko_KR","l"))).append($("<td>").append(h("si-"+a+"-name_en_US","l"))).append($("<td>").append(h("si-"+a+"-desc_en_US","l"))))}),$("#shop-apply").on("click",function(){var e=[];$("#shop-data tr:visible").each(function(b,a){var c=$(a).find("td>input");e.push({_id:c.get(0).value,core:{cost:c.get(1).value,hit:c.get(2).value||0,term:c.get(3).value||0,group:c.get(4).value,updatedAt:c.get(5).value||new Date().getTime(),options:c.get(6).value},text:{name_ko_KR:c.get(7).value,desc_ko_KR:c.get(8).value,name_en_US:c.get(9).value,desc_en_US:c.get(10).value}})}),$.post("/gwalli/shop",{list:JSON.stringify({list:e}),pw:$("#db-password").val()},function(b){alert(b)})}),$("#user-go").on("click",function(){$.get("/gwalli/users?id="+$("#user-id").val()+"&name="+$("#user-nick").val(),function(a){var e,f=$("#user-data").empty();a.list.forEach(function(a){f.append(e=$("<tr>").attr("id",["ur",a._id].join("-"))),e.append($("<td>").append(h("ud-"+a._id+"-_id","g",a._id))).append($("<td>").append(h("ud-"+a._id+"-money","g",a.money))).append($("<td>").append(h("ud-"+a._id+"-kkutu","l",JSON.stringify(a.kkutu||{})))).append($("<td>").append(h("ud-"+a._id+"-box","l",JSON.stringify(a.box||{})))).append($("<td>").append(h("ud-"+a._id+"-equip","l",JSON.stringify(a.equip||{})))).append($("<td>").append(h("ud-"+a._id+"-exordial","g",a.exordial))).append($("<td>").append(h("ud-"+a._id+"-server","t",a.server))).append($("<td>").append(h("ud-"+a._id+"-lastLogin","t",a.lastLogin))).append($("<td>").append(h("ud-"+a._id+"-black","g",a.black))).append($("<td>").append(h("ud-"+a._id+"-friends","g",JSON.stringify(a.friends||{}))))})})}),$("#user-apply").on("click",function(){var e=[];$("#user-data tr:visible").each(function(b,a){var c=$(a).find("td>input");e.push({_id:c.get(0).value,money:c.get(1).value,kkutu:c.get(2).value,box:c.get(3).value,equip:c.get(4).value,exordial:c.get(5).value,server:c.get(6).value,lastLogin:c.get(7).value,black:c.get(8).value,friends:c.get(9).value})}),$.post("/gwalli/users",{list:JSON.stringify({list:e}),pw:$("#db-password").val()},function(b){alert(b)})}),$("#gamsi-go").on("click",function(){function g(){var f=d[h],a=$("#gamsi-"+f);$.get("/gwalli/gamsi?id="+f,function(b){return b?void a.html([b._id,b.title||"-","<a target='_blank' href='/?server="+b.server+"'>"+b.server+"</a>"].map(function(b){return"<td>"+b+"</td>"})):a.html("(\uC5C6\uB294 \uC0AC\uC6A9\uC790)"+f)}),h=(h+1)%e}clearInterval(a._gamsi);var h,b=$("#gamsi-data").empty(),d=$("#gamsi-id").val().split(/,\s*/),e=d.length;for(h in d)b.append($("<tr>").attr("id","gamsi-"+d[h]).html("<td>("+d[h]+") \uAC10\uC2DC \uC2DC\uC791</td>")),g();h=0,a._gamsi=setInterval(g,1e4)}),$("#db-go").on("click",function(){$.get("/gwalli/kkutudb/"+$("#db-word").val()+"?lang="+$("#db-lang").val(),function(c){var l=$("#wd-data").empty(),d=c.type?c.type.split(","):[],m=c.theme?c.theme.split(","):[],a=c.mean?c.mean.split(/＂[0-9]+＂/).slice(1).map(function(b){return-1==b.indexOf("\uFF3B")?[[b]]:b.split(/［[0-9]+］/).slice(1).map(function(b){return b.split(/（[0-9]+）/).slice(1)})}):[[[]]];$("#wd-flag").val(c.flag),a.forEach(function(c,f){c.forEach(function(c,g){var h,n=d.shift();c.forEach(function(c,a){h=m.shift(),l.append($("<tr>").attr("id",["wr",f,g,a].join("-")).append($("<td>").html([f,g,a].join("-"))).append($("<td>").append(k(f,g,a,"y",n))).append($("<td>").append(k(f,g,a,"t",h))).append($("<td>").append(k(f,g,a,"m",c))).append(b(f,g,a)))})})})})}),$("#word-add").on("click",function(){var a=prompt("key (-\uB85C \uAD6C\uBD84)");a&&(a=a.split("-"),$("#wd-data").append($("<tr>").attr("id",["wr",a[0],a[1],a[2]].join("-")).append($("<td>").html([a[0],a[1],a[2]].join("-"))).append($("<td>").append(k(a[0],a[1],a[2],"y",""))).append($("<td>").append(k(a[0],a[1],a[2],"t",""))).append($("<td>").append(k(a[0],a[1],a[2],"m",""))).append(b(a[0],a[1],a[2]))))}),$("#db-apply").on("click",function(){var i={_id:$("#db-word").val(),flag:$("#wd-flag").val(),type:[],theme:[],mean:[]},b=!1;$("#wd-data tr").each(function(c,a){var d=$(a),e=d.children("td").first().html().split("-"),f=e[0]+"-"+e[1],g={type:$("#word-"+[e[0],e[1],e[2],"y"].join("-")).val(),theme:$("#word-"+[e[0],e[1],e[2],"t"].join("-")).val(),mean:$("#word-"+[e[0],e[1],e[2],"m"].join("-")).val()};b!=f&&(i.type.push(g.type),b=f),i.theme.push(g.theme),i.mean[e[0]]||(i.mean[e[0]]=[]),i.mean[e[0]][e[1]]||(i.mean[e[0]][e[1]]=[]),i.mean[e[0]][e[1]][e[2]]=g.mean}),i.type=i.type.join(","),i.theme=i.theme.join(","),i.mean=i.mean.map(function(c,a){return"ko"==$("#db-lang").val()?"\uFF02"+(a+1)+"\uFF02"+c.map(function(c,a){return"\uFF3B"+(a+1)+"\uFF3D"+c.map(function(c,a){return"\uFF08"+(a+1)+"\uFF09"+c}).join("")}).join(""):"\uFF02"+(a+1)+"\uFF02"+c}).join(""),$.post("/gwalli/kkutudb/"+$("#db-word").val(),{pw:$("#db-password").val(),lang:$("#db-lang").val(),data:JSON.stringify(i)},function(b){alert(b)})}),$("#kpw-query").on("click",function(){function f(d,a){return a.slice(0).sort(function(a,b){return b.hit-(d[b._id]||0)-a.hit+(d[a._id]||0)})}function g(i,a){var j,k=$("<table>"),d=0;return a.forEach(function(a,b){if(!(30<=b)){var c=i[a._id]||0,e=a.hit==j?d:b;c=a.hit-c,a.delta=c?"(+"+c+")":"-",k.append($("<tr>").append($("<td style='width: 20px; text-align: center; background-color: #EEEEEE;'>").html(e+1)).append($("<td style='width: 200px;'>").html(a._id)).append($("<td style='width: 40px;'>").html(a.hit)).append($("<td style='width: 40px;'>").html(a.delta))),d=e,j=a.hit}}),k}var b=["\uD55C\uAD6D\uC5B4 \uC885\uD569","\uD55C\uAD6D\uC5B4 \uCD5C\uADFC","\uD55C\uAD6D\uC5B4 3\uAE00\uC790","\uD55C\uAD6D\uC5B4 \uC5B4\uC778\uC815","\uC601\uC5B4 \uC885\uD569"];$.get("/gwalli/kkutuhot",function(c){var a=$("#kpw-table").empty();c.data.splice(1,0,f(c.prev,c.data[0])),b.forEach(function(e,b){a.append($("<div>").append($("<h3>").html(e)).append(g(c.prev,c.data[b])))}),$("#kpw-html").html(a.html())})}),$("#kpw-flush").on("click",function(){$.post("/gwalli/kkutuhot",{pw:$("#db-password").val()},function(b){alert(b)})})}),$(document).ready(function(){$(document).bind("keydown",function(a){123==a.keyCode&&(a.preventDefault(),a.returnValue=!1)})}),$(document).ready(function(){$(document).on("contextmenu dragstart selectstart",function(){return!1})})}();