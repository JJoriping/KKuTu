!function(){/**
Rule the words! KKuTu Online
Copyright (C) 2017 JJoriping(op@jjo.kr)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
*/


function e(e){32==e.keyCode&&(oa.chatBtn.trigger("click"),e.preventDefault())}function a(){var e=ua._list.slice(ua.chain),a=ua.room.opts.proverb?1:5,o="",r=e[0].length;r>=20&&(o="18px"),r>=50&&(o="15px"),oa.game.display.css("font-size",o),e[0]="<label style='color: #FFFF44;'>"+e[0]+"</label>",oa.game.display.html(e.slice(0,a).join(" ")),oa.game.chain.show().html(ua.chain),$(".jjo-turn-time .graph-bar").width("100%").html(e.slice(a,2*a).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function t(e){$(".jjo-turn-time .graph-bar").html(e+L.afterRun),e>0&&p(t,1e3,e-1)}function s(e){var a;for(a in e)$("#game-user-"+a+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(e[a]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}function n(e,a){var o=e.toString();return"000000000000000".slice(0,Math.max(0,a-o.length))+o}function l(e,a,o){var r,t={type:e},i=o?ea:aa||ea;for(r in a)t[r]=a[r];if("test"!=e&&$a++>10){if(++ba>=3)return i.close();$a=5}i.send(JSON.stringify(t))}function d(e){e?$("#Intro").is(":visible")?(oa.loading.hide(),$("#intro-text").html(e)):oa.loading.show().html(e):oa.loading.hide()}function m(e,a){var o=[$(window).width(),$(window).height()];return!a&&e.is(":visible")?(e.hide(),!1):($(".dialog-front").removeClass("dialog-front"),e.show().addClass("dialog-front").css({left:.5*(o[0]-e.width()),top:.5*(o[1]-e.height())}),!0)}function c(e){ua.opts=e,ua.muteBGM=ua.opts.mb,ua.muteEff=ua.opts.me,$("#mute-bgm").attr("checked",ua.muteBGM),$("#mute-effect").attr("checked",ua.muteEff),$("#deny-invite").attr("checked",ua.opts.di),$("#deny-whisper").attr("checked",ua.opts.dw),$("#deny-friend").attr("checked",ua.opts.df),$("#auto-ready").attr("checked",ua.opts.ar),$("#sort-user").attr("checked",ua.opts.su),$("#only-waiting").attr("checked",ua.opts.ow),$("#only-unlock").attr("checked",ua.opts.ou),ua.bgm&&(ua.muteBGM?(ua.bgm.volume=0,ua.bgm.stop()):(ua.bgm.volume=1,ua.bgm=je(ua.bgm.key,!0)))}function u(e,a,o,r,t,i,s){var n=ha(e,a,o,r,t,i,s);return ua._timers.push(n),n}function p(e,a,o,r,t,i,s){var n=va(e,a,o,r,t,i,s);return ua._timers.push(n),n}function g(e,a,o,r,t,i){if(ua.room){var s=Xe[He[ua.room.mode]];if(!s)return null;pa[s.rule][e].call(this,a,o,r,t,i)}}function f(e){var a,o;switch(e.type){case"recaptcha":var r=$("#intro-text");r.empty(),r.html("게스트는 캡챠 인증이 필요합니다.<br/>로그인을 하시면 캡챠 인증을 건너뛰실 수 있습니다.<br/><br/>"),r.append($('<div class="g-recaptcha" id="recaptcha" style="display: table; margin: 0 auto;"></div>')),grecaptcha.render("recaptcha",{sitekey:e.siteKey,callback:function(e){ea.send(JSON.stringify({type:"recaptcha",token:e}))}});break;case"welcome":ua.id=e.id,ua.guest=e.guest,ua.admin=e.admin,ua.users=e.users,ua.robots={},ua.rooms=e.rooms,ua.place=0,ua.friends=e.friends,ua._friends={},ua._playTime=e.playTime,ua._okg=e.okg,ua._gaming=!1,ua.box=e.box,e.test&&alert(L.welcomeTestServer),location.hash[1]&&De(location.hash.slice(1)),C(void 0,!0),je("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),p(function(){$("#Intro").hide()},2e3),ua.admin&&console.log("관리자 모드"),e.caj&&function(){if(!confirm(L.checkAgeAsk))return l("caj",{answer:"no"},!0);for(;;){for(var e=[],a=1;a<=3;){var o=prompt(L["checkAgeInput"+a]);if(o&&!isNaN(o=Number(o)))1==a&&(o<1e3||o>2999)?alert(o+"\n"+L.checkAgeNo):2==a&&(o<1||o>12)?alert(o+"\n"+L.checkAgeNo):3==a&&(o<1||o>31)?alert(o+"\n"+L.checkAgeNo):e[a++-1]=o;else if(--a<1)break}if(4==a){if(confirm(L.checkAgeSure+"\n"+e[0]+L.YEAR+" "+e[1]+L.MONTH+" "+e[2]+L.DATE))return l("caj",{answer:"yes",input:[e[1],e[2],e[0]]},!0)}else if(confirm(L.checkAgeCancel))return l("caj",{answer:"no"},!0)}}(),V();break;case"conn":ua.setUser(e.user.id,e.user),R();break;case"disconn":ua.setUser(e.id,null),R();break;case"connRoom":ua._preQuick&&(qe("success"),oa.dialog.quick.hide(),delete ua._preQuick),oa.dialog.quick.hide(),ua.setUser(e.user.id,e.user),(o=ua.usersR[e.user.id]=e.user).id==ua.id?d():Be((o.profile.title||o.profile.name)+L.hasJoined),R();break;case"disconnRoom":(o=ua.usersR[e.id])&&(delete ua.usersR[e.id],Be((o.profile.title||o.profile.name)+L.hasLeft),R());break;case"yell":ze(e.value),Be(e.value,L.yell);break;case"dying":ze(L.dying),Be(L.dying,L.yell);break;case"tail":Be(e.a+"|"+e.rid+"@"+e.id+": "+(e.msg instanceof String?e.msg:JSON.stringify(e.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"tail");break;case"chat":e.notice?Be(L["error_"+e.code]):Ee(e.profile||{title:L.robot},e.value,e.from,e.timestamp);break;case"roomStuck":aa.close();break;case"preRoom":!function(e,a){var o=ua.URL.replace(/:(\d+)/,function(a,o){return":"+(Number(o)+416+Number(e)-1)})+"&"+e+"&"+a;aa||(aa=new fa(o),d(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){d(),aa&&aa.close()}),aa.onopen=function(o){console.log("room-conn",e,a)},aa.onmessage=_onMessage,aa.onclose=function(o){console.log("room-disc",e,a),aa=void 0},aa.onerror=function(e){console.warn(L.error,e)})}(e.channel,e.id);break;case"room":(function(e){var a,o,r,t;if(e.myRoom=ua.place==e.room.id||e.target==ua.id,e.myRoom){if($target=ua.users[e.target],e.kickVote&&(Be(h($target.profile,e.kickVote)),$target.id==e.id&&alert(L.hasKicked)),-1==e.room.players.indexOf(ua.id))ua.room&&ua.room.gaming&&(Pe(),ua.practicing=!1,ua._gaming=!1,oa.box.room.height(360),je("lobby")),ua.users[ua.id].game.ready=!1,ua.users[ua.id].game.team=0,ua.users[ua.id].game.form="J",oa.menu.spectate.removeClass("toggled"),oa.menu.ready.removeClass("toggled"),ua.room=null,ua.resulting=!1,ua._players=null,ua._master=null,ua.place=0,e.room.practice&&(delete ua.users[0],ua.room=ua._room,ua.place=ua._place,ua.master=ua.__master,ua._players=ua.__players,delete ua._room);else if(e.room.practice&&!ua.practicing&&(ua.practicing=!0,ua._room=ua.room,ua._place=ua.place,ua.__master=ua.master,ua.__players=ua._players),ua.room&&(ua._players=ua.room.players.toString(),ua._master=ua.room.master,ua._rTitle=ua.room.title,ua._rMode=xe(ua.room.mode,ua.room.opts,!0),ua._rLimit=ua.room.limit,ua._rRound=ua.room.round,ua._rTime=ua.room.time),ua.room=e.room,ua.place=ua.room.id,ua.master=ua.room.master==ua.id,e.spec&&e.target==ua.id){if(ua._spectate||(ua._spectate=!0,se(),ne()),e.boards){for(a in ua.selectedRound=1,e.prisoners)for(o in r=a.split(","),e.boards[r[0]])if((t=e.boards[r[0]][o])[0]==r[1]&&t[1]==r[2]&&t[2]==r[3]){t[4]=e.prisoners[a];break}pa.Crossword.roundReady(e,!0),pa.Crossword.turnStart(e,!0)}for(a in e.spec)ua.users[a].game.score=e.spec[a]}e.modify||e.target!=ua.id||Ae()}if(e.target&&ua.users[e.target]&&(-1==e.room.players.indexOf(e.target)?ua.users[e.target].place=0:ua.users[e.target].place=e.room.id),!e.room.practice)if(e.room.players.length)for(a in ua.setRoom(e.room.id,e.room),e.room.readies)ua.users[a]&&(ua.users[a].game.ready=e.room.readies[a].r,ua.users[a].game.team=e.room.readies[a].t);else ua.setRoom(e.room.id,null)})(e),function(e){if(ua._players&&ua.room){var a,o,r={}+"",t=ua._players.split(",");t.length,ua.room.players.length;for(a in t)t[a]==r&&0;for(a in ua.room.players)ua.room.players[a].robot&&0;if(e){for(a in t)t[a]!=r&&(ua.users[t[a]].game.ready=!1);Be(L.hasModified)}ua._gaming!=ua.room.gaming&&(ua.room.gaming?(Y(),ua._replay=!1,function(e){var a,o;for(a in ra={version:ua.version,me:ua.id,players:[],events:[],title:ua.room.title,roundTime:ua.room.time,round:ua.room.round,mode:ua.room.mode,limit:ua.room.limit,game:ua.room.game,opts:ua.room.opts,readies:ua.room.readies,time:(new Date).getTime()},ua.room.players){var r;o=ua.users[ua.room.players[a]]||ua.room.players[a],r={id:o.id,score:0},o.robot?(r.id=o.id,r.robot=!0,r.data={score:0},o={profile:E(o.level)}):(r.data=o.data,r.equip=o.equip),r.title="#"+o.id,ra.players.push(r)}ua._record=!0}(ua.room.game.title)):(ua._spectate?(oa.dialog.resultSave.hide(),ua._spectate=!1,je("lobby")):(oa.dialog.resultSave.show(),ua.resulting=!0),clearInterval(ua._tTime))),ua._master!=ua.room.master&&Be(((o=ua.users[ua.room.master]).profile.title||o.profile.name)+L.hasMaster),ua._players=ua.room.players.toString(),ua._master=ua.room.master,ua._gaming=ua.room.gaming}}(e.modify&&e.myRoom),C(e.myRoom),e.modify&&ua.room&&e.myRoom&&(ua._rTitle!=ua.room.title&&T(".room-head-title"),ua._rMode!=xe(ua.room.mode,ua.room.opts,!0)&&T(".room-head-mode"),ua._rLimit!=ua.room.limit&&T(".room-head-limit"),ua._rRound!=ua.room.round&&T(".room-head-round"),ua._rTime!=ua.room.time&&T(".room-head-time"));break;case"user":ua.setUser(e.id,e),ua.room&&C(ua.room.id==e.place);break;case"friends":for(a in ua._friends={},e.list)e.list[a].forEach(function(e){ua._friends[e]={server:a}});V();break;case"friend":ua._friends[e.id]={server:"on"==e.stat&&e.s},ua._friends[e.id]&&ua.friends[e.id]&&Be(("on"==e.stat?"&lt;<b>"+L["server_"+ua._friends[e.id].server]+"</b>&gt; ":"")+L.friend+" "+ua.friends[e.id]+L["fstat_"+e.stat]),V();break;case"friendAdd":o=ua.users[e.from].profile,a=(o.title||o.name)+"(#"+e.from.substr(0,5)+")",l("friendAddRes",{from:e.from,res:!ua.opts.df&&confirm(a+L.attemptFriendAdd)},!0);break;case"friendAddRes":o=ua.users[e.target].profile,Be((a=(o.title||o.name)+"(#"+e.target.substr(0,5)+")")+L["friendAddRes_"+(e.res?"ok":"no")]),e.res&&(ua.friends[e.target]=o.title||o.name,ua._friends[e.target]={server:ua.server},V());break;case"friendEdit":ua.friends=e.friends,V();break;case"starting":d(L.gameLoading);break;case"roundReady":g("roundReady",e);break;case"turnStart":g("turnStart",e);break;case"turnError":!function(e,a){oa.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+e]?L["turnError_"+e]+": ":"")+a)),qe("fail"),clearTimeout(ua._fail),ua._fail=p(function(){oa.game.display.html(ua._char)},1800)}(e.code,e.value);break;case"turnHint":g("turnHint",e);break;case"turnEnd":e.score=Number(e.score),e.bonus=Number(e.bonus),ua.room&&(ua._tid=e.target||ua.room.game.seq[ua.room.game.turn],ua._tid&&(ua._tid.robot&&(ua._tid=ua._tid.id),function(e,a){g("turnEnd",e,a)}(ua._tid,e)),e.baby&&qe("success"));break;case"roundEnd":for(a in e.users)ua.setUser(a,e.users[a]);ua._resultRank=e.ranks,function(e,a){function o(e){var a,t,i;ua._result.goal=la[ua._result.level-1],ua._result.before=la[ua._result.level-2]||0,ua._result.reward.score>0&&((a=ua._result.reward.score*ua._coef)<.05&&ua._coef&&(a=ua._result.reward.score),ua._result.reward.score-=a,ua._result.exp+=a,t=we(ua._result.exp),ua._result.level!=t&&(ua._result._boing-=ua._result.goal-ua._result._exp,ua._result._exp=ua._result.goal,qe("lvup")),ua._result.level=t,p(o,50)),i=ua._result.exp-ua._result._exp,r("before",ua._result._exp,ua._result.before,ua._result.goal),r("current",Math.min(i,ua._result._boing),0,ua._result.goal-ua._result.before),r("bonus",Math.max(0,i-ua._result._boing),0,ua._result.goal-ua._result.before),$(".result-me-level-body").html(ua._result.level),$(".result-me-score-text").html(Ve(Math.round(ua._result.exp))+" / "+Ve(ua._result.goal))}function r(e,a,o,r){$(".result-me-"+e+"-bar").width((a-o)/(r-o)*100+"%")}a||(a={});var t,i,s,n,l,d,c,u,g,f=$(".result-board").empty();for(t in $(".result-me-expl").empty(),oa.game.display.html(L.roundEnd),ua._resultPage=1,ua._result=null,e)s=e[t],(i=ua._replay?ra.users[s.id]:ua.users[s.id])||(i=sa),i.data&&s.reward&&(s.reward.score=ua._replay?0:Math.round(s.reward.score),d=we(c=i.data.score)>we(i.data.score-s.reward.score),f.append(n=$("<div>").addClass("result-board-item").append(l=$("<div>").addClass("result-board-rank").html(s.rank+1)).append(Ce(c).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(i.profile.title||i.profile.name)).append($("<div>").addClass("result-board-score").html(a.scores?L.avg+" "+Ve(a.scores[s.id])+L.kpm:Ve(s.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(s.reward.score?"+"+Ve(s.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",d?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(L.lvUp)))),i.game.team&&l.addClass("team-"+i.game.team),s.id==ua.id&&(s.exp=i.data.score-s.reward.score,s.level=we(s.exp),ua._result=s,n.addClass("result-board-me"),$(".result-me-expl").append(function(e,a,o){function r(e,a,o){e.append($("<h5>").addClass("result-me-blog-head").html(a)).append($("<h5>").addClass("result-me-blog-body").html(o))}var t,i,s=$("<div>").append($("<h4>").html(L.scoreGain)).append(t=$("<div>")).append($("<h4>").html(L.moneyGain)).append(i=$("<div>"));return r(t,L.scoreOrigin,e),r(i,L.moneyOrigin,a),o.forEach(function(o){var s,n,l,d=o.charAt(0),m=o.charAt(1),c=o.slice(2,5),u=Number(o.slice(5));"EXP"==c?(s=t,l=e):"MNY"==c&&(s=i,l=a),"g"==m?n="+"+(l*u).toFixed(1):"h"==m&&(n="+"+Math.floor(u)),r(s,L["bonusFrom_"+d],n)}),s}(s.reward._score,s.reward._money,s.reward._blog))));$(".result-me").css("opacity",0),ua._coef=0,ua._result&&(u=ua._result.reward.score-ua._result.reward._score,g=ua._result.reward.money-ua._result.reward._money,ua._result._exp=ua._result.exp,ua._result._score=ua._result.reward.score,ua._result._bonus=u,ua._result._boing=ua._result.reward._score,ua._result._addit=u,ua._result._addp=g,u=u>0?"<label class='result-me-bonus'>(+"+Ve(u)+")</label>":"",g=g>0?"<label class='result-me-bonus'>(+"+Ve(g)+")</label>":"",Be(L.scoreGain+": "+Ve(ua._result.reward.score)+", "+L.moneyGain+": "+Ve(ua._result.reward.money)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+Ve(ua._result.reward.score)+u),$(".result-me-money").html(L.moneyGain+" +"+Ve(ua._result.reward.money)+g)),p(function(){m(oa.dialog.result),ua._result&&o(!0),oa.dialog.result.css("opacity",0).animate({opacity:1},500),p(function(){ua._coef=.05},500)},2e3),ua._record=!1}(e.result,e.data);break;case"kickVote":ua._kickTarget=ua.users[e.target],ua.id!=e.target&&ua.id!=ua.room.master&&function(e){var a=ua.users[e].profile;$("#kick-vote-text").html((a.title||a.name)+L.kickVoteText),ua.kickTime=10,ua._kickTime=10,ua._kickTimer=p(pe,1e3),m(oa.dialog.kickVote)}(e.target),Be((ua._kickTarget.profile.title||ua._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":Be(h(ua._kickTarget.profile,e));break;case"invited":l("inviteRes",{from:e.from,res:!ua.opts.di&&confirm(e.from+L.invited)});break;case"inviteNo":Be(((o=ua.users[e.target]).profile.title||o.profile.name)+L.inviteDenied);break;case"okg":ua._playTime>e.time?Be(L.okgExpired):ua._okg!=e.count&&Be(L.okgNotice+" ("+L.okgCurrent+e.count+")"),ua._playTime=e.time,ua._okg=e.count;break;case"obtain":Ke(e);break;case"expired":for(a in e.list)Be(Ie(e.list[a])+L.hasExpired);break;case"blocked":Be(L.blocked);break;case"test":(ua._test=!ua._test)?(ua._testt=u(function(){oa.talk.val()!=ua._ttv&&(l("test",{ev:"c",v:oa.talk.val()},!0),ua._ttv=oa.talk.val())},100),document.onkeydown=function(e){l("test",{ev:"d",c:e.keyCode},!0)},document.onkeyup=function(e){l("test",{ev:"u",c:e.keyCode},!0)}):(clearInterval(ua._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":if(a=e.message||"",401==e.code);else if(403==e.code)d();else if(406==e.code){if(oa.dialog.quick.is(":visible")){ua._preQuick=!1;break}}else if(409==e.code)a=L["server_"+a];else{if(416==e.code)return void(confirm(L["error_"+e.code])&&(Re(),ua._spectate=!0,ua._gaming=!0,l("enter",{id:e.target,password:ua._pw,spectate:!0},!0)));if(413==e.code)oa.dialog.room.hide(),oa.menu.setRoom.trigger("click");else if(429==e.code)je("lobby");else if(430==e.code){if(ua.setRoom(e.message,null),oa.dialog.quick.is(":visible")){ua._preQuick=!1;break}}else if(431==e.code||432==e.code||433==e.code)oa.dialog.room.show();else if(444==e.code){if(-1!=(a=e.message).indexOf("생년월일")){alert("생년월일이 올바르게 입력되지 않아 게임 이용이 제한되었습니다. 잠시 후 다시 시도해 주세요.");break}}else if(447===e.code){alert("자동화 봇 방지를 위한 캡챠 인증에 실패했습니다. 메인 화면에서 다시 시도해 주세요.");break}}alert("[#"+e.code+"] "+L["error_"+e.code]+a)}ua._record&&ie(e)}function h(e,a){var o=L.agree+" "+a.Y+", "+L.disagree+" "+a.N+L.kickCon;return a.Y>=a.N?o+=(e.title||e.name)+L.kicked:o+=(e.title||e.name)+L.kickDenied,o}function v(e){var a,o,r={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(e[0].toLowerCase()){case"/ㄱ":case"/r":ua.room&&(ua.room.master==ua.id?oa.menu.start.trigger("click"):oa.menu.ready.trigger("click"));break;case"/청소":case"/cls":$("#Chat").empty();break;case"/ㄹ":case"/f":m(oa.dialog.chatLog),oa.chatLog.scrollTop(999999999);break;case"/귓":case"/ㄷ":case"/e":k(e[1],e.slice(2).join(" "));break;case"/답":case"/ㄷㄷ":case"/ee":ua._recentFrom?k(ua._recentFrom,e.slice(1).join(" ")):Be(L.error_425);break;case"/무시":case"/wb":!function(e){ua._wblock.hasOwnProperty(e)?(delete ua._wblock[e],Be(e+L.wnblocked)):(ua._wblock[e]=!0,Be(e+L.wblocked))}(e[1]);break;case"/차단":case"/shut":_(e.slice(1).join(" "));break;case"/id":if(e[1]){for(a in o=0,e[1]=e.slice(1).join(" "),ua.users)(ua.users[a].profile.title||ua.users[a].profile.name)==e[1]&&Be("["+ ++o+"] "+a);o||Be(L.error_405)}else Be(L.myId+ua.id);break;default:for(a in r)Be(r[a],a)}}function k(e,a){a.length&&(ua._whisper=e,l("talk",{whisper:e,value:a},!0),Ee({title:"→"+e},a,!0))}function _(e){ua._shut.hasOwnProperty(e)?(delete ua._shut[e],Be(e+L.userNShut)):(ua._shut[e]=!0,Be(e+L.userShut))}function y(e,a){var o=(e=e.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,"")).match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";if(e.length<1)return a({error:404});$.get("/dict/"+e+"?lang="+o,a)}function w(){return ua.place?ua.room.gaming||ua.resulting?"for-gaming":ua.master?"for-master":"for-normal":"for-lobby"}function C(e,a){var o,r=w();if(ua._replay){if(void 0!==e&&!e)return;te()}if(!ua._replay&&("for-gaming"!=r||e)){for(o in ua.practicing&&(r="for-gaming"),$(".kkutu-menu button").hide(),oa.box)oa.box[o].hide();oa.box.me.show(),oa.box.chat.show().width(790).height(190),oa.chat.height(120),"for-lobby"==r?(ua._ar_first=!0,oa.box.userList.show(),ua._shop?(oa.box.roomList.hide(),oa.box.shop.show()):(oa.box.roomList.show(),oa.box.shop.hide()),R(a||r!=ua._only),function(e){var a,o=0;if(e)for(a in oa.lobby.roomList.empty(),ua.rooms)oa.lobby.roomList.append(D(ua.rooms[a])),o++;else for(a in $(".rooms-create").remove(),ua.rooms)o++;oa.lobby.roomListTitle.html(L.RoomList.replace("FA{bars}","<i class='fa fa-bars'></i>")+" ["+o+L.GAE+"]"),o?($(".rooms-gaming").css("display",ua.opts.ow?"none":""),$(".rooms-locked").css("display",ua.opts.ou?"none":"")):oa.lobby.roomList.append(oa.lobby.createBanner.clone().on("click",function(e){oa.menu.newRoom.trigger("click")}))}(a||r!=ua._only),S(),ua._jamsu&&(clearTimeout(ua._jamsu),delete ua._jamsu)):"for-master"==r||"for-normal"==r?($(".team-chosen").removeClass("team-chosen"),ua.users[ua.id].game.ready||"S"==ua.users[ua.id].game.form?(oa.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):(oa.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+ua.users[ua.id].game.team).addClass("team-chosen"),ua.opts.ar&&ua._ar_first&&(oa.menu.ready.addClass("toggled"),oa.menu.ready.trigger("click"),ua._ar_first=!1)),ua._shop=!1,oa.box.room.show().height(360),"for-master"==r&&oa.dialog.inviteList.is(":visible")&&R(),B(!1),S()):"for-gaming"==r&&(ua._gAnim&&(oa.box.room.show(),ua._gAnim=!1),ua._shop=!1,ua._ar_first=!0,oa.box.me.hide(),oa.box.game.show(),$(".ChatBox").width(1e3).height(140),oa.chat.height(70),B(!0)),ua._only=r,function(e){location.hash=e?"#"+e:""}(ua.place),$(".kkutu-menu ."+r).show()}}function T(e){$(e).addClass("room-head-modified"),p(function(){$(e).removeClass("room-head-modified")},3e3)}function S(){var e,a,o=ua.users[ua.id],r=0,t=we(o.data.score),i=la[t-2]||0,s=la[t-1];for(e in o.data.rankPoint<50?a="UNRANKED":o.data.rankPoint>=50&&o.data.rankPoint<500?a="BRONZE":o.data.rankPoint>=500&&o.data.rankPoint<1500?a="SILVER":o.data.rankPoint>=1500&&o.data.rankPoint<2500?a="GOLD":o.data.rankPoint>=2500&&o.data.rankPoint<3500?a="PLATINUM":o.data.rankPoint>=3500&&o.data.rankPoint<5e3?a="DIAMOND":o.data.rankPoint>=5e3&&(a="MASTER"),o.data.record)r+=o.data.record[e][1];Je(".my-image",o.equip),$(".my-stat-level").replaceWith(Ce(o.data.score).addClass("my-stat-level")),$(".my-stat-name").html(o.profile.title||o.profile.name),$(".my-stat-record").html(L.globalWin+" "+r+L.W),$(".my-stat-ping").html(Ve(o.money)+L.ping),$(".my-rankPoint").html(o.data.rankPoint+L.LP),$(".my-rank").html(L[a]),$(".my-okg .graph-bar").width(ua._playTime%6e5/6e3+"%"),$(".my-okg-text").html(j(ua._playTime)),$(".my-level").html(L.LEVEL+" "+t),$(".my-gauge .graph-bar").width((o.data.score-i)/(s-i)*190),$(".my-gauge-text").html(Ve(o.data.score)+" / "+Ve(s))}function j(e){var a=Math.floor(e/6e4)%60,o=Math.floor(.001*e)%60,r=Math.floor(e/36e5),t=[];return r&&t.push(r+L.HOURS),a&&t.push(a+L.MINUTE),r||t.push(o+L.SECOND),t.join(" ")}function R(e){var a,o,r,t=0;if(ua.opts.su){for(a in r=[],ua.users)t++,r.push(ua.users[a]);r.sort(function(e,a){return a.data.score-e.data.score}),e=!0}else for(a in r=ua.users,ua.users)t++;if(oa.lobby.userListTitle.html("<i class='fa fa-users'></i>&lt;<b>"+L["server_"+ua.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+t+L.MN+"]"),e)for(a in oa.lobby.userList.empty(),oa.dialog.inviteList.empty(),r)(o=r[a]).robot||(oa.lobby.userList.append(q(o)),0==o.place&&oa.dialog.inviteList.append(q(o,!0)))}function q(e,a){var o;return P(o=a?$("<div>").attr("id","invite-item-"+e.id).addClass("invite-item users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Ce(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(e.profile.title||e.profile.name)).on("click",function(e){H($(e.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+e.id).addClass("users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Ce(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(e.profile.title||e.profile.name)).on("click",function(e){W($(e.currentTarget).attr("id").slice(11))}),e),o}function P(e,a){a.equip.NIK&&e.addClass("x-"+a.equip.NIK),"b1_gm"==a.equip.BDG&&e.addClass("x-gm")}function D(e){var a,o,r=xe(e.mode,e.opts);return a=$("<div>").attr("id","room-"+e.id).addClass("rooms-item").append(o=$("<div>").addClass("rooms-channel channel-"+e.channel).on("click",function(a){!function(e){var a=ua.rooms[e],o=$("#ri-players").empty();ua._roominfo=e,$("#RoomInfoDiag .dialog-title").html(e+L.sRoomInfo),$("#ri-title").html((a.password?"<i class='fa fa-lock'></i>&nbsp;":"")+a.title),$("#ri-mode").html(L["mode"+He[a.mode]]),$("#ri-round").html(a.round+", "+a.time+L.SECOND),$("#ri-limit").html(a.players.length+" / "+a.limit),a.players.forEach(function(e,r){var t,i,s=a.readies[e]||{};e=ua.users[e]||sa,a.players[r].robot?(e.profile={title:L.robot},e.equip={robot:!0}):s.t=s.t||0,o.append($("<div>").addClass("ri-player").append(i=$("<div>").addClass("moremi rip-moremi")).append(t=$("<div>").addClass("ellipse rip-title").html(e.profile.title||e.profile.name)).append($("<div>").addClass("rip-team team-"+s.t).html($("#team-"+s.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+s.f]))),e.id==a.master&&t.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),t.prepend(Ce(e.data.score).addClass("profile-level rip-level")),Je(i,e.equip)}),m(oa.dialog.roomInfo),oa.dialog.roomInfo.show()}(e.id)})).append($("<div>").addClass("rooms-number").html(e.id)).append($("<div>").addClass("rooms-title ellipse").text(Oe(e.title))).append($("<div>").addClass("rooms-limit").html(e.players.length+" / "+e.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(r.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+e.round)).append($("<div>").addClass("rooms-time").html(e.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(e.password?"<i class='fa fa-lock'></i>":"<i class='fa fa-unlock'></i>")).on("click",function(e){e.target!=o.get(0)&&De($(e.currentTarget).attr("id").slice(5))}),e.gaming&&a.addClass("rooms-gaming"),e.password&&a.addClass("rooms-locked"),a}function A(e){var a,o,r,t=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append(a=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(Ce(e.data.score).addClass("game-user-level")).append(r=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+we(e.data.score)))).append(o=$("<div>").addClass("game-user-score"));return Je(a,e.equip),global.expl(t),P(r,e),e.game.team&&o.addClass("team-"+e.game.team),t}function O(e){var a,o,r=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(Ce(e.data.score).addClass("game-user-level")).append(o=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name))).append(a=$("<div>").addClass("game-user-score"));return e.id==ua.id&&o.addClass("game-user-my-name"),P(o,e),e.game.team&&a.addClass("team-"+e.game.team),r}function E(e){return{title:L["aiLevel"+e]+" "+L.robot,image:"/img/kkutu/robot.png"}}function B(e){var a,o,r,t,i,s,n,l=Xe[He[ua.room.mode]],d=ta||l.big?O:A,m=!1,c=!0;if(Te($(".RoomBox .product-title"),ua.room),Te($(".GameBox .product-title"),ua.room),e){for(a in r=$(".GameBox .game-body").empty(),ua.room.game.seq)(o=ua._replay?ra.users[ua.room.game.seq[a]]||ua.room.game.seq[a]:ua.users[ua.room.game.seq[a]]||ua.robots[ua.room.game.seq[a].id]||ua.room.game.seq[a]).robot&&!o.profile&&(o.profile=E(o.level),ua.robots[o.id]=o),r.append(d(o)),N(o.id,o.game.score||0);clearTimeout(ua._jamsu),delete ua._jamsu}else{for(a in r=$(".room-users").empty(),g="S"==ua.users[ua.id].game.form,ua.room.players)if((o=ua.users[ua.room.players[a]]||ua.room.players[a]).game){var u=o.game.practice?"/"+L.stat_practice:"",g="S"==o.game.form&&"/"+L.stat_spectate;o.robot&&(o.profile=E(o.level),ua.robots[o.id]=o),r.append($("<div>").attr("id","room-user-"+o.id).addClass("room-user").append(s=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(t=$("<div>").addClass("room-user-ready")).append(i=$("<div>").addClass("room-user-team team-"+o.game.team).html($("#team-"+o.game.team).html()))).append($("<div>").addClass("room-user-title").append(Ce(o.data.score).addClass("room-user-level")).append(n=$("<div>").addClass("room-user-name").html(o.profile.title||o.profile.name))).on("click",function(e){W($(e.currentTarget).attr("id").slice(10))})),Je(s,o.equip),g&&i.hide(),o.id==ua.room.master?t.addClass("room-user-master").html(L.master+u+(g||"")):g?t.addClass("room-user-spectate").html(L.stat_spectate+u):o.game.ready||o.robot?(t.addClass("room-user-readied").html(L.stat_ready),o.robot||(m=!0)):o.game.practice?(t.addClass("room-user-practice").html(L.stat_practice),c=!1):(t.html(L.stat_noready),c=!1),P(n,o)}m&&ua.room.master==ua.id&&c?ua._jamsu||(ua._jamsu=p(M,5e3)):(clearTimeout(ua._jamsu),delete ua._jamsu)}oa.dialog.profile.is(":visible")&&W(ua._profiled)}function M(){Be(L.subJamsu),ua._jamsu=p(function(){l("leave"),alert(L.masterJamsu)},3e4)}function N(e,a){var o;return(o=ua["_s"+e])?(clearTimeout(o.timer),o.$obj=$("#game-user-"+e+" .game-user-score"),o.goal=a):o=ua["_s"+e]={$obj:$("#game-user-"+e+" .game-user-score"),goal:a,now:0},I(o),$("#game-user-"+e)}function I(e){var a=(e.goal-e.now)*Math.min(1,.01*na);a<.1?a=e.goal-e.now:e.timer=p(I,na,e),e.now+=a,function(e,a){var o,r=a>99999?n(Math.round(.001*a),4)+"k":n(a,5);for(e.empty(),o=0;o<r.length;o++)e.append($("<div>").addClass("game-user-score-char").html(r[o]))}(e.$obj,Math.round(e.now))}function F(e){var a=$("#dress-view"),o=ua.users[ua.id];Je(a,o.equip),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-exordial").val(o.exordial),K(e||!0)}function G(e,a,o,r,t){var i,s,n,l,d,m,c=[],u=!0===o;for(m in e.empty(),r||(r={}),r)ua.box.hasOwnProperty(r[m])||(ua.box[r[m]]={value:0});for(m in ua.box)c.push({key:m,obj:Ne(m),value:ua.box[m]});for(m in c.sort(function(e,a){return e.obj.name<a.obj.name?-1:1}),c)s=c[m].obj,n=c[m].value,"BDG"==(l=s.group).substr(0,3)&&(l="BDG"),d="Mhand"==l?r.Mlhand==c[m].key||r.Mrhand==c[m].key:r[l]==c[m].key,"number"==typeof n&&(n={value:n}),(n.hasOwnProperty("value")||d)&&(u||-1!=o.indexOf(s.group))&&(e.append(i=$("<div>").addClass("dress-item").append(Le(s.image).addClass("dress-item-image").html("x"+n.value)).append(ge(s,d,n.expire))),i.attr("id",a+"-"+s._id).on("click",t),d&&i.addClass("dress-equipped"));global.expl(e)}function K(e){var a,o=ua.users[ua.id].equip||{},r=!0===e;ua._avGroup=e,a=!!r||(e||"").split(","),G($("#dress-goods"),"dress",a,o,function(e){var a,o=$(e.currentTarget),r=o.attr("id").slice(6),t=Ne(r);if(e.ctrlKey){if(o.hasClass("dress-equipped"))return We(426);if(!confirm(L.surePayback+Ve(Math.round(.2*(t.cost||0)))+L.ping))return;$.post("/payback/"+r,function(e){if(e.error)return We(e.error);alert(L.painback),ua.box=e.box,ua.users[ua.id].money=e.money,F(ua._avGroup),C(!1)})}else if(-1!=Ye.indexOf(t.group))"Mhand"==t.group&&(a=confirm(L.dressWhichHand)),function(e,a){var o=ua.users[ua.id],r=ua.shop[e].group;"Mhand"==r&&(r=a?"Mlhand":"Mrhand"),"BDG"==r.substr(0,3)&&(r="BDG");var t=o.equip[r]==e;confirm(L[t?"sureUnequip":"sureEquip"]+": "+L[e][0])&&$.post("/equip/"+e,{isLeft:a},function(e){if(e.error)return We(e.error);ua.box=e.box,o.equip=e.equip,F(ua._avGroup),l("refresh"),C(!1)})}(r,a);else if("CNS"==t.group){if(!confirm(L.sureConsume))return;$.post("/consume/"+r,function(e){e.exp&&Be(L.obtainExp+": "+Ve(e.exp)),e.money&&Be(L.obtainMoney+": "+Ve(e.money)),e.gain.forEach(function(e){Ke(e)}),ua.box=e.box,ua.users[ua.id].data=e.data,l("refresh"),F(ua._avGroup),S()})}})}function U(){function e(){r.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function a(){var a,s={WPC:1,WPB:2,WPA:3},l="",d=0;r.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),ua._tray.forEach(function(e){a=Ne(e),l+=e.slice(4),d+=s[e.slice(1,4)],r.append($("<div>").addClass("jt-image").css("background-image","url("+a.image+")").attr("id","cf-tray-"+e).on("click",o)),$("#cf-\\"+e).addClass("cf-tray-selected")}),t.html(L.searching),i.empty(),oa.dialog.cfCompose.removeClass("cf-composable"),n.html(""),y(l,function(e){var a=!1;if(e.error){if(3!=l.length)return t.html(L["wpFail_"+e.error]);a=!0,t.html(L.cfBlend)}(function(e,a,o){$.get("/cf/"+e+"?l="+a+"&b="+(o?"1":""),function(e){if(e.error)return We(e.error);i.empty(),e.data.forEach(function(e){var a=Ne(e.key),o=e.rate>=1?L.cfRewAlways:(100*e.rate).toFixed(1)+"%";i.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+a.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(a.name)).append($("<div>").addClass("cf-rew-value").html("x"+e.value))).append($("<div>").addClass("cf-rew-rate").html(o)))}),n.html(L.cfCost+": "+e.cost+L.ping)})})(l,d,a),oa.dialog.cfCompose.addClass("cf-composable"),e.error||t.html(ke(e.word,e.mean,e.theme,e.type.split(",")))}),""==l&&e()}function o(e){var o=$(e.currentTarget).attr("id").slice(8),r=ua._tray.indexOf(o);-1!=r&&(ua._tray.splice(r,1),a())}var r=$("#cf-tray"),t=$("#cf-dict"),i=$("#cf-reward"),s=$("#cf-goods"),n=$("#cf-cost");ua._tray=[],t.empty(),i.empty(),n.html(""),oa.dialog.cfCompose.removeClass("cf-composable"),G(s,"cf",["PIX","PIY","PIZ"],null,function(e){var o,r=$(e.currentTarget).attr("id").slice(3),t=ua.box[r],i=0;if(ua._tray.length>=6)return We(435);for(o in ua._tray)ua._tray[o]==r&&i++;t-i>0?(ua._tray.push(r),a()):We(434)}),e()}function J(e){var a=oa.dialog.lbTable.empty(),o=e.data[0]?e.data[0].rank:0,r=(e.page||Math.floor(o/20))+1;e.data.forEach(function(e,o){var r=ua.users[e.id];r=r?r.profile.title||r.profile.name:L.hidden,e.score=Number(e.score),a.append($("<tr>").attr("id","ranking-"+e.id).addClass("ranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(Ce(e.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html(we(e.score)))).append($("<td>").html(r)).append($("<td>").html(Ve(e.score))))}),$("#ranking-"+ua.id).addClass("ranking-me"),oa.dialog.lbPage.html(L.page+" "+r),oa.dialog.lbPrev.attr("disabled",r<=1),oa.dialog.lbNext.attr("disabled",e.data.length<15),oa.dialog.lbMe.attr("disabled",!!ua.guest),ua._lbpage=r-1}function V(){function e(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),o=ua.friends[a],r=prompt(L.friendEditMemo,o);r&&l("friendEdit",{id:a,memo:r},!0)}function a(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),o=ua.friends[a];if(ua._friends[a].server)return We(455);confirm(o+"(#"+a.substr(0,5)+")\n"+L.friendSureRemove)&&l("friendRemove",{id:a},!0)}var o,r,t,i,s=0;for(o in oa.dialog.commFriends.empty(),ua.friends)s++,i=ua.friends[o],r=ua._friends[o]||{},t=(ua.users[o]||{}).profile,oa.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+o).append($("<div>").addClass("cfi-status cfi-stat-"+(r.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(r.server?L["server_"+r.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(t?t.title||t.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(i)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("fa fa-pencil").on("click",e)).append($("<i>").addClass("fa fa-remove").on("click",a))));$("#CommunityDiag .dialog-title").html(L.communityText+" ("+s+" / 100)")}function W(e){var a,o,r,t=ua.users[e]||ua.robots[e],i=$("#profile-record").empty();if(t){if($("#ProfileDiag .dialog-title").html((t.profile.title||t.profile.name)+L.sProfile),$(".profile-head").empty().append(a=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append(Le(t.profile.image).addClass("profile-image")).append($("<div>").addClass("profile-title ellipse").html(t.profile.title||t.profile.name).append($("<label>").addClass("profile-tag").html(" #"+t.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").append(Ce(t.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(r=we(t.data.score)))).append($("<div>").addClass("profile-score-text").html(Ve(t.data.score)+" / "+Ve(la[r-1])+L.PTS))).append(o=$("<div>").addClass("profile-head-item profile-exordial ellipse").text(Oe(t.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(t.exordial))),t.robot)oa.dialog.profileLevel.show(),oa.dialog.profileLevel.prop("disabled",ua.id!=ua.room.master),$("#rank").html(L.UNRANKED),$("#rankpoint").html(L["0LP"]),$("#profile-place").html(ua.room.id+L.roomNumber);else{for(r in z.data.rankPoint<50?x="UNRANKED":z.data.rankPoint>=50&&z.data.rankPoint<500?x="BRONZE":z.data.rankPoint>=500&&z.data.rankPoint<1500?x="SILVER":z.data.rankPoint>=1500&&z.data.rankPoint<2500?x="GOLD":z.data.rankPoint>=2500&&z.data.rankPoint<3500?x="PLATINUM":z.data.rankPoint>=3500&&z.data.rankPoint<5e3?x="DIAMOND":z.data.rankPoint>=5e3?x="MASTER":x="UNDEFINED",oa.dialog.profileLevel.hide(),$("#rank").html(L[x]),$("#rankpoint").html(z.data.rankPoint+L.LP),$("#profile-place").html(t.place?t.place+L.roomNumber:L.lobby),t.data.record){var s=t.data.record[r];i.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+r])).append($("<div>").addClass("profile-field-record").html(s[0]+L.P+" "+s[1]+L.W)).append($("<div>").addClass("profile-field-score").html(Ve(s[2])+L.PTS)))}Je(a,t.equip)}ua._profiled=e,oa.dialog.profileKick.hide(),oa.dialog.profileShut.hide(),oa.dialog.profileDress.hide(),oa.dialog.profileWhisper.hide(),oa.dialog.profileHandover.hide(),ua.id==e?oa.dialog.profileDress.show():t.robot||(oa.dialog.profileShut.show(),oa.dialog.profileWhisper.show()),ua.room&&ua.id!=e&&ua.id==ua.room.master&&(oa.dialog.profileKick.show(),oa.dialog.profileHandover.show()),m(oa.dialog.profile),oa.dialog.profile.show(),global.expl(o)}else Be(L.error_405)}function H(e){var a;("AI"==e||(a=ua.users[e].profile.title||ua.users[e].profile.name,confirm(a+L.sureInvite)))&&l("invite",{target:e})}function Q(e){ua._replay||ua.lastFail!=ua.id||ua.id!=e?ua.failCombo=0:(ua.failCombo++,1==ua.failCombo&&Be(L.trollWarning),ua.failCombo>1&&(l("leave"),We(437))),ua.lastFail=e}function Y(){var e;for(e in ua.room.players)(ua._replay?ra.users[ua.room.players[e]]||ua.room.players[e]:ua.users[ua.room.players[e]]||ua.robots[ua.room.players[e].id]).game.score=0,delete ua["_s"+ua.room.players[e]];delete ua.lastFail,ua.failCombo=0,ua._spectate=-1==ua.room.game.seq.indexOf(ua.id),ua._gAnim=!0,oa.box.room.show().height(360).animate({height:1},500),oa.box.game.height(1).animate({height:410},500),Re(),oa.dialog.resultSave.attr("disabled",!1),se(),oa.game.display.html(L.soon),qe("game_start"),Ae(),p(function(){oa.box.room.height(360).hide(),oa.chat.scrollTop(999999999)},500)}function X(){var e;for(e in ua.room.game.seq)ua.room.game.seq[e].robot&&(ua.room.game.seq[e].game.score=0);for(e in ra.users={},ra.players){var a=ra.players[e].id,o=ra.readies[a]||{},r=ua.users[a]||ua.robots[a],t=a;ra.players[e].robot?(r=ra.users[a]={robot:!0},(t=ra.players[e]).game={}):r=ra.users[a]={},ua.room.players.push(t),r.id=t,r.profile=ra.players[e],r.data=r.profile.data,r.equip=r.profile.equip,r.game={score:0,team:o.t}}ua._rf=0}function Z(e){var a,o,r=ua.room.events[--ua._rf];if(r){a=r.time;do{if(!(r=ua.room.events[--ua._rf]))break}while(a-r.time<1e3);for(o=ua._rf-1,X(),a=ua.muteEff,ua.muteEff=!0,i=0;i<o;i++)re();$(".deltaScore").remove(),ua.muteEff=a,re()}}function ee(e){var a=ua._rpause=!ua._rpause;$(e.target).html(a?L.replayResume:L.replayPause)}function ae(e){clearTimeout(ua._rt),re()}function oe(){ua.$gpt.html(ua._gpp+" ("+(.001*ua._eventTime).toFixed(1)+L.SECOND+" / "+(.001*ua._gtt).toFixed(1)+L.SECOND+")")}function re(e){var a,o=ua.room.events[ua._rf];return clearTimeout(ua._rt),e||ua._rf++,o?ua._rpause?(ua._rf--,ua._rt=p(re,100)):((a=o.data).hint&&(a.hint={_id:a.hint}),"chat"==a.type&&(a.timestamp=ra.time+o.time),f(a),ua._eventTime=o.time,oe(),void(ua.room.events.length>ua._rf?ua._rt=p(re,ua.room.events[ua._rf].time-o.time):te())):void te()}function te(){delete ua.room,ua._replay=!1,oa.box.room.height(360),clearTimeout(ua._rt),C(),je("lobby")}function ie(e){if(!ua._replay&&ra){var a,o=e;if(e.hasOwnProperty("type")&&"room"!=e.type&&"obtain"!=e.type){for(a in e={},o)e[a]=o[a];e.profile&&(e.profile={id:e.profile.id,title:"#"+e.profile.id}),e.user&&(e.user={id:e.user.profile.id,profile:{id:e.user.profile.id,title:"#"+e.user.profile.id},data:{score:0},equip:{}}),ra.events.push({data:e,time:(new Date).getTime()-ra.time})}}}function se(){ua._relay=!1,d(),oa.game.here.hide(),oa.dialog.result.hide(),oa.dialog.dress.hide(),oa.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),oa.game.display.empty(),oa.game.chain.hide(),oa.game.hints.empty().hide(),oa.game.cwcmd.hide(),oa.game.bb.hide(),oa.game.round.empty(),oa.game.history.empty(),oa.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function ne(e){var a;for(oa.game.round.empty(),a=0;a<ua.room.round;a++)oa.game.round.append($l=$("<label>").html(ua.room.game.title[a])),a+1==e&&$l.addClass("rounds-current")}function le(){g("turnGoing")}function de(e){return ua._replay?ra.users[e].game.score:(ua.users[e]||ua.robots[e]).game.score}function me(e,a){ua._replay?ra.users[e].game.score+=a:(ua.users[e]||ua.robots[e]).game.score+=a}function ce(e,a){return e.append(a),p(function(){a.remove()},2e3),e}function ue(e){var a,t,s,n=$(".result-board").empty();if(ua._resultPage=2,!e)return oa.dialog.resultOK.trigger("click");for(i in e.list)r=e.list[i],o=ua.users[r.id]||{profile:{title:L.hidden}},s=r.id==ua.id,n.append(a=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(Ce(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(Ve(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(t=$("<div>").addClass("result-board-lvup").css("display",s?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(e.prev-r.rank)))),s&&(e.prev-r.rank<=0&&t.hide(),a.addClass("result-board-me"))}function pe(){$(".kick-vote-time .graph-bar").width(ua.kickTime/ua._kickTime*300),--ua.kickTime>0?ua._kickTimer=p(pe,1e3):oa.dialog.kickVoteY.trigger("click")}function ge(e,a,o){var r,t,i=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(Ie(e._id)+(a?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+e.group])).append($("<div>").addClass("dress-item-expl").html(Fe(e._id))),s=$("<div>").addClass("dress-item-opts");for(r in e.term&&i.append($("<div>").addClass("dress-item-term").html(Math.floor(e.term/86400)+L.DATE+" "+L.ITEM_TERM)),o&&i.append($("<div>").addClass("dress-item-term").html(new Date(1e3*o).toLocaleString()+L.ITEM_TERMED)),e.options)if("gif"!=r){var n=r.charAt(0);t=e.options[r],"g"==n?t="+"+(100*t).toFixed(1)+"%p":"h"==n&&(t="+"+t),s.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+r])).append($("<label>").addClass("item-opts-body").html(t)).append($("<br>"))}return t&&i.append(s),i}function fe(e){var a;$.get("/shop",function(o){for(a in ua.shop={},o.goods)ua.shop[o.goods[a]._id]=o.goods[a];e&&e(o)})}function he(e){var a,o,r=$(e.currentTarget).attr("id").slice(6),t=ua.shop[r],i=ua.users[ua.id],s=i.money,n=s-t.cost,l=L.surePurchase,d={};for(o in ua.box&&ua.box[r]&&(l=L.alreadyGot+" "+l),m(oa.dialog.purchase,!0),$("#purchase-ping-before").html(Ve(s)+L.ping),$("#purchase-ping-cost").html(Ve(t.cost)+L.ping),$("#purchase-item-name").html(L[r][0]),a=$("#purchase-ping-after").html(Ve(n)+L.ping),$("#purchase-item-desc").html(n<0?L.notEnoughMoney:l),i.equip)d[o]=i.equip[o];d["Mhand"==t.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:t.group]=r,Je("#moremi-after",d),ua._sgood=r,oa.dialog.purchaseOK.attr("disabled",n<0),n<0?a.addClass("purchase-not-enough"):a.removeClass("purchase-not-enough")}function ve(e){e<1||($("#Middle").css("padding-top",e),p(function(){$("#Middle").css("padding-top",0),p(ve,50,.7*e)},50))}function be(e,a,o,r){var t,i,s,n,l,d=He[ua.room.mode],m="KKT"==d,c="KAP"==d,u=ia[t=e.length],g=0,f=ua.turnTime/96,h=ua.turnTime/12;if(oa.game.display.empty(),u?(i="As"+ua._speed,u=u.split("")):"en"==Xe[d].lang&&t<10?i="As"+ua._speed:(i="Al",ve(t)),s="K"+ua._speed,u){for(n in u)"0"!=u[n]&&(oa.game.display.append(l=$("<div>").addClass("display-text").css({float:c?"right":"left","margin-top":-6,"font-size":36}).hide().html(c?e.charAt(t-g-1):e.charAt(g))),g++,p(function(e,a){var o={"margin-top":0};qe(a),e.html()==ua.mission?(qe("mission"),e.css({color:"#66FF66"}),o["font-size"]=24):o["font-size"]=20,e.show().animate(o,100)},Number(n)*f,l,i));n=oa.game.display.children("div").get(0),$(n).css(c?"margin-right":"margin-left",.5*(oa.game.display.width()-20*t))}else if(g="",c)for(n=0;n<t;n++)p(function(e){qe(i),e==ua.mission?(qe("mission"),g="<label style='color: #66FF66;'>"+e+"</label>"+g):g=e+g,oa.game.display.html(g)},Number(n)*h/t,e[t-n-1]);else for(n=0;n<t;n++)p(function(e){qe(i),e==ua.mission?(qe("mission"),g+="<label style='color: #66FF66;'>"+e+"</label>"):g+=e,oa.game.display.html(g)},Number(n)*h/t,e[n]);p(function(){for(n=0;n<3;n++)p(function(e){if(m){if(1==e)return;qe("kung")}(u?oa.game.display.children(".display-text"):oa.game.display).css("font-size",21).animate({"font-size":20},f)},n*f*2,n);p($e,4*f,e,a,o,r),m||qe(s)},h)}function $e(e,a,o,r){var t,i,s,n=r?r.split(","):[],l={};oa.game.history.prepend(t=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(e)),(i=oa.game.history.children()).length>6&&i.last().remove(),s=ke(e,a,o,n),n.forEach(function(e){l[e]||L["class_"+e]&&(l[e]=!0,t.append($("<label>").addClass("history-class").html(L["class_"+e])))}),t.append(i=$("<div>").addClass("history-mean ellipse").append(s)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+s.html()+"</h5>")),global.expl(t)}function ke(e,a,o,r){if(!a||-1==a.indexOf("＂"))return function(e,a){return $("<label>").addClass("word").html(a)}(0,a);var t=$("<label>").addClass("word"),i=a.split(/＂[0-9]+＂/).slice(1).map(function(e){return-1==e.indexOf("［")?[[e]]:e.split(/［[0-9]+］/).slice(1).map(function(e){return e.split(/（[0-9]+）/).slice(1)})}),s=(r&&r.map(function(e){return L["class_"+e]}),o?o.split(",").map(function(e){return L["theme_"+e]}):[]),n=i.length>1;return i.forEach(function(e,a){var o=$("<label>").addClass("word-m1"),r=e.length>1;n&&o.append($("<label>").addClass("word-head word-m1-head").html(a+1)),e.forEach(function(e,a){var t=$("<label>").addClass("word-m2"),i=e.length,n=i>1,l=s.splice(0,i);r&&t.append($("<label>").addClass("word-head word-m2-head").html(a+1)),e.forEach(function(e,a){var o=$("<label>").addClass("word-m3"),r=l.shift();n&&o.append($("<label>").addClass("word-head word-m3-head").html(a+1)),r&&o.append($("<label>").addClass("word-theme").html(r)),o.append($("<label>").addClass("word-m3-body").html(function(e){return e.replace(/\$\$[^\$]+\$\$/g,function(e){return"<equ>"+e.slice(2,e.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"≥")+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>")}(e))),t.append(o)}),o.append(t)}),t.append(o)}),t}function _e(e,a,o){var r=e+(a?"("+a+")":"");return o&&(r+="<label class='jjo-display-word-length'>("+o+")</label>"),r}function ye(e){return Math.round((.3*!(e%5)+1)*(.4*!(e%15)+1)*(.5*!(e%45)+1)*(120+60*Math.floor(e/5)+120*Math.floor(e*e/225)+180*Math.floor(e*e/2025)))}function we(e){var a,o=la.length;for(a=0;a<o&&!(e<la[a]);a++);return a+1}function Ce(e){var a=we(e)-1,o=a%25*-100,r=-100*Math.floor(.04*a);return $("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/newlv.png')","background-position":o+"% "+r+"%","background-size":"2560%"})}function Le(e){return $("<div>").addClass("jt-image").css("background-image","url('"+e+"')")}function xe(e,a,o){var r,t=[L["mode"+He[e]]];for(r in Ze)a[Ze[r].name.toLowerCase()]&&t.push(L["opt"+Ze[r].name]);return o&&t.push(a.injpick.join("|")),o?t.toString():t}function Te(e,a){var o,r=xe(a.mode,a.opts),t=Xe[He[a.mode]];e.empty().append($("<h5>").addClass("room-head-number").html("["+(a.practice?L.practice:a.id)+"]")).append($("<h5>").addClass("room-head-title").text(Oe(a.title))).append(o=$("<h5>").addClass("room-head-mode").html(r.join(" / "))).append($("<h5>").addClass("room-head-limit").html((ta?"":L.players+" ")+a.players.length+" / "+a.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+a.round)).append($("<h5>").addClass("room-head-time").html(a.time+L.SECOND)),-1!=t.opts.indexOf("ijp")&&(o.append($("<div>").addClass("expl").html("<h5>"+a.opts.injpick.map(function(e){return L["theme_"+e]})+"</h5>")),global.expl(e))}function Se(e,a){ua._lsRemain=e.length,e.forEach(function(e){!function(e,a,o){function r(o){ma[e]=new i(a),t()}function t(){0==--ua._lsRemain?o&&o():d(L.loadRemain+ua._lsRemain)}function i(e){var a=this;this.audio=new Audio(e),this.audio.load(),this.start=function(){a.audio.play()},this.stop=function(){a.audio.currentTime=0,a.audio.pause()}}var s=new XMLHttpRequest;s.open("GET",a),s.responseType="arraybuffer",s.onload=function(a){ga?ga.decodeAudioData(a.target.response,function(a){ma[e]=a,t()},r):r()},s.send()}(e.key,e.value,a)})}function je(e,a){return ua.bgm&&ua.bgm.stop(),ua.bgm=qe(e,!0)}function Re(){ua.bgm&&(ua.bgm.stop(),delete ua.bgm)}function qe(e,a){var o,r,t=a&&ua.muteBGM||!a&&ua.muteEff;return r=ma[e]||ma.missing,window.hasOwnProperty("AudioBuffer")&&r instanceof AudioBuffer?((o=ga.createBufferSource()).startedAt=ga.currentTime,o.loop=a,o.buffer=t?ga.createBuffer(2,r.length,ga.sampleRate):r,o.connect(ga.destination)):(r.readyState&&(r.audio.currentTime=0),r.audio.loop=a||!1,r.audio.volume=t?0:1,o=r),ca[e]&&ca[e].stop(),ca[e]=o,o.key=e,o.start(),o}function Pe(){var e;for(e in ca)ca[e].stop()}function De(e){var a;ua.rooms[e]&&(ua.rooms[e].password&&!(a=prompt(L.putPassword))||(ua._pw=a,l("enter",{id:e,password:a})))}function Ae(){var e=$("#Chat,#chat-log-board"),a=e.children(".chat-item").last().get(0);a&&"HR"==a.tagName||(e.append($("<hr>").addClass("chat-item")),oa.chat.scrollTop(999999999))}function Oe(e){return e.replace(da,"♥♥")}function Ee(e,a,o,r){var t,i,s,n,l=r?new Date(r):new Date,d=ua.users[e.id]?ua.users[e.id].equip:{};if(!ua._shut[e.title||e.name]){if(o){if(ua.opts.dw)return;if(ua._wblock[o])return}a=Oe(a),qe("k"),Me(),!ta&&ua.room&&(t=(ua.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),function(e,a,o){$("#cb-"+a).remove();var r,t,i=(2&o?$("#game-user-"+a):$("#room-user-"+a)).offset(),s=2==o?"chat-balloon-bot":"chat-balloon-tip",n=$("<div>").addClass("chat-balloon").attr("id","cb-"+a).append($("<div>").addClass("jt-image "+s))[2==o?"prepend":"append"]($("<h4>").text(e));i&&(oa.balloons.append(n),1==o?(r=0,t=220):2==o?(r=35-n.height(),t=-2):3==o?(r=5,t=210):(r=40,t=110),n.css({top:i.top+r,left:i.left+t}),p(function(){n.animate({opacity:0},500,function(){n.remove()})},2500))}(a,e.id,t)),oa.chat.append(s=$("<div>").addClass("chat-item").append(t=$("<div>").addClass("chat-head ellipse").text(e.title||e.name)).append(i=$("<div>").addClass("chat-body").text(a)).append($("<div>").addClass("chat-stamp").text(l.toLocaleTimeString()))),r&&t.prepend($("<i>").addClass("fa fa-video-camera")),t.on("click",function(a){W(e.id)}),oa.chatLog.append(s=s.clone()),s.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(e.id||"").substr(0,5))),(n=a.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(a=i.html(),n.forEach(function(e){a=a.replace(e,"<a href='#' style='color: #2222FF;' onclick='if(confirm(\""+L.linkWarning+'")) window.open("'+e+"\");'>"+e+"</a>")}),i.html(a)),o&&(!0!==o&&(ua._recentFrom=o),i.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+i.html())),P(t,{equip:d}),oa.chat.scrollTop(999999999)}}function Be(e,a){var o=new Date;qe("k"),Me(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(a||L.notice)).append($("<div>").addClass("chat-body").html(e)).append($("<div>").addClass("chat-stamp").text(o.toLocaleTimeString()))),oa.chat.scrollTop(999999999),"tail"==a&&console.warn(o.toLocaleString(),e)}function Me(){var e=$("#Chat .chat-item"),a=$("#chat-log-board .chat-item");e.length>99&&e.first().remove(),a.length>199&&a.first().remove()}function Ne(e){var a;return a="$"==e.charAt()?ua.shop[e.slice(0,4)]:ua.shop[e],{_id:e,group:a.group,term:a.term,name:Ie(e),cost:a.cost,image:Ge(e,a),desc:Fe(e),options:a.options}}function Ie(e){return"$"==e.charAt()?L[e.slice(0,4)][0]+" - "+e.slice(4):L[e][0]}function Fe(e){return"$"==e.charAt()?L[e.slice(0,4)][1]:L[e][1]}function Ge(e,a){var o,r;if(e){if("$"==e.charAt())return function(e,a){var o,r=document.createElement("canvas"),t=r.getContext("2d");switch(r.width=r.height=50,t.font="24px NBGothic",t.textAlign="center",t.textBaseline="middle",e){case"WPC":case"WPB":case"WPA":o=["WPC","WPB","WPA"].indexOf(e),t.beginPath(),t.arc(25,25,25,0,2*Math.PI),t.fillStyle=["#DDDDDD","#A6C5FF","#FFEF31"][o],t.fill(),t.fillStyle=["#000000","#4465C3","#E69D12"][o],t.fillText(a,25,25)}return r.toDataURL()}(e.slice(1,4),e.slice(4))}else"string"==typeof a&&(a={_id:"def",group:a,options:{}});return r=(o=ua.shop[e]||a).options.hasOwnProperty("gif")?".gif":".png","BDG"==o.group.slice(0,3)?"/img/kkutu/moremi/badge/"+o._id+r:"M"==o.group.charAt(0)?"/img/kkutu/moremi/"+o.group.slice(1)+"/"+o._id+r:"/img/kkutu/shop/"+o._id+".png"}function Ke(e){oa.dialog.obtain.is(":visible")?ua._obtain.push(e):(Ue(e),m(oa.dialog.obtain,!0))}function Ue(e){qe("success"),$("#obtain-image").css("background-image","url("+Ge(e.key)+")"),$("#obtain-name").html(Ie(e.key))}function Je(e,a){var o,r,t=$(e).empty(),i={Mlhand:"Mhand",Mrhand:"Mhand"};for(o in a||(a={}),Qe)r="M"+Qe[o],t.append($("<img>").addClass("moremies moremi-"+r.slice(1)).attr("src",Ge(a[r],i[r]||r)).css({width:"100%",height:"100%"}));(r=a.BDG)&&t.append($("<img>").addClass("moremies moremi-badge").attr("src",Ge(r)).css({width:"100%",height:"100%"})),t.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",a.robot?"/img/kkutu/moremi/robot.png":"/img/kkutu/moremi/body.png").css({width:"100%",height:"100%"})),t.children(".moremi-rhand").css("transform","scaleX(-1)")}function Ve(e){var a=/(^[+-]?\d+)(\d{3})/;if(null===e)return"?";for(e=e.toString();a.test(e);)e=e.replace(a,"$1,$2");return e}function We(e){return alert(L["error_"+e])}function ze(e){oa.yell.show().css("opacity",1).html(e),p(function(){oa.yell.animate({opacity:0},3e3),p(function(){oa.yell.hide()},3e3)},1e3)}var He,Qe,Ye,Xe,Ze,ea,aa,oa,ra,ta,ia=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],sa={profile:{title:L.null},data:{score:0}},na=30,la=[],da=new RegExp(["느으*[^가-힣]*금마?","니[^가-힣]*(엄|앰|엠)","(ㅄ|ㅅㅂ|ㅂㅅ)","미친(년|놈)?","(병|븅|빙)[^가-힣]*신","보[^가-힣]*지","(새|섀|쌔|썌)[^가-힣]*(기|끼)","섹[^가-힣]*스","(시|씨|쉬|쒸)이*입?[^가-힣]*(발|빨|벌|뻘|팔|펄)","십[^가-힣]*새","씹","(애|에)[^가-힣]*미","자[^가-힣]*지","존[^가-힣]*나","좆|죶","지랄","창[^가-힣]*(녀|년|놈)","fuck","sex"].join("|"),"g"),ma={},ca={},ua={},pa={Classic:{},Jaqwi:{},Crossword:{},Typing:{},Hunmin:{},Daneo:{},Sock:{}},ga=!!window.hasOwnProperty("AudioContext")&&new AudioContext,fa=window.WebSocket,ha=setInterval,va=setTimeout;$(document).ready(function(){function e(e,a){var o,r;for(o in Ze)r=Ze[o].name.toLowerCase(),-1==e.indexOf(o)?$("#"+a+"-"+r+"-panel").hide():$("#"+a+"-"+r+"-panel").show()}function a(e){var a,o,r={};for(a in Ze)o=Ze[a].name.toLowerCase(),$("#"+e+"-"+o).is(":checked")&&(r[o]=!0);return r}function o(e,a,o,r){var t;if(!r){if(e.gaming)return!1;if(e.password)return!1;if(e.players.length>=e.limit)return!1}if(e.mode!=a)return!1;for(t in o)if(!e.opts[t])return!1;return!0}function r(e){$(".team-selector").hasClass("team-unable")||l("team",{value:$(e.currentTarget).attr("id").slice(5)})}function t(){(ea=new fa(ua.URL)).onopen=function(e){d()},ea.onmessage=_onMessage=function(e){f(JSON.parse(e.data))},ea.onclose=function(e){var a=L.closed+" (#"+e.code+")";aa&&aa.close(),Pe(),alert(a),$.get("/kkutu_notice.html",function(e){d(e)})},ea.onerror=function(e){console.warn(L.error,e)}}var i;for(ua.PUBLIC="true"==$("#PUBLIC").html(),ua.URL=$("#URL").html(),ua.version=$("#version").html(),ua.server=location.href.match(/\?.*server=(\d+)/)[1],ua.shop={},ua._okg=0,ua._playTime=0,ua._kd="",ua._timers=[],ua._obtain=[],ua._wblock={},ua._shut={},ua.usersR={},la.push(ye(1)),i=2;i<360;i++)la.push(la[i-2]+ye(i));if(la[359]=1/0,la.push(1/0),oa={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),chatLog:$("#chat-log-board"),talk:$("#Talk"),chatBtn:$("#ChatBtn"),menu:{help:$("#HelpBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),leaderboard:$("#LeaderboardBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),community:$("#CommunityDiag"),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},null==fa)return d(L.websocketUnsupport),void alert(L.websocketUnsupport);for(ua._soundList=[{key:"k",value:"/media/kkutu/k.mp3"},{key:"lobby",value:"/media/kkutu/LobbyBGM.mp3"},{key:"jaqwi",value:"/media/kkutu/JaqwiBGM.mp3"},{key:"jaqwiF",value:"/media/kkutu/JaqwiFastBGM.mp3"},{key:"game_start",value:"/media/kkutu/game_start.mp3"},{key:"round_start",value:"/media/kkutu/round_start.mp3"},{key:"fail",value:"/media/kkutu/fail.mp3"},{key:"timeout",value:"/media/kkutu/timeout.mp3"},{key:"lvup",value:"/media/kkutu/lvup.mp3"},{key:"Al",value:"/media/kkutu/Al.mp3"},{key:"success",value:"/media/kkutu/success.mp3"},{key:"missing",value:"/media/kkutu/missing.mp3"},{key:"mission",value:"/media/kkutu/mission.mp3"},{key:"kung",value:"/media/kkutu/kung.mp3"},{key:"horr",value:"/media/kkutu/horr.mp3"}],i=0;i<=10;i++)ua._soundList.push({key:"T"+i,value:"/media/kkutu/T"+i+".mp3"},{key:"K"+i,value:"/media/kkutu/K"+i+".mp3"},{key:"As"+i,value:"/media/kkutu/As"+i+".mp3"});for(i in Se(ua._soundList,function(){fe(t)}),delete ua._soundList,Qe=$("#MOREMI_PART").html().split(","),Ye=$("#AVAIL_EQUIP").html().split(","),Xe=JSON.parse($("#RULE").html()),Ze=JSON.parse($("#OPTIONS").html()),He=Object.keys(Xe),(ta="true"==$("#mobile").html())&&(na=200),ua._timePercent=function(){return 100-(ua._turnSound.audio?ua._turnSound.audio.currentTime:ga.currentTime-ua._turnSound.startedAt)/ua.turnTime*1e5+"%"},ua.setRoom=function(e,a){var o="for-lobby"==w();null==a?(delete ua.rooms[e],o&&$("#room-"+e).remove()):(o&&!ua.rooms[e]&&oa.lobby.roomList.append($("<div>").attr("id","room-"+e)),ua.rooms[e]=a,o&&$("#room-"+e).replaceWith(D(a)))},ua.setUser=function(e,a){var o,r=w(),t="for-lobby"==r||"for-master"==r;ua._replay?ra.users[e]=a:null==a?(delete ua.users[e],t&&$("#users-item-"+e+",#invite-item-"+e).remove()):(t&&!ua.users[e]&&(o=q(a,"for-master"==r),"for-master"==r?oa.dialog.inviteList.append(o):oa.lobby.userList.append(o)),ua.users[e]=a,t&&(o?$("#"+o.attr("id")).replaceWith(o):$("#"+("for-lobby"==r?"users-item-":"invite-item")+e).replaceWith(q(a,"for-master"==r))))},$(document).on("paste",function(e){if(ua.room&&ua.room.gaming)return e.preventDefault(),!1}),oa.talk.on("drop",function(e){if(ua.room&&ua.room.gaming)return e.preventDefault(),!1}),ua.opts=$.cookie("kks"),ua.opts&&c(JSON.parse(ua.opts)),$(".dialog-head .dialog-title").on("mousedown",function(e){var a=$(e.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),a.addClass("dialog-front"),function(e,a,o){var r=e.position();$(window).on("mousemove",function(t){var i=t.pageX-a,s=t.pageY-o;e.css("left",r.left+i),e.css("top",r.top+s)})}(a,e.pageX,e.pageY)}).on("mouseup",function(e){$(window).off("mousemove")}),oa.chatBtn.on("click",function(e){var a=ta&&oa.game.here.is(":visible")?oa.game.hereText.val():oa.talk.val(),o={value:a};a&&("/"==o.value[0]?(o.cmd=o.value.split(" "),v(o.cmd)):((oa.game.here.is(":visible")||ua._relay)&&(o.relay=!0),l("talk",o)),ua._whisper?(oa.talk.val("/e "+ua._whisper+" "),delete ua._whisper):oa.talk.val(""),oa.game.hereText.val(""))}).hotkey(oa.talk,13).hotkey(oa.game.hereText,13),$("#cw-q-input").on("keydown",function(e){if(13==e.keyCode){var a=$(e.currentTarget),o=a.val(),r={relay:!0,data:ua._sel,value:o};if(!o)return;l("talk",r),a.val("")}}).on("focusout",function(e){$(".cw-q-body").empty(),oa.game.cwcmd.css("opacity",0)}),$("#room-limit").on("change",function(e){var a=$(e.currentTarget),o=a.val();o<2||o>8?a.css("color","#FF4444"):a.css("color","")}),$("#room-round").on("change",function(e){var a=$(e.currentTarget),o=a.val();o<1||o>10?a.css("color","#FF4444"):a.css("color","")}),oa.game.here.on("click",function(e){ta||oa.talk.focus()}),oa.talk.on("keyup",function(e){oa.game.hereText.val(oa.talk.val())}),$(window).on("beforeunload",function(e){if(ua.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),oa.dialog)oa.dialog[i].children(".dialog-head").hasClass("no-close")||oa.dialog[i].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(e){$(e.currentTarget).parent().parent().hide()}).hotkey(!1,27));for(oa.menu.help.on("click",function(e){$("#help-board").attr("src","/help"),m(oa.dialog.help)}),oa.menu.setting.on("click",function(e){m(oa.dialog.setting)}),oa.menu.community.on("click",function(e){if(ua.guest)return We(451);m(oa.dialog.community)}),oa.dialog.commFriendAdd.on("click",function(e){var a=prompt(L.friendAddNotice);if(a)return ua.users[a]?void l("friendAdd",{target:a},!0):We(450)}),oa.menu.newRoom.on("click",function(e){var a;oa.dialog.quick.hide(),ua.typeRoom="enter",m(a=oa.dialog.room),a.find(".dialog-title").html(L.newRoom)}),oa.menu.setRoom.on("click",function(e){var a,o,r,t=Xe[He[ua.room.mode]];for(o in ua.typeRoom="setRoom",$("#room-title").val(ua.room.title),$("#room-limit").val(ua.room.limit),$("#room-mode").val(ua.room.mode).trigger("change"),$("#room-round").val(ua.room.round),$("#room-time").val(ua.room.time/t.time),Ze)r=Ze[o].name.toLowerCase(),$("#room-"+r).attr("checked",ua.room.opts[r]);ua._injpick=ua.room.opts.injpick,m(a=oa.dialog.room),a.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(r){var t,i,s=$("#quick-mode").val(),n=0;for(t in"quick-mode"==r.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),i=a("quick"),e(Xe[He[s]].opts,"quick"),ua.rooms)o(ua.rooms[t],s,i,!0)&&n++;$("#quick-status").html(L.quickStatus+" "+n)}),oa.menu.quickRoom.on("click",function(e){oa.dialog.room.hide(),m(oa.dialog.quick),oa.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-queue").html(""),oa.dialog.quickOK.removeClass("searching").html(L.OK))}),oa.dialog.quickOK.on("click",function(e){function r(){var e,a=[];if(oa.dialog.quick.is(":visible")){for(e in $("#quick-queue").html(L.quickQueue+" "+j(1e3*ua._quickn++)),ua.rooms)o(ua.rooms[e],t,i)&&a.push(e);a.length&&(e=a[Math.floor(Math.random()*a.length)],ua._preQuick=!0,$("#room-"+e).trigger("click"))}else clearTimeout(ua._quickT)}var t=$("#quick-mode").val(),i=a("quick");if("for-lobby"==w()){if(oa.dialog.quickOK.hasClass("searching"))return oa.dialog.quick.hide(),r(),void oa.menu.quickRoom.trigger("click");$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),oa.dialog.quickOK.addClass("searching").html("<i class='fa fa-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),ua._quickn=0,ua._quickT=u(r,1e3)}}),$("#room-mode").on("change",function(a){var o=$("#room-mode").val(),r=Xe[He[o]];$("#game-mode-expl").html(L["modex"+o]),e(r.opts,"room"),ua._injpick=[],-1!=r.opts.indexOf("ijp")?$("#room-injpick-panel").show():$("#room-injpick-panel").hide(),"Typing"==r.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(e,a){$(a).html(Number($(a).val())*r.time+L.SECOND)})}).trigger("change"),oa.menu.spectate.on("click",function(e){oa.menu.spectate.hasClass("toggled")?(l("form",{mode:"J"}),oa.menu.spectate.removeClass("toggled")):(l("form",{mode:"S"}),oa.menu.spectate.addClass("toggled"))}),oa.menu.shop.on("click",function(e){(ua._shop=!ua._shop)?(function(){var e=$("#shop-shelf");e.html(L.LOADING),fe(function(a){if(e.empty(),ua.guest&&(a.error=423),a.error)return oa.menu.shop.trigger("click"),We(a.error);a.goods.sort(function(e,a){return a.updatedAt-e.updatedAt}).forEach(function(a,o,r){if(!(a.cost<0)){var t=Ge(!1,a);e.append($("<div>").attr("id","goods_"+a._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+t+")")).append($("<div>").addClass("goods-title").html(Ie(a._id))).append($("<div>").addClass("goods-cost").html(Ve(a.cost)+L.ping)).append(ge(a,!1)).on("click",he))}}),global.expl(e)}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}(),oa.menu.shop.addClass("toggled")):oa.menu.shop.removeClass("toggled"),C()}),$(".shop-type").on("click",function(e){var a=$(e.currentTarget),o=a.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),a.addClass("selected"),function(e){var a,o,r,t=!0===e;for(r in t||(e=e.split(",")),ua.shop)(o=ua.shop[r]).cost<0||(a=$("#goods_"+r).show(),t||-1==e.indexOf(o.group)&&a.hide())}("all"==o||a.attr("value"))}),oa.menu.dict.on("click",function(e){m(oa.dialog.dict)}),oa.menu.wordPlus.on("click",function(e){m(oa.dialog.wordPlus)}),oa.menu.invite.on("click",function(e){m(oa.dialog.invite),R(!0)}),oa.menu.practice.on("click",function(e){Xe[He[ua.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),m(oa.dialog.practice)):l("practice",{level:-1})}),oa.menu.ready.on("click",function(e){l("ready")}),oa.menu.start.on("click",function(e){l("start")}),oa.menu.exit.on("click",function(e){if(ua.room.gaming){if(!confirm(L.sureExit))return;ua._spaced&&pa.Typing.spaceOff(),clearInterval(ua._tTime),ua._relay=!1}l("leave")}),oa.menu.replay.on("click",function(e){ua._replay&&te(),m(oa.dialog.replay),oa.dialog.replayView.attr("disabled",!0),oa.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),oa.menu.leaderboard.on("click",function(e){ua._lbpage=0,oa.dialog.leaderboard.is(":visible")?oa.dialog.leaderboard.hide():$.get("/ranking",function(e){J(e),m(oa.dialog.leaderboard)})}),oa.dialog.lbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(ua._lbpage-1),function(e){J(e)})}),oa.dialog.lbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?id="+ua.id,function(e){J(e)})}),oa.dialog.lbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(ua._lbpage+1),function(e){J(e)})}),oa.dialog.settingServer.on("click",function(e){location.href="/"}),oa.dialog.settingOK.on("click",function(e){c({mb:$("#mute-bgm").is(":checked"),me:$("#mute-effect").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),$.cookie("kks",JSON.stringify(ua.opts)),oa.dialog.setting.hide()}),oa.dialog.profileLevel.on("click",function(e){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),m(oa.dialog.practice)}),oa.dialog.practiceOK.on("click",function(e){var a=$("#practice-level").val(),o=$("#ai-team").val();oa.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?l("setAI",{target:ua._profiled,level:a,team:o}):l("practice",{level:a})}),oa.dialog.roomOK.on("click",function(e){var a,o,r={injpick:ua._injpick};for(a in Ze)r[o=Ze[a].name.toLowerCase()]=$("#room-"+o).is(":checked");l(ua.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),time:$("#room-time").val(),opts:r}),oa.dialog.room.hide()}),oa.dialog.resultOK.on("click",function(e){1==ua._resultPage&&ua._resultRank?ue(ua._resultRank[ua.id]):(ua.practicing&&(ua.room.gaming=!0,l("leave")),ua.resulting=!1,oa.dialog.result.hide(),delete ua._replay,delete ua._resultRank,oa.box.room.height(360),je("lobby"),Ae(),C())}),oa.dialog.resultSave.on("click",function(e){var a=new Date(ra.time),o=new Blob([JSON.stringify(ra)],{type:"text/plain"}),r=URL.createObjectURL(o),t="KKuTu"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+"-"+a.getMinutes()+"-"+a.getSeconds()+".kkt",i=$("<a>").attr({download:t,href:r}).on("click",function(e){i.remove()});$("#Jungle").append(i),i[0].click()}),oa.dialog.dictInjeong.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||$("#dict-theme").val()&&(a.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(e){if(p(function(){a.prop("disabled",!1)},2e3),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(L.wpSuccess+"("+e.message+")")}))}),oa.dialog.dictSearch.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||(a.prop("disabled",!0),$("#dict-output").html(L.searching),y($("#dict-input").val(),function(e){if(p(function(){a.prop("disabled",!1)},500),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(ke(e.word,e.mean,e.theme,e.type.split(",")))}))}).hotkey($("#dict-input"),13),oa.dialog.wordPlusOK.on("click",function(e){var a;oa.dialog.wordPlusOK.hasClass("searching")||(a=$("#wp-input").val())&&((a=a.replace(/[^a-z가-힣]/g,"")).length<2||($("#wp-input").val(""),$(e.currentTarget).addClass("searching").html("<i class='fa fa-spin fa-spinner'></i>"),l("wp",{value:a})))}).hotkey($("#wp-input"),13),oa.dialog.inviteRobot.on("click",function(e){H("AI")}),oa.box.me.on("click",function(e){W(ua.id)}),oa.dialog.roomInfoJoin.on("click",function(e){oa.dialog.roomInfo.hide(),De(ua._roominfo)}),oa.dialog.profileHandover.on("click",function(e){confirm(L.sureHandover)&&l("handover",{target:ua._profiled})}),oa.dialog.profileKick.on("click",function(e){l("kick",{robot:ua.robots.hasOwnProperty(ua._profiled),target:ua._profiled})}),oa.dialog.profileShut.on("click",function(e){var a=ua.users[ua._profiled];a&&_(a.profile.title||a.profile.name)}),oa.dialog.profileWhisper.on("click",function(e){var a=ua.users[ua._profiled];oa.talk.val("/e "+(a.profile.title||a.profile.name).replace(/\s/g,"")+" ").focus()}),oa.dialog.profileDress.on("click",function(e){return ua.guest?We(421):ua._gaming?We(438):void(m(oa.dialog.dress)&&$.get("/box",function(e){if(e.error)return We(e.error);ua.box=e,F()}))}),oa.dialog.dressOK.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.post("/exordial",{data:$("#dress-exordial").val()},function(e){if(oa.dialog.dressOK.attr("disabled",!1),e.error)return We(e.error);oa.dialog.dress.hide()})}),$("#DressDiag .dress-type").on("click",function(e){var a=$(e.currentTarget),o=a.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),a.addClass("selected"),K("all"==o||a.attr("value"))}),$("#dress-cf").on("click",function(e){if(ua._gaming)return We(438);m(oa.dialog.charFactory)&&U()}),oa.dialog.cfCompose.on("click",function(e){if(!oa.dialog.cfCompose.hasClass("cf-composable"))return We(436);confirm(L.cfSureCompose)&&$.post("/cf",{tray:ua._tray.join("|")},function(e){var a;if(e.error)return We(e.error);for(a in l("refresh"),alert(L.cfComposed),ua.users[ua.id].money=e.money,ua.box=e.box,e.gain)Ke(e.gain[a]);F(ua._avGroup),S(),U()})}),$("#room-injeong-pick").on("click",function(e){var a,o=Xe[He[$("#room-mode").val()]];for(a in $("#injpick-list>div").hide(),"ko"==o.lang?(ua._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==o.lang&&(ua._ijkey="#en-pick-",$("#en-pick-list").show()),oa.dialog.injPickNo.trigger("click"),ua._injpick)$(ua._ijkey+ua._injpick[a]).prop("checked",!0);m(oa.dialog.injPick)}),oa.dialog.injPickAll.on("click",function(e){$("#injpick-list input").prop("checked",!0)}),oa.dialog.injPickNo.on("click",function(e){$("#injpick-list input").prop("checked",!1)}),oa.dialog.injPickOK.on("click",function(e){var a=$(ua._ijkey+"list"),o=[];ua._injpick=a.find("input").each(function(e,a){var r=$(a),t=r.attr("id").slice(8);r.is(":checked")&&o.push(t)}),ua._injpick=o,oa.dialog.injPick.hide()}),oa.dialog.kickVoteY.on("click",function(e){l("kickVote",{agree:!0}),clearTimeout(ua._kickTimer),oa.dialog.kickVote.hide()}),oa.dialog.kickVoteN.on("click",function(e){l("kickVote",{agree:!1}),clearTimeout(ua._kickTimer),oa.dialog.kickVote.hide()}),oa.dialog.purchaseOK.on("click",function(e){$.post("/buy/"+ua._sgood,function(e){var a=ua.users[ua.id];if(e.error)return We(e.error);alert(L.purchased),a.money=e.money,a.box=e.box,S()}),oa.dialog.purchase.hide()}),oa.dialog.purchaseNO.on("click",function(e){oa.dialog.purchase.hide()}),oa.dialog.obtainOK.on("click",function(e){var a=ua._obtain.shift();a?Ue(a):oa.dialog.obtain.hide()}),i=0;i<5;i++)$("#team-"+i).on("click",r);$("#replay-file").on("change",function(e){var a=e.target.files[0],o=new FileReader,r=$("#replay-date").html("-"),t=$("#replay-version").html("-"),i=$("#replay-players").html("-");ra=!1,oa.dialog.replayView.attr("disabled",!0),a&&(o.readAsText(a),o.onload=function(e){var a,o;try{for(a in o=JSON.parse(e.target.result),r.html(new Date(o.time).toLocaleString()),t.html(o.version),i.empty(),o.players){var s,n=o.players[a];i.append(s=$("<div>").addClass("replay-player-bar ellipse").html(n.title).prepend(Ce(n.data.score).addClass("users-level"))),n.id==o.me&&s.css("font-weight","bold")}ra=o,oa.dialog.replayView.attr("disabled",!1)}catch(e){return console.warn(e),alert(L.replayError)}})}),oa.dialog.replayView.on("click",function(e){!function(){var e;for(e in te(),ua._replay=!0,ua.room={title:ra.title,players:[],events:[],time:ra.roundTime,round:ra.round,mode:ra.mode,limit:ra.limit,game:ra.game,opts:ra.opts,readies:ra.readies},X(),ra.events)ua.room.events.push(ra.events[e]);oa.box.userList.hide(),oa.box.roomList.hide(),oa.box.game.show(),oa.dialog.replay.hide(),Y(),B(!0),ua.$gp=$(".GameBox .product-title").empty().append(ua.$gpt=$("<div>").addClass("game-replay-title")).append(ua.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",ae)).append($("<button>").html(L.replayPause).on("click",ee)).append($("<button>").html(L.replayPrev).on("click",Z))),ua._gpp=L.replay+" - "+new Date(ra.time).toLocaleString(),ua._gtt=ua.room.events[ua.room.events.length-1].time,ua._eventTime=0,ua._rt=p(re,2e3),ua._rprev=0,ua._rpause=!1,oe()}()}),u(function(){$a>0?$a=0:ba>0&&(ba-=.03)},1e3)}),pa.Classic.roundReady=function(e){ua.room.game.title.length,se(),ua._roundTime=1e3*ua.room.time,oa.game.display.html(_e(e.char,e.subChar)),oa.game.chain.show().html(ua.chain=0),ua.room.opts.mission&&oa.game.items.show().css("opacity",1).html(ua.mission=e.mission),"KAP"==He[ua.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),ne(e.round),qe("round_start"),ie("roundReady")},pa.Classic.turnStart=function(e){ua.room.game.turn=e.turn,e.seq&&(ua.room.game.seq=e.seq),(ua._tid=ua.room.game.seq[e.turn])&&(ua._tid.robot&&(ua._tid=ua._tid.id),e.id=ua._tid,oa.game.display.html(ua._char=_e(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),ua._replay||(oa.game.here.css("display",e.id==ua.id?"block":"none"),e.id==ua.id&&(ta?oa.game.hereText.val("").focus():oa.talk.focus())),oa.game.items.html(ua.mission=e.mission),ea.onmessage=_onMessage,clearInterval(ua._tTime),ua._chars=[e.char,e.subChar],ua._speed=e.speed,ua._tTime=u(le,na),ua.turnTime=e.turnTime,ua._turnTime=e.turnTime,ua._roundTime=e.roundTime,ua._turnSound=qe("T"+e.speed),ie("turnStart"))},pa.Classic.turnGoing=function(){ua.room||clearInterval(ua._tTime),ua._turnTime-=na,ua._roundTime-=na,oa.game.turnBar.width(ua._timePercent()).html((.001*ua._turnTime).toFixed(1)+L.SECOND),oa.game.roundBar.width(ua._roundTime/ua.room.time*.1+"%").html((.001*ua._roundTime).toFixed(1)+L.SECOND),oa.game.roundBar.hasClass("round-extreme")||ua._roundTime<=5e3&&oa.game.roundBar.addClass("round-extreme")},pa.Classic.turnEnd=function(e,a){var o,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");ua._turnSound&&ua._turnSound.stop(),me(e,a.score),clearInterval(ua._tTime),a.ok?(Q(),clearTimeout(ua._fail),oa.game.here.hide(),oa.game.chain.html(++ua.chain),be(a.value,a.mean,a.theme,a.wc)):(Q(e),r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),oa.game.here.hide(),qe("timeout")),a.hint&&(a.hint=a.hint._id,-1==(o=a.hint.indexOf(ua._chars[0]))&&(o=a.hint.indexOf(ua._chars[1])),"KAP"==He[ua.room.mode]?oa.game.display.empty().append($("<label>").css("color","#AAAAAA").html(a.hint.slice(0,o))).append($("<label>").html(a.hint.slice(o))):oa.game.display.empty().append($("<label>").html(a.hint.slice(0,o+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(o+1)))),a.bonus&&(ta?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ce(t,e)},500)),ce(t,r).removeClass("game-user-current"),N(e,de(e))},pa.Jaqwi.roundReady=function(e){var a=L.jqTheme+": "+L["theme_"+e.theme];se(),ua._roundTime=1e3*ua.room.time,ua._fastTime=1e4,oa.game.display.html(a),oa.game.items.hide(),oa.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(a).css("text-align","center"),ne(e.round),qe("round_start"),clearInterval(ua._tTime)},pa.Jaqwi.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),ua.room.game.seq.indexOf(ua.id)>=0&&oa.game.here.show(),oa.game.display.html(ua._char=e.char),clearInterval(ua._tTime),ua._tTime=u(le,na),je("jaqwi")},pa.Jaqwi.turnGoing=function(){var e,a,o=oa.game.roundBar;ua.room||clearInterval(ua._tTime),ua._roundTime-=na,a=ua._spectate?L.stat_spectate:(.001*ua._roundTime).toFixed(1)+L.SECOND,o.width(ua._roundTime/ua.room.time*.1+"%").html(a),o.hasClass("round-extreme")||ua._roundTime<=ua._fastTime&&(e=ua.bgm.currentTime/ua.bgm.duration,ua.bgm.paused?Re():je("jaqwiF"),ua.bgm.currentTime=ua.bgm.duration*e,o.addClass("round-extreme"))},pa.Jaqwi.turnHint=function(e){qe("mission"),function(e){var a,o=ke(0,e);oa.game.hints.append(a=$("<div>").addClass("hint-item").append($("<label>").html(o)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(o.html()))),ta||a.width(0).animate({width:215}),global.expl(a)}(e.hint)},pa.Jaqwi.turnEnd=function(e,a){var o=$("<div>").addClass("deltaScore").html("+"+a.score),r=$("#game-user-"+e);a.giveup?r.addClass("game-user-bomb"):a.answer?(oa.game.here.hide(),oa.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),Re(),qe("horr")):(e==ua.id&&oa.game.here.hide(),me(e,a.score),ua._roundTime>1e4&&(ua._roundTime=1e4),ce(r,o),N(e,de(e)).addClass("game-user-current"),qe("success"))},pa.Crossword.roundReady=function(e,a){var o=e.seq?e.seq.indexOf(ua.id):-1;se(),$(".jjoriping,.rounds,.game-body").addClass("cw"),ua._roundTime=1e3*ua.room.time,ua._fastTime=3e4,ua.selectedRound=-1==o?1:o%ua.room.round+1,oa.game.items.hide(),oa.game.cwcmd.show().css("opacity",0),ne(ua.selectedRound),a||qe("round_start"),clearInterval(ua._tTime)},pa.Crossword.turnEnd=function(e,a){var o,r,t=$("<div>").addClass("deltaScore").html("+"+a.score),i=$("#game-user-"+e);a.score?(r=a.pos.join(","),e==ua.id?(oa.game.cwcmd.css("opacity",0),qe("success")):(ua._sel&&a.pos.join(",")==ua._sel.join(",")&&oa.game.cwcmd.css("opacity",0),qe("mission")),ua._bdb[r][4]=a.value,ua._bdb[r][5]=e,a.pos[0]==ua.selectedRound-1?pa.Crossword.drawDisplay():(o=$(oa.game.round.children("label").get(a.pos[0])).addClass("round-effect"),p(function(){o.removeClass("round-effect")},800)),me(e,a.score),N(e,de(e)),ce(i,t)):(Re(),oa.game.round.empty(),qe("horr"))},pa.Crossword.drawDisplay=function(){var e,a,o,r,t,i,s,n,l,d=ua._boards[ua.selectedRound-1],m=oa.game.display.empty(),c={};for(a in d)for(r=Number(d[a][0]),t=Number(d[a][1]),i="1"==d[a][2],s=Number(d[a][3]),n=d[a][4],m.append(e=$("<div>").addClass("cw-bar").attr("id","cw-"+r+"-"+t+"-"+d[a][2]).css({top:12.5*t+"%",left:12.5*r+"%",width:12.5*(i?1:s)+"%",height:12.5*(i?s:1)+"%"})),n&&e.addClass("cw-open"),d[a][5]==ua.id?e.addClass("cw-my-open"):e.on("click",pa.Crossword.onBar).on("mouseleave",pa.Crossword.onSwap),o=0;o<s;o++)l=r+"-"+t,n&&(c[l]=n.charAt(o)),e.append($("<div>").addClass("cw-cell").attr("id","cwc-"+l).html(c[l]||"")),i?t++:r++},pa.Crossword.onSwap=function(e){oa.game.display.prepend($(e.currentTarget))},pa.Crossword.onRound=function(e){var a=$(e.currentTarget).html().charCodeAt(0)-9311;ne(ua.selectedRound=a),$(".rounds label").on("click",pa.Crossword.onRound),pa.Crossword.drawDisplay()},pa.Crossword.onBar=function(e){var a=$(e.currentTarget).attr("id").slice(3).split("-"),o=ua._means[ua.selectedRound-1][a.join(",")],r="1"==o.dir;oa.game.cwcmd.css("opacity",1),ua._sel=[ua.selectedRound-1,a[0],a[1],a[2]],$(".cw-q-head").html(L[r?"cwVert":"cwHorz"]+o.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(ke(0,o.mean,o.theme,o.type.split(",")))},pa.Crossword.turnStart=function(e,a){var o,r;for(o in ua._bdb={},ua._boards=e.boards,ua._means=e.means,e.boards)for(r in e.boards[o])ua._bdb[[o,e.boards[o][r][0],e.boards[o][r][1],e.boards[o][r][2]].join(",")]=e.boards[o][r];$(".rounds label").on("click",pa.Crossword.onRound),pa.Crossword.drawDisplay(),clearInterval(ua._tTime),ua._tTime=u(le,na),je("jaqwi")},pa.Crossword.turnGoing=pa.Jaqwi.turnGoing,pa.Crossword.turnHint=function(e){qe("fail")},pa.Typing.roundReady=function(e){ua.room.game.title.length,ua._chatter=ta?oa.game.hereText:oa.talk,se(),ua._round=e.round,ua._roundTime=1e3*ua.room.time,ua._fastTime=1e4,ua._list=e.list.concat(e.list),ua.chain=0,a(),ne(e.round),qe("round_start"),ie("roundReady")},pa.Typing.spaceOn=function(){ua.room.opts.proverb||(ua._spaced=!0,$("body").on("keydown","#"+ua._chatter.attr("id"),e))},pa.Typing.spaceOff=function(){delete ua._spaced,$("body").off("keydown","#"+ua._chatter.attr("id"),e)},pa.Typing.turnStart=function(e){ua._spectate||(oa.game.here.show(),ta?oa.game.hereText.val("").focus():oa.talk.val("").focus(),pa.Typing.spaceOn()),ea.onmessage=_onMessage,clearInterval(ua._tTime),ua._tTime=u(le,na),ua._roundTime=e.roundTime,je("jaqwi"),ie("turnStart")},pa.Typing.turnGoing=pa.Jaqwi.turnGoing,pa.Typing.turnEnd=function(e,o){var r=$("<div>").addClass("deltaScore").html("+"+o.score),i=$("#game-user-"+e);o.error?(ua.chain++,a(),qe("fail")):o.ok?(ua.id==e?(ua.chain++,a(),qe("mission"),$e(o.value,"")):ua._spectate&&qe("mission"),me(e,o.score),ce(i,r),N(e,de(e))):(clearInterval(ua._tTime),pa.Typing.spaceOff(),oa.game.here.hide(),Re(),qe("horr"),p(s,1e3,o.speed),ua._round<ua.room.round&&t(10))},pa.Hunmin.roundReady=function(e){ua.room.game.title.length,se(),ua._roundTime=1e3*ua.room.time,oa.game.display.html(ua._char="&lt;"+e.theme+"&gt;"),oa.game.chain.show().html(ua.chain=0),ua.room.opts.mission&&oa.game.items.show().css("opacity",1).html(ua.mission=e.mission),ne(e.round),qe("round_start"),ie("roundReady")},pa.Hunmin.turnStart=function(e){ua.room.game.turn=e.turn,e.seq&&(ua.room.game.seq=e.seq),ua._tid=ua.room.game.seq[e.turn],ua._tid.robot&&(ua._tid=ua._tid.id),e.id=ua._tid,oa.game.display.html(ua._char),$("#game-user-"+e.id).addClass("game-user-current"),ua._replay||(oa.game.here.css("display",e.id==ua.id?"block":"none"),e.id==ua.id&&(ta?oa.game.hereText.val("").focus():oa.talk.focus())),oa.game.items.html(ua.mission=e.mission),ea.onmessage=_onMessage,clearInterval(ua._tTime),ua._chars=[e.char,e.subChar],ua._speed=e.speed,ua._tTime=u(le,na),ua.turnTime=e.turnTime,ua._turnTime=e.turnTime,ua._roundTime=e.roundTime,ua._turnSound=qe("T"+e.speed),ie("turnStart")},pa.Hunmin.turnGoing=pa.Classic.turnGoing,pa.Hunmin.turnEnd=function(e,a){var o,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");ua._turnSound.stop(),me(e,a.score),clearInterval(ua._tTime),a.ok?(clearTimeout(ua._fail),oa.game.here.hide(),oa.game.chain.html(++ua.chain),be(a.value,a.mean,a.theme,a.wc)):(r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),oa.game.here.hide(),qe("timeout")),a.hint&&(a.hint=a.hint._id,-1==(o=a.hint.indexOf(ua._chars[0]))&&(o=a.hint.indexOf(ua._chars[1])),oa.game.display.empty().append($("<label>").html(a.hint.slice(0,o+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(o+1)))),a.bonus&&(ta?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ce(t,e)},500)),ce(t,r).removeClass("game-user-current"),N(e,de(e))},pa.Daneo.roundReady=function(e){ua.room.game.title.length,se(),ua._roundTime=1e3*ua.room.time,oa.game.display.html(ua._char="&lt;"+L["theme_"+e.theme]+"&gt;"),oa.game.chain.show().html(ua.chain=0),ua.room.opts.mission&&oa.game.items.show().css("opacity",1).html(ua.mission=e.mission),ne(e.round),qe("round_start"),ie("roundReady")},pa.Daneo.turnStart=function(e){ua.room.game.turn=e.turn,e.seq&&(ua.room.game.seq=e.seq),ua._tid=ua.room.game.seq[e.turn],ua._tid.robot&&(ua._tid=ua._tid.id),e.id=ua._tid,oa.game.display.html(ua._char),$("#game-user-"+e.id).addClass("game-user-current"),ua._replay||(oa.game.here.css("display",e.id==ua.id?"block":"none"),e.id==ua.id&&(ta?oa.game.hereText.val("").focus():oa.talk.focus())),oa.game.items.html(ua.mission=e.mission),ea.onmessage=_onMessage,clearInterval(ua._tTime),ua._chars=[e.char,e.subChar],ua._speed=e.speed,ua._tTime=u(le,na),ua.turnTime=e.turnTime,ua._turnTime=e.turnTime,ua._roundTime=e.roundTime,ua._turnSound=qe("T"+e.speed),ie("turnStart")},pa.Daneo.turnGoing=pa.Classic.turnGoing,pa.Daneo.turnEnd=function(e,a){var o,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");ua._turnSound.stop(),me(e,a.score),clearInterval(ua._tTime),a.ok?(clearTimeout(ua._fail),oa.game.here.hide(),oa.game.chain.html(++ua.chain),be(a.value,a.mean,a.theme,a.wc)):(r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),oa.game.here.hide(),qe("timeout")),a.hint&&(a.hint=a.hint._id,-1==(o=a.hint.indexOf(ua._chars[0]))&&(o=a.hint.indexOf(ua._chars[1])),oa.game.display.empty().append($("<label>").html(a.hint.slice(0,o+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(o+1)))),a.bonus&&(ta?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ce(t,e)},500)),ce(t,r).removeClass("game-user-current"),N(e,de(e))},pa.Sock.roundReady=function(e,a){e.seq&&e.seq.indexOf(ua.id),se(),ua._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),ua._va=[],ua._lang=Xe[He[ua.room.mode]].lang,ua._board=e.board,ua._maps=[],ua._roundTime=1e3*ua.room.time,ua._fastTime=1e4,oa.game.items.hide(),oa.game.bb.show(),pa.Sock.drawDisplay(),ne(e.round),a||qe("round_start"),clearInterval(ua._tTime)},pa.Sock.turnEnd=function(e,a){var o,r,t,i=$("<div>").addClass("deltaScore").html("+"+a.score),s=$("#game-user-"+e);if(a.score){for(t=(o=a.value).length,ua._maps.push(o),r=0;r<t;r++)ua._board=ua._board.replace(o.charAt(r),"　");qe(e==ua.id?"success":"mission"),pa.Sock.drawDisplay(),me(e,a.score),N(e,de(e)),ce(s,i)}else Re(),ua._relay=!1,qe("horr")},pa.Sock.drawMaps=function(){oa.game.bb.empty(),ua._maps.sort(function(e,a){return a.length-e.length}).forEach(function(e){oa.game.bb.append(function(e){var a,o=$("<div>").addClass("bb-word"),r=e.length;for(a=0;a<r;a++)o.append($("<div>").addClass("bb-char").html(e.charAt(a)));return o}(e))})},pa.Sock.drawDisplay=function(){var e,a=$("<div>").css("height","100%"),o=ua._board.split(""),r="ko"==ua._lang?"12.5%":"10%";o.forEach(function(o,t){a.append(e=$("<div>").addClass("sock-char sock-"+o).css({width:r,height:r}).html(o)),ua._va[t]&&ua._va[t]!=o&&e.html(ua._va[t]).addClass("sock-picked").animate({opacity:0},500)}),ua._va=o,oa.game.display.empty().append(a),pa.Sock.drawMaps()},pa.Sock.turnStart=function(e,a){clearInterval(ua._tTime),ua._tTime=u(le,na),je("jaqwi")},pa.Sock.turnGoing=pa.Jaqwi.turnGoing,pa.Sock.turnHint=function(e){qe("fail")};var ba=0,$a=0;delete window.WebSocket,delete window.setInterval}();