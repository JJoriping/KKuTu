!function(){function e(e){32==e.keyCode&&(eo.chatBtn.trigger("click"),e.preventDefault())}function a(){var e=co._list.slice(co.chain),o=co.room.opts.proverb?1:5,r="",a=e[0].length;a>=20&&(r="18px"),a>=50&&(r="15px"),eo.game.display.css("font-size",r),e[0]="<label style='color: #FFFF44;'>"+e[0]+"</label>",eo.game.display.html(e.slice(0,o).join(" ")),eo.game.chain.show().html(co.chain),$(".jjo-turn-time .graph-bar").width("100%").html(e.slice(o,2*o).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function t(e){$(".jjo-turn-time .graph-bar").html(e+L.afterRun),e>0&&p(t,1e3,e-1)}function s(e){var o;for(o in e)$("#game-user-"+o+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(e[o]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}function n(e,o){var r=e.toString();return"000000000000000".slice(0,Math.max(0,o-r.length))+r}function l(e,o,r){var a,t={type:e},i=r?Xe:Ze||Xe;for(a in o)t[a]=o[a];if("test"!=e&&bo++>10){if(++vo>=3)return i.close();bo=5}i.send(JSON.stringify(t))}function d(e){e?$("#Intro").is(":visible")?(eo.loading.hide(),$("#intro-text").html(e)):eo.loading.show().html(e):eo.loading.hide()}function m(e,o){var r=[$(window).width(),$(window).height()];return!o&&e.is(":visible")?(e.hide(),!1):($(".dialog-front").removeClass("dialog-front"),e.show().addClass("dialog-front").css({left:.5*(r[0]-e.width()),top:.5*(r[1]-e.height())}),!0)}function c(e){co.opts=e,co.muteBGM=co.opts.mb,co.muteEff=co.opts.me,$("#mute-bgm").attr("checked",co.muteBGM),$("#mute-effect").attr("checked",co.muteEff),$("#deny-invite").attr("checked",co.opts.di),$("#deny-whisper").attr("checked",co.opts.dw),$("#deny-friend").attr("checked",co.opts.df),$("#auto-ready").attr("checked",co.opts.ar),$("#sort-user").attr("checked",co.opts.su),$("#only-waiting").attr("checked",co.opts.ow),$("#only-unlock").attr("checked",co.opts.ou),co.bgm&&(co.muteBGM?(co.bgm.volume=0,co.bgm.stop()):(co.bgm.volume=1,co.bgm=Te(co.bgm.key,!0)))}function u(e,o,r,a,t,i,s){var n=fo(e,o,r,a,t,i,s);return co._timers.push(n),n}function p(e,o,r,a,t,i,s){var n=ho(e,o,r,a,t,i,s);return co._timers.push(n),n}function g(e,o,r,a,t,i){if(co.room){var s=ze[We[co.room.mode]];if(!s)return null;uo[s.rule][e].call(this,o,r,a,t,i)}}function f(e){var o,r;switch(e.type){case"recaptcha":var a=$("#intro-text");a.empty(),a.html("게스트는 캡챠 인증이 필요합니다.<br/>로그인을 하시면 캡챠 인증을 건너뛰실 수 있습니다.<br/><br/>"),a.append($('<div class="g-recaptcha" id="recaptcha" style="display: table; margin: 0 auto;"></div>')),grecaptcha.render("recaptcha",{sitekey:e.siteKey,callback:function(e){Xe.send(JSON.stringify({type:"recaptcha",token:e}))}});break;case"welcome":co.id=e.id,co.guest=e.guest,co.nickname=e.nickname,co.admin=e.admin,co.users=e.users,co.robots={},co.rooms=e.rooms,co.place=0,co.friends=e.friends,co._friends={},co._playTime=e.playTime,co._okg=e.okg,co._gaming=!1,co.box=e.box,e.test&&alert(L.welcomeTestServer),location.hash[1]&&Re(location.hash.slice(1)),C(void 0,!0),Te("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),p(function(){$("#Intro").hide()},2e3),co.admin&&console.log("관리자 모드"),e.caj&&function(){if(!confirm(L.checkAgeAsk))return l("caj",{answer:"no"},!0);for(;;){for(var e=[],o=1;o<=3;){var r=prompt(L["checkAgeInput"+o]);if(r&&!isNaN(r=Number(r)))1==o&&(r<1e3||r>2999)?alert(r+"\n"+L.checkAgeNo):2==o&&(r<1||r>12)?alert(r+"\n"+L.checkAgeNo):3==o&&(r<1||r>31)?alert(r+"\n"+L.checkAgeNo):e[o++-1]=r;else if(--o<1)break}if(4==o){if(confirm(L.checkAgeSure+"\n"+e[0]+L.YEAR+" "+e[1]+L.MONTH+" "+e[2]+L.DATE))return l("caj",{answer:"yes",input:[e[1],e[2],e[0]]},!0)}else if(confirm(L.checkAgeCancel))return l("caj",{answer:"no"},!0)}}(),U();break;case"conn":co.setUser(e.user.id,e.user),j();break;case"disconn":co.setUser(e.id,null),j();break;case"connRoom":co._preQuick&&(je("success"),eo.dialog.quick.hide(),delete co._preQuick),eo.dialog.quick.hide(),co.setUser(e.user.id,e.user),(r=co.usersR[e.user.id]=e.user).id==co.id?d():Be((r.profile.title||r.profile.name)+L.hasJoined),j();break;case"disconnRoom":(r=co.usersR[e.id])&&(delete co.usersR[e.id],Be((r.profile.title||r.profile.name)+L.hasLeft),j());break;case"yell":Ve(e.value),Be(e.value,L.yell);break;case"dying":Ve(L.dying),Be(L.dying,L.yell);break;case"tail":Be(e.a+"|"+e.rid+"@"+e.id+": "+(e.msg instanceof String?e.msg:JSON.stringify(e.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"tail");break;case"chat":e.notice?Be(L["error_"+e.code]):De(e.profile||{title:L.robot},e.value,e.from,e.timestamp);break;case"roomStuck":Ze.close();break;case"preRoom":!function(e,o){var r=co.URL.replace(/:(\d+)/,function(o,r){return":"+(Number(r)+416+Number(e)-1)})+"&"+e+"&"+o;Ze||(Ze=new go(r),d(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){d(),Ze&&Ze.close()}),Ze.onopen=function(r){console.log("room-conn",e,o)},Ze.onmessage=_onMessage,Ze.onclose=function(r){console.log("room-disc",e,o),Ze=void 0},Ze.onerror=function(e){console.warn(L.error,e)})}(e.channel,e.id);break;case"room":(function(e){var o,r,a,t;if(e.myRoom=co.place==e.room.id||e.target==co.id,e.myRoom){if($target=co.users[e.target],e.kickVote&&(Be(h($target.profile,e.kickVote)),$target.id==e.id&&alert(L.hasKicked)),-1==e.room.players.indexOf(co.id))co.room&&co.room.gaming&&(qe(),co.practicing=!1,co._gaming=!1,eo.box.room.height(360),Te("lobby")),co.users[co.id].game.ready=!1,co.users[co.id].game.team=0,co.users[co.id].game.form="J",eo.menu.spectate.removeClass("toggled"),eo.menu.ready.removeClass("toggled"),co.room=null,co.resulting=!1,co._players=null,co._master=null,co.place=0,e.room.practice&&(delete co.users[0],co.room=co._room,co.place=co._place,co.master=co.__master,co._players=co.__players,delete co._room);else if(e.room.practice&&!co.practicing&&(co.practicing=!0,co._room=co.room,co._place=co.place,co.__master=co.master,co.__players=co._players),co.room&&(co._players=co.room.players.toString(),co._master=co.room.master,co._rTitle=co.room.title,co._rMode=Ce(co.room.mode,co.room.opts,!0),co._rLimit=co.room.limit,co._rRound=co.room.round,co._rTime=co.room.time),co.room=e.room,co.place=co.room.id,co.master=co.room.master==co.id,e.spec&&e.target==co.id){if(co._spectate||(co._spectate=!0,te(),ie()),e.boards){for(o in co.selectedRound=1,e.prisoners)for(r in a=o.split(","),e.boards[a[0]])if((t=e.boards[a[0]][r])[0]==a[1]&&t[1]==a[2]&&t[2]==a[3]){t[4]=e.prisoners[o];break}uo.Crossword.roundReady(e,!0),uo.Crossword.turnStart(e,!0)}for(o in e.spec)co.users[o].game.score=e.spec[o]}e.modify||e.target!=co.id||Ae()}if(e.target&&co.users[e.target]&&(-1==e.room.players.indexOf(e.target)?co.users[e.target].place=0:co.users[e.target].place=e.room.id),!e.room.practice)if(e.room.players.length)for(o in co.setRoom(e.room.id,e.room),e.room.readies)co.users[o]&&(co.users[o].game.ready=e.room.readies[o].r,co.users[o].game.team=e.room.readies[o].t);else co.setRoom(e.room.id,null)})(e),function(e){if(co._players&&co.room){var o,r,a={}+"",t=co._players.split(",");t.length,co.room.players.length;for(o in t)t[o]==a&&0;for(o in co.room.players)co.room.players[o].robot&&0;if(e){for(o in t)t[o]!=a&&(co.users[t[o]].game.ready=!1);Be(L.hasModified)}co._gaming!=co.room.gaming&&(co.room.gaming?(Q(),co._replay=!1,function(e){var o,r;for(o in oo={version:co.version,me:co.id,players:[],events:[],title:co.room.title,roundTime:co.room.time,round:co.room.round,mode:co.room.mode,limit:co.room.limit,game:co.room.game,opts:co.room.opts,readies:co.room.readies,time:(new Date).getTime()},co.room.players){var a;r=co.users[co.room.players[o]]||co.room.players[o],a={id:r.id,score:0},r.robot?(a.id=r.id,a.robot=!0,a.data={score:0},r={profile:B(r.level)}):(a.data=r.data,a.equip=r.equip),a.title="#"+r.id,oo.players.push(a)}co._record=!0}(co.room.game.title)):(co._spectate?(eo.dialog.resultSave.hide(),co._spectate=!1,Te("lobby")):(eo.dialog.resultSave.show(),co.resulting=!0),clearInterval(co._tTime))),co._master!=co.room.master&&Be(((r=co.users[co.room.master]).profile.title||r.profile.name)+L.hasMaster),co._players=co.room.players.toString(),co._master=co.room.master,co._gaming=co.room.gaming}}(e.modify&&e.myRoom),C(e.myRoom),e.modify&&co.room&&e.myRoom&&(co._rTitle!=co.room.title&&x(".room-head-title"),co._rMode!=Ce(co.room.mode,co.room.opts,!0)&&x(".room-head-mode"),co._rLimit!=co.room.limit&&x(".room-head-limit"),co._rRound!=co.room.round&&x(".room-head-round"),co._rTime!=co.room.time&&x(".room-head-time"));break;case"user":co.setUser(e.id,e),co.room&&C(co.room.id==e.place);break;case"friends":for(o in co._friends={},e.list)e.list[o].forEach(function(e){co._friends[e]={server:o}});U();break;case"friend":co._friends[e.id]={server:"on"==e.stat&&e.s},co._friends[e.id]&&co.friends[e.id]&&Be(("on"==e.stat?"&lt;<b>"+L["server_"+co._friends[e.id].server]+"</b>&gt; ":"")+L.friend+" "+co.friends[e.id]+L["fstat_"+e.stat]),U();break;case"friendAdd":r=co.users[e.from].profile,o=(r.title||r.name)+"(#"+e.from.substr(0,5)+")",l("friendAddRes",{from:e.from,res:!co.opts.df&&confirm(o+L.attemptFriendAdd)},!0);break;case"friendAddRes":r=co.users[e.target].profile,Be((o=(r.title||r.name)+"(#"+e.target.substr(0,5)+")")+L["friendAddRes_"+(e.res?"ok":"no")]),e.res&&(co.friends[e.target]=r.title||r.name,co._friends[e.target]={server:co.server},U());break;case"friendEdit":co.friends=e.friends,U();break;case"starting":d(L.gameLoading);break;case"roundReady":g("roundReady",e);break;case"turnStart":g("turnStart",e);break;case"turnError":!function(e,o){eo.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+e]?L["turnError_"+e]+": ":"")+o)),je("fail"),clearTimeout(co._fail),co._fail=p(function(){eo.game.display.html(co._char)},1800)}(e.code,e.value);break;case"turnHint":g("turnHint",e);break;case"turnEnd":e.score=Number(e.score),e.bonus=Number(e.bonus),co.room&&(co._tid=e.target||co.room.game.seq[co.room.game.turn],co._tid&&(co._tid.robot&&(co._tid=co._tid.id),function(e,o){g("turnEnd",e,o)}(co._tid,e)),e.baby&&je("success"));break;case"roundEnd":for(o in e.users)co.setUser(o,e.users[o]);co._resultRank=e.ranks,function(e,o){function r(e){var o,t,i;co._result.goal=so[co._result.level-1],co._result.before=so[co._result.level-2]||0,co._result.reward.score>0&&((o=co._result.reward.score*co._coef)<.05&&co._coef&&(o=co._result.reward.score),co._result.reward.score-=o,co._result.exp+=o,t=_e(co._result.exp),co._result.level!=t&&(co._result._boing-=co._result.goal-co._result._exp,co._result._exp=co._result.goal,je("lvup")),co._result.level=t,p(r,50)),i=co._result.exp-co._result._exp,a("before",co._result._exp,co._result.before,co._result.goal),a("current",Math.min(i,co._result._boing),0,co._result.goal-co._result.before),a("bonus",Math.max(0,i-co._result._boing),0,co._result.goal-co._result.before),$(".result-me-level-body").html(co._result.level),$(".result-me-score-text").html(Je(Math.round(co._result.exp))+" / "+Je(co._result.goal))}function a(e,o,r,a){$(".result-me-"+e+"-bar").width((o-r)/(a-r)*100+"%")}o||(o={});var t,i,s,n,l,d,c,u,g,f=$(".result-board").empty();for(t in $(".result-me-expl").empty(),eo.game.display.html(L.roundEnd),co._resultPage=1,co._result=null,e)s=e[t],(i=co._replay?oo.users[s.id]:co.users[s.id])||(i=to),i.data&&s.reward&&(s.reward.score=co._replay?0:Math.round(s.reward.score),d=_e(c=i.data.score)>_e(i.data.score-s.reward.score),f.append(n=$("<div>").addClass("result-board-item").append(l=$("<div>").addClass("result-board-rank").html(s.rank+1)).append(ye(c).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(i.profile.title||i.profile.name)).append($("<div>").addClass("result-board-score").html(o.scores?L.avg+" "+Je(o.scores[s.id])+L.kpm:Je(s.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(s.reward.score?"+"+Je(s.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",d?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(L.lvUp)))),i.game.team&&l.addClass("team-"+i.game.team),s.id==co.id&&(s.exp=i.data.score-s.reward.score,s.level=_e(s.exp),co._result=s,n.addClass("result-board-me"),$(".result-me-expl").append(function(e,o,r){function a(e,o,r){e.append($("<h5>").addClass("result-me-blog-head").html(o)).append($("<h5>").addClass("result-me-blog-body").html(r))}var t,i,s=$("<div>").append($("<h4>").html(L.scoreGain)).append(t=$("<div>")).append($("<h4>").html(L.moneyGain)).append(i=$("<div>"));return a(t,L.scoreOrigin,e),a(i,L.moneyOrigin,o),r.forEach(function(r){var s,n,l,d=r.charAt(0),m=r.charAt(1),c=r.slice(2,5),u=Number(r.slice(5));"EXP"==c?(s=t,l=e):"MNY"==c&&(s=i,l=o),"g"==m?n="+"+(l*u).toFixed(1):"h"==m&&(n="+"+Math.floor(u)),a(s,L["bonusFrom_"+d],n)}),s}(s.reward._score,s.reward._money,s.reward._blog))));$(".result-me").css("opacity",0),co._coef=0,co._result&&(u=co._result.reward.score-co._result.reward._score,g=co._result.reward.money-co._result.reward._money,co._result._exp=co._result.exp,co._result._score=co._result.reward.score,co._result._bonus=u,co._result._boing=co._result.reward._score,co._result._addit=u,co._result._addp=g,u=u>0?"<label class='result-me-bonus'>(+"+Je(u)+")</label>":"",g=g>0?"<label class='result-me-bonus'>(+"+Je(g)+")</label>":"",Be(L.scoreGain+": "+Je(co._result.reward.score)+", "+L.moneyGain+": "+Je(co._result.reward.money)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+Je(co._result.reward.score)+u),$(".result-me-money").html(L.moneyGain+" +"+Je(co._result.reward.money)+g)),p(function(){m(eo.dialog.result),co._result&&r(!0),eo.dialog.result.css("opacity",0).animate({opacity:1},500),p(function(){co._coef=.05},500)},2e3),co._record=!1}(e.result,e.data);break;case"kickVote":co._kickTarget=co.users[e.target],co.id!=e.target&&co.id!=co.room.master&&function(e){var o=co.users[e].profile;$("#kick-vote-text").html((o.title||o.name)+L.kickVoteText),co.kickTime=10,co._kickTime=10,co._kickTimer=p(ce,1e3),m(eo.dialog.kickVote)}(e.target),Be((co._kickTarget.profile.title||co._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":Be(h(co._kickTarget.profile,e));break;case"invited":l("inviteRes",{from:e.from,res:!co.opts.di&&confirm(e.from+L.invited)});break;case"inviteNo":Be(((r=co.users[e.target]).profile.title||r.profile.name)+L.inviteDenied);break;case"okg":co._playTime>e.time?Be(L.okgExpired):co._okg!=e.count&&Be(L.okgNotice+" ("+L.okgCurrent+e.count+")"),co._playTime=e.time,co._okg=e.count;break;case"obtain":Ie(e);break;case"expired":for(o in e.list)Be(Me(e.list[o])+L.hasExpired);break;case"blocked":Be(L.blocked);break;case"test":(co._test=!co._test)?(co._testt=u(function(){eo.talk.val()!=co._ttv&&(l("test",{ev:"c",v:eo.talk.val()},!0),co._ttv=eo.talk.val())},100),document.onkeydown=function(e){l("test",{ev:"d",c:e.keyCode},!0)},document.onkeyup=function(e){l("test",{ev:"u",c:e.keyCode},!0)}):(clearInterval(co._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":if(o=e.message||"",401==e.code);else if(403==e.code)d();else if(406==e.code){if(eo.dialog.quick.is(":visible")){co._preQuick=!1;break}}else if(409==e.code)o=L["server_"+o];else{if(416==e.code)return void(confirm(L["error_"+e.code])&&(Se(),co._spectate=!0,co._gaming=!0,l("enter",{id:e.target,password:co._pw,spectate:!0},!0)));if(413==e.code)eo.dialog.room.hide(),eo.menu.setRoom.trigger("click");else if(429==e.code)Te("lobby");else if(430==e.code){if(co.setRoom(e.message,null),eo.dialog.quick.is(":visible")){co._preQuick=!1;break}}else if(431==e.code||432==e.code||433==e.code)eo.dialog.room.show();else if(444==e.code){if(-1!=(o=e.message).indexOf("생년월일")){alert("생년월일이 올바르게 입력되지 않아 게임 이용이 제한되었습니다. 잠시 후 다시 시도해 주세요.");break}}else if(447===e.code){alert("자동화 봇 방지를 위한 캡챠 인증에 실패했습니다. 메인 화면에서 다시 시도해 주세요.");break}}alert("[#"+e.code+"] "+L["error_"+e.code]+o)}co._record&&ae(e)}function h(e,o){var r=L.agree+" "+o.Y+", "+L.disagree+" "+o.N+L.kickCon;return o.Y>=o.N?r+=(e.title||e.name)+L.kicked:r+=(e.title||e.name)+L.kickDenied,r}function v(e){var o,r,a={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(e[0].toLowerCase()){case"/ㄱ":case"/r":co.room&&(co.room.master==co.id?eo.menu.start.trigger("click"):eo.menu.ready.trigger("click"));break;case"/청소":case"/cls":$("#Chat").empty();break;case"/ㄹ":case"/f":m(eo.dialog.chatLog),eo.chatLog.scrollTop(999999999);break;case"/귓":case"/ㄷ":case"/e":k(e[1],e.slice(2).join(" "));break;case"/답":case"/ㄷㄷ":case"/ee":co._recentFrom?k(co._recentFrom,e.slice(1).join(" ")):Be(L.error_425);break;case"/무시":case"/wb":!function(e){co._wblock.hasOwnProperty(e)?(delete co._wblock[e],Be(e+L.wnblocked)):(co._wblock[e]=!0,Be(e+L.wblocked))}(e[1]);break;case"/차단":case"/shut":_(e.slice(1).join(" "));break;case"/id":if(e[1]){for(o in r=0,e[1]=e.slice(1).join(" "),co.users)(co.users[o].profile.title||co.users[o].profile.name)==e[1]&&Be("["+ ++r+"] "+o);r||Be(L.error_405)}else Be(L.myId+co.id);break;default:for(o in a)Be(a[o],o)}}function k(e,o){o.length&&(co._whisper=e,l("talk",{whisper:e,value:o},!0),De({title:"→"+e},o,!0))}function _(e){co._shut.hasOwnProperty(e)?(delete co._shut[e],Be(e+L.userNShut)):(co._shut[e]=!0,Be(e+L.userShut))}function y(e,o){var r=(e=e.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,"")).match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";if(e.length<1)return o({error:404});$.get("/dict/"+e+"?lang="+r,o)}function w(){return co.place?co.room.gaming||co.resulting?"for-gaming":co.master?"for-master":"for-normal":"for-lobby"}function C(e,o){var r,a=w();if(co._replay){if(void 0!==e&&!e)return;re()}if(!co._replay&&("for-gaming"!=a||e)){for(r in co.practicing&&(a="for-gaming"),$(".kkutu-menu button").hide(),eo.box)eo.box[r].hide();eo.box.me.show(),eo.box.chat.show().width(790).height(190),eo.chat.height(120),"for-lobby"==a?(co._ar_first=!0,eo.box.userList.show(),co._shop?(eo.box.roomList.hide(),eo.box.shop.show()):(eo.box.roomList.show(),eo.box.shop.hide()),j(o||a!=co._only),function(e){var o,r=0;if(e)for(o in eo.lobby.roomList.empty(),co.rooms)eo.lobby.roomList.append(A(co.rooms[o])),r++;else for(o in $(".rooms-create").remove(),co.rooms)r++;eo.lobby.roomListTitle.html(L.RoomList.replace("FA{bars}","<i class='fa fa-bars'></i>")+" ["+r+L.GAE+"]"),r?($(".rooms-gaming").css("display",co.opts.ow?"none":""),$(".rooms-locked").css("display",co.opts.ou?"none":"")):eo.lobby.roomList.append(eo.lobby.createBanner.clone().on("click",function(e){eo.menu.newRoom.trigger("click")}))}(o||a!=co._only),T(),co._jamsu&&(clearTimeout(co._jamsu),delete co._jamsu)):"for-master"==a||"for-normal"==a?($(".team-chosen").removeClass("team-chosen"),co.users[co.id].game.ready||"S"==co.users[co.id].game.form?(eo.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):(eo.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+co.users[co.id].game.team).addClass("team-chosen"),co.opts.ar&&co._ar_first&&(eo.menu.ready.addClass("toggled"),eo.menu.ready.trigger("click"),co._ar_first=!1)),co._shop=!1,eo.box.room.show().height(360),"for-master"==a&&eo.dialog.inviteList.is(":visible")&&j(),P(!1),T()):"for-gaming"==a&&(co._gAnim&&(eo.box.room.show(),co._gAnim=!1),co._shop=!1,co._ar_first=!0,eo.box.me.hide(),eo.box.game.show(),$(".ChatBox").width(1e3).height(140),eo.chat.height(70),P(!0)),co._only=a,function(e){location.hash=e?"#"+e:""}(co.place),$(".kkutu-menu ."+a).show()}}function x(e){$(e).addClass("room-head-modified"),p(function(){$(e).removeClass("room-head-modified")},3e3)}function T(){var e,o=co.users[co.id],r=0,a=_e(o.data.score),t=so[a-2]||0,i=so[a-1];for(e in o.data.record)r+=o.data.record[e][1];Ke(".my-image",o.equip),$(".my-stat-level").replaceWith(ye(o.data.score).addClass("my-stat-level")),$(".my-stat-name").html(o.profile.title||o.profile.name),$(".my-stat-record").html(L.globalWin+" "+r+L.W),$(".my-stat-ping").html(Je(o.money)+L.ping),$(".my-okg .graph-bar").width(co._playTime%6e5/6e3+"%"),$(".my-okg-text").html(S(co._playTime)),$(".my-level").html(L.LEVEL+" "+a),$(".my-gauge .graph-bar").width((o.data.score-t)/(i-t)*190),$(".my-gauge-text").html(Je(o.data.score)+" / "+Je(i))}function S(e){var o=Math.floor(e/6e4)%60,r=Math.floor(.001*e)%60,a=Math.floor(e/36e5),t=[];return a&&t.push(a+L.HOURS),o&&t.push(o+L.MINUTE),a||t.push(r+L.SECOND),t.join(" ")}function j(e){var o,r,a,t=0;if(co.opts.su){for(o in a=[],co.users)t++,a.push(co.users[o]);a.sort(function(e,o){return o.data.score-e.data.score}),e=!0}else for(o in a=co.users,co.users)t++;if(eo.lobby.userListTitle.html("<i class='fa fa-users'></i>&lt;<b>"+L["server_"+co.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+t+L.MN+"]"),e)for(o in eo.lobby.userList.empty(),eo.dialog.inviteList.empty(),a)(r=a[o]).robot||(eo.lobby.userList.append(q(r)),0==r.place&&eo.dialog.inviteList.append(q(r,!0)))}function q(e,o){var r;return R(r=o?$("<div>").attr("id","invite-item-"+e.id).addClass("invite-item users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(ye(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(e.profile.title||e.profile.name)).on("click",function(e){W($(e.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+e.id).addClass("users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(ye(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(e.profile.title||e.profile.name)).on("click",function(e){V($(e.currentTarget).attr("id").slice(11))}),e),r}function R(e,o){o.equip.NIK&&e.addClass("x-"+o.equip.NIK),"b1_gm"==o.equip.BDG&&e.addClass("x-gm")}function A(e){var o,r,a=Ce(e.mode,e.opts);return o=$("<div>").attr("id","room-"+e.id).addClass("rooms-item").append(r=$("<div>").addClass("rooms-channel channel-"+e.channel).on("click",function(o){!function(e){var o=co.rooms[e],r=$("#ri-players").empty();co._roominfo=e,$("#RoomInfoDiag .dialog-title").html(e+L.sRoomInfo),$("#ri-title").html((o.password?"<i class='fa fa-lock'></i>&nbsp;":"")+o.title),$("#ri-mode").html(L["mode"+We[o.mode]]),$("#ri-round").html(o.round+", "+o.time+L.SECOND),$("#ri-limit").html(o.players.length+" / "+o.limit),o.players.forEach(function(e,a){var t,i,s=o.readies[e]||{};e=co.users[e]||to,o.players[a].robot?(e.profile={title:L.robot},e.equip={robot:!0}):s.t=s.t||0,r.append($("<div>").addClass("ri-player").append(i=$("<div>").addClass("moremi rip-moremi")).append(t=$("<div>").addClass("ellipse rip-title").html(e.profile.title||e.profile.name)).append($("<div>").addClass("rip-team team-"+s.t).html($("#team-"+s.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+s.f]))),e.id==o.master&&t.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),t.prepend(ye(e.data.score).addClass("profile-level rip-level")),Ke(i,e.equip)}),m(eo.dialog.roomInfo),eo.dialog.roomInfo.show()}(e.id)})).append($("<div>").addClass("rooms-number").html(e.id)).append($("<div>").addClass("rooms-title ellipse").text(Oe(e.title))).append($("<div>").addClass("rooms-limit").html(e.players.length+" / "+e.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(a.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+e.round)).append($("<div>").addClass("rooms-time").html(e.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(e.password?"<i class='fa fa-lock'></i>":"<i class='fa fa-unlock'></i>")).on("click",function(e){e.target!=r.get(0)&&Re($(e.currentTarget).attr("id").slice(5))}),e.gaming&&o.addClass("rooms-gaming"),e.password&&o.addClass("rooms-locked"),o}function O(e){var o,r,a,t=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append(o=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(ye(e.data.score).addClass("game-user-level")).append(a=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+_e(e.data.score)))).append(r=$("<div>").addClass("game-user-score"));return Ke(o,e.equip),global.expl(t),R(a,e),e.game.team&&r.addClass("team-"+e.game.team),t}function D(e){var o,r,a=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(ye(e.data.score).addClass("game-user-level")).append(r=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name))).append(o=$("<div>").addClass("game-user-score"));return e.id==co.id&&r.addClass("game-user-my-name"),R(r,e),e.game.team&&o.addClass("team-"+e.game.team),a}function B(e){return{title:L["aiLevel"+e]+" "+L.robot,image:"/img/kkutu/robot.png"}}function P(e){var o,r,a,t,i,s,n,l=ze[We[co.room.mode]],d=ro||l.big?D:O,m=!1,c=!0;if(Le($(".RoomBox .product-title"),co.room),Le($(".GameBox .product-title"),co.room),e){for(o in a=$(".GameBox .game-body").empty(),co.room.game.seq)(r=co._replay?oo.users[co.room.game.seq[o]]||co.room.game.seq[o]:co.users[co.room.game.seq[o]]||co.robots[co.room.game.seq[o].id]||co.room.game.seq[o]).robot&&!r.profile&&(r.profile=B(r.level),co.robots[r.id]=r),a.append(d(r)),M(r.id,r.game.score||0);clearTimeout(co._jamsu),delete co._jamsu}else{for(o in a=$(".room-users").empty(),g="S"==co.users[co.id].game.form,co.room.players)if((r=co.users[co.room.players[o]]||co.room.players[o]).game){var u=r.game.practice?"/"+L.stat_practice:"",g="S"==r.game.form&&"/"+L.stat_spectate;r.robot&&(r.profile=B(r.level),co.robots[r.id]=r),a.append($("<div>").attr("id","room-user-"+r.id).addClass("room-user").append(s=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(t=$("<div>").addClass("room-user-ready")).append(i=$("<div>").addClass("room-user-team team-"+r.game.team).html($("#team-"+r.game.team).html()))).append($("<div>").addClass("room-user-title").append(ye(r.data.score).addClass("room-user-level")).append(n=$("<div>").addClass("room-user-name").html(r.profile.title||r.profile.name))).on("click",function(e){V($(e.currentTarget).attr("id").slice(10))})),Ke(s,r.equip),g&&i.hide(),r.id==co.room.master?t.addClass("room-user-master").html(L.master+u+(g||"")):g?t.addClass("room-user-spectate").html(L.stat_spectate+u):r.game.ready||r.robot?(t.addClass("room-user-readied").html(L.stat_ready),r.robot||(m=!0)):r.game.practice?(t.addClass("room-user-practice").html(L.stat_practice),c=!1):(t.html(L.stat_noready),c=!1),R(n,r)}m&&co.room.master==co.id&&c?co._jamsu||(co._jamsu=p(E,5e3)):(clearTimeout(co._jamsu),delete co._jamsu)}eo.dialog.profile.is(":visible")&&V(co._profiled)}function E(){Be(L.subJamsu),co._jamsu=p(function(){l("leave"),alert(L.masterJamsu)},3e4)}function M(e,o){var r;return(r=co["_s"+e])?(clearTimeout(r.timer),r.$obj=$("#game-user-"+e+" .game-user-score"),r.goal=o):r=co["_s"+e]={$obj:$("#game-user-"+e+" .game-user-score"),goal:o,now:0},N(r),$("#game-user-"+e)}function N(e){var o=(e.goal-e.now)*Math.min(1,.01*io);o<.1?o=e.goal-e.now:e.timer=p(N,io,e),e.now+=o,function(e,o){var r,a=o>99999?n(Math.round(.001*o),4)+"k":n(o,5);for(e.empty(),r=0;r<a.length;r++)e.append($("<div>").addClass("game-user-score-char").html(a[r]))}(e.$obj,Math.round(e.now))}function F(e){var o=$("#dress-view"),r=co.users[co.id];Ke(o,r.equip),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-nickname").val(r.nickname),$("#dress-exordial").val(r.exordial),G(e||!0)}function I(e,o,r,a,t){var i,s,n,l,d,m,c=[],u=!0===r;for(m in e.empty(),a||(a={}),a)co.box.hasOwnProperty(a[m])||(co.box[a[m]]={value:0});for(m in co.box)c.push({key:m,obj:Ee(m),value:co.box[m]});for(m in c.sort(function(e,o){return e.obj.name<o.obj.name?-1:1}),c)s=c[m].obj,n=c[m].value,"BDG"==(l=s.group).substr(0,3)&&(l="BDG"),d="Mhand"==l?a.Mlhand==c[m].key||a.Mrhand==c[m].key:a[l]==c[m].key,"number"==typeof n&&(n={value:n}),(n.hasOwnProperty("value")||d)&&(u||-1!=r.indexOf(s.group))&&(e.append(i=$("<div>").addClass("dress-item").append(we(s.image).addClass("dress-item-image").html("x"+n.value)).append(ue(s,d,n.expire))),i.attr("id",o+"-"+s._id).on("click",t),d&&i.addClass("dress-equipped"));global.expl(e)}function G(e){var o,r=co.users[co.id].equip||{},a=!0===e;co._avGroup=e,o=!!a||(e||"").split(","),I($("#dress-goods"),"dress",o,r,function(e){var o,r=$(e.currentTarget),a=r.attr("id").slice(6),t=Ee(a);if(e.ctrlKey){if(r.hasClass("dress-equipped"))return Ue(426);if(!confirm(L.surePayback+Je(Math.round(.2*(t.cost||0)))+L.ping))return;$.post("/payback/"+a,function(e){if(e.error)return Ue(e.error);alert(L.painback),co.box=e.box,co.users[co.id].money=e.money,F(co._avGroup),C(!1)})}else if(-1!=Qe.indexOf(t.group))"Mhand"==t.group&&(o=confirm(L.dressWhichHand)),function(e,o){var r=co.users[co.id],a=co.shop[e].group;"Mhand"==a&&(a=o?"Mlhand":"Mrhand"),"BDG"==a.substr(0,3)&&(a="BDG");var t=r.equip[a]==e;confirm(L[t?"sureUnequip":"sureEquip"]+": "+L[e][0])&&$.post("/equip/"+e,{isLeft:o},function(e){if(e.error)return Ue(e.error);co.box=e.box,r.equip=e.equip,F(co._avGroup),l("refresh"),C(!1)})}(a,o);else if("CNS"==t.group){if(!confirm(L.sureConsume))return;$.post("/consume/"+a,function(e){e.exp&&Be(L.obtainExp+": "+Je(e.exp)),e.money&&Be(L.obtainMoney+": "+Je(e.money)),e.gain.forEach(function(e){Ie(e)}),co.box=e.box,co.users[co.id].data=e.data,l("refresh"),F(co._avGroup),T()})}})}function K(){function e(){a.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function o(){var o,s={WPC:1,WPB:2,WPA:3},l="",d=0;a.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),co._tray.forEach(function(e){o=Ee(e),l+=e.slice(4),d+=s[e.slice(1,4)],a.append($("<div>").addClass("jt-image").css("background-image","url("+o.image+")").attr("id","cf-tray-"+e).on("click",r)),$("#cf-\\"+e).addClass("cf-tray-selected")}),t.html(L.searching),i.empty(),eo.dialog.cfCompose.removeClass("cf-composable"),n.html(""),y(l,function(e){var o=!1;if(e.error){if(3!=l.length)return t.html(L["wpFail_"+e.error]);o=!0,t.html(L.cfBlend)}(function(e,o,r){$.get("/cf/"+e+"?l="+o+"&b="+(r?"1":""),function(e){if(e.error)return Ue(e.error);i.empty(),e.data.forEach(function(e){var o=Ee(e.key),r=e.rate>=1?L.cfRewAlways:(100*e.rate).toFixed(1)+"%";i.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+o.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(o.name)).append($("<div>").addClass("cf-rew-value").html("x"+e.value))).append($("<div>").addClass("cf-rew-rate").html(r)))}),n.html(L.cfCost+": "+e.cost+L.ping)})})(l,d,o),eo.dialog.cfCompose.addClass("cf-composable"),e.error||t.html(be(e.word,e.mean,e.theme,e.type.split(",")))}),""==l&&e()}function r(e){var r=$(e.currentTarget).attr("id").slice(8),a=co._tray.indexOf(r);-1!=a&&(co._tray.splice(a,1),o())}var a=$("#cf-tray"),t=$("#cf-dict"),i=$("#cf-reward"),s=$("#cf-goods"),n=$("#cf-cost");co._tray=[],t.empty(),i.empty(),n.html(""),eo.dialog.cfCompose.removeClass("cf-composable"),I(s,"cf",["PIX","PIY","PIZ"],null,function(e){var r,a=$(e.currentTarget).attr("id").slice(3),t=co.box[a],i=0;if(co._tray.length>=6)return Ue(435);for(r in co._tray)co._tray[r]==a&&i++;t-i>0?(co._tray.push(a),o()):Ue(434)}),e()}function J(e){var o=eo.dialog.lbTable.empty(),r=e.data[0]?e.data[0].rank:0,a=(e.page||Math.floor(r/20))+1;e.data.forEach(function(e,r){var a=co.users[e.id];a=a?a.profile.title||a.profile.name:L.hidden,e.score=Number(e.score),o.append($("<tr>").attr("id","ranking-"+e.id).addClass("ranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(ye(e.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html(_e(e.score)))).append($("<td>").html(a)).append($("<td>").html(Je(e.score))))}),$("#ranking-"+co.id).addClass("ranking-me"),eo.dialog.lbPage.html(L.page+" "+a),eo.dialog.lbPrev.attr("disabled",a<=1),eo.dialog.lbNext.attr("disabled",e.data.length<15),eo.dialog.lbMe.attr("disabled",!!co.guest),co._lbpage=a-1}function U(){function e(e){var o=$(e.currentTarget).parent().parent().attr("id").slice(4),r=co.friends[o],a=prompt(L.friendEditMemo,r);a&&l("friendEdit",{id:o,memo:a},!0)}function o(e){var o=$(e.currentTarget).parent().parent().attr("id").slice(4),r=co.friends[o];if(co._friends[o].server)return Ue(455);confirm(r+"(#"+o.substr(0,5)+")\n"+L.friendSureRemove)&&l("friendRemove",{id:o},!0)}var r,a,t,i,s=0;for(r in eo.dialog.commFriends.empty(),co.friends)s++,i=co.friends[r],a=co._friends[r]||{},t=(co.users[r]||{}).profile,eo.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+r).append($("<div>").addClass("cfi-status cfi-stat-"+(a.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(a.server?L["server_"+a.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(t?t.title||t.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(i)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("fa fa-pencil").on("click",e)).append($("<i>").addClass("fa fa-remove").on("click",o))));$("#CommunityDiag .dialog-title").html(L.communityText+" ("+s+" / 100)")}function V(e){var o,r,a,t=co.users[e]||co.robots[e],i=$("#profile-record").empty();if(t){if($("#ProfileDiag .dialog-title").html((t.profile.title||t.profile.name)+L.sProfile),$(".profile-head").empty().append(o=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append(we(t.profile.image).addClass("profile-image")).append($("<div>").addClass("profile-title ellipse").html(t.profile.title||t.profile.name).append($("<label>").addClass("profile-tag").html(" #"+t.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").append(ye(t.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(a=_e(t.data.score)))).append($("<div>").addClass("profile-score-text").html(Je(t.data.score)+" / "+Je(so[a-1])+L.PTS))).append(r=$("<div>").addClass("profile-head-item profile-exordial ellipse").text(Oe(t.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(t.exordial))),t.robot)eo.dialog.profileLevel.show(),eo.dialog.profileLevel.prop("disabled",co.id!=co.room.master),$("#profile-place").html(co.room.id+L.roomNumber);else{for(a in eo.dialog.profileLevel.hide(),$("#profile-place").html(t.place?t.place+L.roomNumber:L.lobby),t.data.record){var s=t.data.record[a];i.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+a])).append($("<div>").addClass("profile-field-record").html(s[0]+L.P+" "+s[1]+L.W)).append($("<div>").addClass("profile-field-score").html(Je(s[2])+L.PTS)))}Ke(o,t.equip)}co._profiled=e,eo.dialog.profileKick.hide(),eo.dialog.profileShut.hide(),eo.dialog.profileDress.hide(),eo.dialog.profileWhisper.hide(),eo.dialog.profileHandover.hide(),co.id==e?eo.dialog.profileDress.show():t.robot||(eo.dialog.profileShut.show(),eo.dialog.profileWhisper.show()),co.room&&co.id!=e&&co.id==co.room.master&&(eo.dialog.profileKick.show(),eo.dialog.profileHandover.show()),m(eo.dialog.profile),eo.dialog.profile.show(),global.expl(r)}else Be(L.error_405)}function W(e){var o;("AI"==e||(o=co.users[e].profile.title||co.users[e].profile.name,confirm(o+L.sureInvite)))&&l("invite",{target:e})}function H(e){co._replay||co.lastFail!=co.id||co.id!=e?co.failCombo=0:(co.failCombo++,1==co.failCombo&&Be(L.trollWarning),co.failCombo>1&&(l("leave"),Ue(437))),co.lastFail=e}function Q(){var e;for(e in co.room.players)(co._replay?oo.users[co.room.players[e]]||co.room.players[e]:co.users[co.room.players[e]]||co.robots[co.room.players[e].id]).game.score=0,delete co["_s"+co.room.players[e]];delete co.lastFail,co.failCombo=0,co._spectate=-1==co.room.game.seq.indexOf(co.id),co._gAnim=!0,eo.box.room.show().height(360).animate({height:1},500),eo.box.game.height(1).animate({height:410},500),Se(),eo.dialog.resultSave.attr("disabled",!1),te(),eo.game.display.html(L.soon),je("game_start"),Ae(),p(function(){eo.box.room.height(360).hide(),eo.chat.scrollTop(999999999)},500)}function z(){var e;for(e in co.room.game.seq)co.room.game.seq[e].robot&&(co.room.game.seq[e].game.score=0);for(e in oo.users={},oo.players){var o=oo.players[e].id,r=oo.readies[o]||{},a=co.users[o]||co.robots[o],t=o;oo.players[e].robot?(a=oo.users[o]={robot:!0},(t=oo.players[e]).game={}):a=oo.users[o]={},co.room.players.push(t),a.id=t,a.profile=oo.players[e],a.data=a.profile.data,a.equip=a.profile.equip,a.game={score:0,team:r.t}}co._rf=0}function Y(e){var o,r,a=co.room.events[--co._rf];if(a){o=a.time;do{if(!(a=co.room.events[--co._rf]))break}while(o-a.time<1e3);for(r=co._rf-1,z(),o=co.muteEff,co.muteEff=!0,i=0;i<r;i++)oe();$(".deltaScore").remove(),co.muteEff=o,oe()}}function X(e){var o=co._rpause=!co._rpause;$(e.target).html(o?L.replayResume:L.replayPause)}function Z(e){clearTimeout(co._rt),oe()}function ee(){co.$gpt.html(co._gpp+" ("+(.001*co._eventTime).toFixed(1)+L.SECOND+" / "+(.001*co._gtt).toFixed(1)+L.SECOND+")")}function oe(e){var o,r=co.room.events[co._rf];return clearTimeout(co._rt),e||co._rf++,r?co._rpause?(co._rf--,co._rt=p(oe,100)):((o=r.data).hint&&(o.hint={_id:o.hint}),"chat"==o.type&&(o.timestamp=oo.time+r.time),f(o),co._eventTime=r.time,ee(),void(co.room.events.length>co._rf?co._rt=p(oe,co.room.events[co._rf].time-r.time):re())):void re()}function re(){delete co.room,co._replay=!1,eo.box.room.height(360),clearTimeout(co._rt),C(),Te("lobby")}function ae(e){if(!co._replay&&oo){var o,r=e;if(e.hasOwnProperty("type")&&"room"!=e.type&&"obtain"!=e.type){for(o in e={},r)e[o]=r[o];e.profile&&(e.profile={id:e.profile.id,title:"#"+e.profile.id}),e.user&&(e.user={id:e.user.profile.id,profile:{id:e.user.profile.id,title:"#"+e.user.profile.id},data:{score:0},equip:{}}),oo.events.push({data:e,time:(new Date).getTime()-oo.time})}}}function te(){co._relay=!1,d(),eo.game.here.hide(),eo.dialog.result.hide(),eo.dialog.dress.hide(),eo.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),eo.game.display.empty(),eo.game.chain.hide(),eo.game.hints.empty().hide(),eo.game.cwcmd.hide(),eo.game.bb.hide(),eo.game.round.empty(),eo.game.history.empty(),eo.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function ie(e){var o;for(eo.game.round.empty(),o=0;o<co.room.round;o++)eo.game.round.append($l=$("<label>").html(co.room.game.title[o])),o+1==e&&$l.addClass("rounds-current")}function se(){g("turnGoing")}function ne(e){return co._replay?oo.users[e].game.score:(co.users[e]||co.robots[e]).game.score}function le(e,o){co._replay?oo.users[e].game.score+=o:(co.users[e]||co.robots[e]).game.score+=o}function de(e,o){return e.append(o),p(function(){o.remove()},2e3),e}function me(e){var a,t,s,n=$(".result-board").empty();if(co._resultPage=2,!e)return eo.dialog.resultOK.trigger("click");for(i in e.list)r=e.list[i],o=co.users[r.id]||{profile:{title:L.hidden}},s=r.id==co.id,n.append(a=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(ye(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(Je(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(t=$("<div>").addClass("result-board-lvup").css("display",s?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(e.prev-r.rank)))),s&&(e.prev-r.rank<=0&&t.hide(),a.addClass("result-board-me"))}function ce(){$(".kick-vote-time .graph-bar").width(co.kickTime/co._kickTime*300),--co.kickTime>0?co._kickTimer=p(ce,1e3):eo.dialog.kickVoteY.trigger("click")}function ue(e,o,r){var a,t,i=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(Me(e._id)+(o?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+e.group])).append($("<div>").addClass("dress-item-expl").html(Ne(e._id))),s=$("<div>").addClass("dress-item-opts");for(a in e.term&&i.append($("<div>").addClass("dress-item-term").html(Math.floor(e.term/86400)+L.DATE+" "+L.ITEM_TERM)),r&&i.append($("<div>").addClass("dress-item-term").html(new Date(1e3*r).toLocaleString()+L.ITEM_TERMED)),e.options)if("gif"!=a){var n=a.charAt(0);t=e.options[a],"g"==n?t="+"+(100*t).toFixed(1)+"%p":"h"==n&&(t="+"+t),s.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+a])).append($("<label>").addClass("item-opts-body").html(t)).append($("<br>"))}return t&&i.append(s),i}function pe(e){var o;$.get("/shop",function(r){for(o in co.shop={},r.goods)co.shop[r.goods[o]._id]=r.goods[o];e&&e(r)})}function ge(e){var o,r,a=$(e.currentTarget).attr("id").slice(6),t=co.shop[a],i=co.users[co.id],s=i.money,n=s-t.cost,l=L.surePurchase,d={};for(r in co.box&&co.box[a]&&(l=L.alreadyGot+" "+l),m(eo.dialog.purchase,!0),$("#purchase-ping-before").html(Je(s)+L.ping),$("#purchase-ping-cost").html(Je(t.cost)+L.ping),$("#purchase-item-name").html(L[a][0]),o=$("#purchase-ping-after").html(Je(n)+L.ping),$("#purchase-item-desc").html(n<0?L.notEnoughMoney:l),i.equip)d[r]=i.equip[r];d["Mhand"==t.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:t.group]=a,Ke("#moremi-after",d),co._sgood=a,eo.dialog.purchaseOK.attr("disabled",n<0),n<0?o.addClass("purchase-not-enough"):o.removeClass("purchase-not-enough")}function fe(e){e<1||($("#Middle").css("padding-top",e),p(function(){$("#Middle").css("padding-top",0),p(fe,50,.7*e)},50))}function he(e,o,r,a){var t,i,s,n,l,d=We[co.room.mode],m="KKT"==d,c="KAP"==d,u=ao[t=e.length],g=0,f=co.turnTime/96,h=co.turnTime/12;if(eo.game.display.empty(),u?(i="As"+co._speed,u=u.split("")):"en"==ze[d].lang&&t<10?i="As"+co._speed:(i="Al",fe(t)),s="K"+co._speed,u){for(n in u)"0"!=u[n]&&(eo.game.display.append(l=$("<div>").addClass("display-text").css({float:c?"right":"left","margin-top":-6,"font-size":36}).hide().html(c?e.charAt(t-g-1):e.charAt(g))),g++,p(function(e,o){var r={"margin-top":0};je(o),e.html()==co.mission?(je("mission"),e.css({color:"#66FF66"}),r["font-size"]=24):r["font-size"]=20,e.show().animate(r,100)},Number(n)*f,l,i));n=eo.game.display.children("div").get(0),$(n).css(c?"margin-right":"margin-left",.5*(eo.game.display.width()-20*t))}else if(g="",c)for(n=0;n<t;n++)p(function(e){je(i),e==co.mission?(je("mission"),g="<label style='color: #66FF66;'>"+e+"</label>"+g):g=e+g,eo.game.display.html(g)},Number(n)*h/t,e[t-n-1]);else for(n=0;n<t;n++)p(function(e){je(i),e==co.mission?(je("mission"),g+="<label style='color: #66FF66;'>"+e+"</label>"):g+=e,eo.game.display.html(g)},Number(n)*h/t,e[n]);p(function(){for(n=0;n<3;n++)p(function(e){if(m){if(1==e)return;je("kung")}(u?eo.game.display.children(".display-text"):eo.game.display).css("font-size",21).animate({"font-size":20},f)},n*f*2,n);p(ve,4*f,e,o,r,a),m||je(s)},h)}function ve(e,o,r,a){var t,i,s,n=a?a.split(","):[],l={};eo.game.history.prepend(t=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(e)),(i=eo.game.history.children()).length>6&&i.last().remove(),s=be(e,o,r,n),n.forEach(function(e){l[e]||L["class_"+e]&&(l[e]=!0,t.append($("<label>").addClass("history-class").html(L["class_"+e])))}),t.append(i=$("<div>").addClass("history-mean ellipse").append(s)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+s.html()+"</h5>")),global.expl(t)}function be(e,o,r,a){if(!o||-1==o.indexOf("＂"))return function(e,o){return $("<label>").addClass("word").html(o)}(0,o);var t=$("<label>").addClass("word"),i=o.split(/＂[0-9]+＂/).slice(1).map(function(e){return-1==e.indexOf("［")?[[e]]:e.split(/［[0-9]+］/).slice(1).map(function(e){return e.split(/（[0-9]+）/).slice(1)})}),s=(a&&a.map(function(e){return L["class_"+e]}),r?r.split(",").map(function(e){return L["theme_"+e]}):[]),n=i.length>1;return i.forEach(function(e,o){var r=$("<label>").addClass("word-m1"),a=e.length>1;n&&r.append($("<label>").addClass("word-head word-m1-head").html(o+1)),e.forEach(function(e,o){var t=$("<label>").addClass("word-m2"),i=e.length,n=i>1,l=s.splice(0,i);a&&t.append($("<label>").addClass("word-head word-m2-head").html(o+1)),e.forEach(function(e,o){var r=$("<label>").addClass("word-m3"),a=l.shift();n&&r.append($("<label>").addClass("word-head word-m3-head").html(o+1)),a&&r.append($("<label>").addClass("word-theme").html(a)),r.append($("<label>").addClass("word-m3-body").html(function(e){return e.replace(/\$\$[^\$]+\$\$/g,function(e){return"<equ>"+e.slice(2,e.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"≥")+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>")}(e))),t.append(r)}),r.append(t)}),t.append(r)}),t}function $e(e,o,r){var a=e+(o?"("+o+")":"");return r&&(a+="<label class='jjo-display-word-length'>("+r+")</label>"),a}function ke(e){return Math.round((.3*!(e%5)+1)*(.4*!(e%15)+1)*(.5*!(e%45)+1)*(120+60*Math.floor(e/5)+120*Math.floor(e*e/225)+180*Math.floor(e*e/2025)))}function _e(e){var o,r=so.length;for(o=0;o<r&&!(e<so[o]);o++);return o+1}function ye(e){var o=_e(e)-1,r=o%25*-100,a=-100*Math.floor(.04*o);return $("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/newlv.png')","background-position":r+"% "+a+"%","background-size":"2560%"})}function we(e){return $("<div>").addClass("jt-image").css("background-image","url('"+e+"')")}function Ce(e,o,r){var a,t=[L["mode"+We[e]]];for(a in Ye)o[Ye[a].name.toLowerCase()]&&t.push(L["opt"+Ye[a].name]);return r&&t.push(o.injpick.join("|")),r?t.toString():t}function Le(e,o){var r,a=Ce(o.mode,o.opts),t=ze[We[o.mode]];e.empty().append($("<h5>").addClass("room-head-number").html("["+(o.practice?L.practice:o.id)+"]")).append($("<h5>").addClass("room-head-title").text(Oe(o.title))).append(r=$("<h5>").addClass("room-head-mode").html(a.join(" / "))).append($("<h5>").addClass("room-head-limit").html((ro?"":L.players+" ")+o.players.length+" / "+o.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+o.round)).append($("<h5>").addClass("room-head-time").html(o.time+L.SECOND)),-1!=t.opts.indexOf("ijp")&&(r.append($("<div>").addClass("expl").html("<h5>"+o.opts.injpick.map(function(e){return L["theme_"+e]})+"</h5>")),global.expl(e))}function xe(e,o){co._lsRemain=e.length,e.forEach(function(e){!function(e,o,r){function a(r){lo[e]=new i(o),t()}function t(){0==--co._lsRemain?r&&r():d(L.loadRemain+co._lsRemain)}function i(e){var o=this;this.audio=new Audio(e),this.audio.load(),this.start=function(){o.audio.play()},this.stop=function(){o.audio.currentTime=0,o.audio.pause()}}var s=new XMLHttpRequest;s.open("GET",o),s.responseType="arraybuffer",s.onload=function(o){po?po.decodeAudioData(o.target.response,function(o){lo[e]=o,t()},a):a()},s.send()}(e.key,e.value,o)})}function Te(e,o){return co.bgm&&co.bgm.stop(),co.bgm=je(e,!0)}function Se(){co.bgm&&(co.bgm.stop(),delete co.bgm)}function je(e,o){var r,a,t=o&&co.muteBGM||!o&&co.muteEff;return a=lo[e]||lo.missing,window.hasOwnProperty("AudioBuffer")&&a instanceof AudioBuffer?((r=po.createBufferSource()).startedAt=po.currentTime,r.loop=o,r.buffer=t?po.createBuffer(2,a.length,po.sampleRate):a,r.connect(po.destination)):(a.readyState&&(a.audio.currentTime=0),a.audio.loop=o||!1,a.audio.volume=t?0:1,r=a),mo[e]&&mo[e].stop(),mo[e]=r,r.key=e,r.start(),r}function qe(){var e;for(e in mo)mo[e].stop()}function Re(e){var o;co.rooms[e]&&(co.rooms[e].password&&!(o=prompt(L.putPassword))||(co._pw=o,l("enter",{id:e,password:o})))}function Ae(){var e=$("#Chat,#chat-log-board"),o=e.children(".chat-item").last().get(0);o&&"HR"==o.tagName||(e.append($("<hr>").addClass("chat-item")),eo.chat.scrollTop(999999999))}function Oe(e){return e.replace(no,"♥♥")}function De(e,o,r,a){var t,i,s,n,l=a?new Date(a):new Date,d=co.users[e.id]?co.users[e.id].equip:{};if(!co._shut[e.title||e.name]){if(r){if(co.opts.dw)return;if(co._wblock[r])return}o=Oe(o),je("k"),Pe(),!ro&&co.room&&(t=(co.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),function(e,o,r){$("#cb-"+o).remove();var a,t,i=(2&r?$("#game-user-"+o):$("#room-user-"+o)).offset(),s=2==r?"chat-balloon-bot":"chat-balloon-tip",n=$("<div>").addClass("chat-balloon").attr("id","cb-"+o).append($("<div>").addClass("jt-image "+s))[2==r?"prepend":"append"]($("<h4>").text(e));i&&(eo.balloons.append(n),1==r?(a=0,t=220):2==r?(a=35-n.height(),t=-2):3==r?(a=5,t=210):(a=40,t=110),n.css({top:i.top+a,left:i.left+t}),p(function(){n.animate({opacity:0},500,function(){n.remove()})},2500))}(o,e.id,t)),eo.chat.append(s=$("<div>").addClass("chat-item").append(t=$("<div>").addClass("chat-head ellipse").text(e.title||e.name)).append(i=$("<div>").addClass("chat-body").text(o)).append($("<div>").addClass("chat-stamp").text(l.toLocaleTimeString()))),a&&t.prepend($("<i>").addClass("fa fa-video-camera")),t.on("click",function(o){V(e.id)}),eo.chatLog.append(s=s.clone()),s.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(e.id||"").substr(0,5))),(n=o.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(o=i.html(),n.forEach(function(e){o=o.replace(e,"<a href='#' style='color: #2222FF;' onclick='if(confirm(\""+L.linkWarning+'")) window.open("'+e+"\");'>"+e+"</a>")}),i.html(o)),r&&(!0!==r&&(co._recentFrom=r),i.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+i.html())),R(t,{equip:d}),eo.chat.scrollTop(999999999)}}function Be(e,o){var r=new Date;je("k"),Pe(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(o||L.notice)).append($("<div>").addClass("chat-body").html(e)).append($("<div>").addClass("chat-stamp").text(r.toLocaleTimeString()))),eo.chat.scrollTop(999999999),"tail"==o&&console.warn(r.toLocaleString(),e)}function Pe(){var e=$("#Chat .chat-item"),o=$("#chat-log-board .chat-item");e.length>99&&e.first().remove(),o.length>199&&o.first().remove()}function Ee(e){var o;return o="$"==e.charAt()?co.shop[e.slice(0,4)]:co.shop[e],{_id:e,group:o.group,term:o.term,name:Me(e),cost:o.cost,image:Fe(e,o),desc:Ne(e),options:o.options}}function Me(e){return"$"==e.charAt()?L[e.slice(0,4)][0]+" - "+e.slice(4):L[e][0]}function Ne(e){return"$"==e.charAt()?L[e.slice(0,4)][1]:L[e][1]}function Fe(e,o){var r,a;if(e){if("$"==e.charAt())return function(e,o){var r,a=document.createElement("canvas"),t=a.getContext("2d");switch(a.width=a.height=50,t.font="24px NBGothic",t.textAlign="center",t.textBaseline="middle",e){case"WPC":case"WPB":case"WPA":r=["WPC","WPB","WPA"].indexOf(e),t.beginPath(),t.arc(25,25,25,0,2*Math.PI),t.fillStyle=["#DDDDDD","#A6C5FF","#FFEF31"][r],t.fill(),t.fillStyle=["#000000","#4465C3","#E69D12"][r],t.fillText(o,25,25)}return a.toDataURL()}(e.slice(1,4),e.slice(4))}else"string"==typeof o&&(o={_id:"def",group:o,options:{}});return a=(r=co.shop[e]||o).options.hasOwnProperty("gif")?".gif":".png","BDG"==r.group.slice(0,3)?"/img/kkutu/moremi/badge/"+r._id+a:"M"==r.group.charAt(0)?"/img/kkutu/moremi/"+r.group.slice(1)+"/"+r._id+a:"/img/kkutu/shop/"+r._id+".png"}function Ie(e){eo.dialog.obtain.is(":visible")?co._obtain.push(e):(Ge(e),m(eo.dialog.obtain,!0))}function Ge(e){je("success"),$("#obtain-image").css("background-image","url("+Fe(e.key)+")"),$("#obtain-name").html(Me(e.key))}function Ke(e,o){var r,a,t=$(e).empty(),i={Mlhand:"Mhand",Mrhand:"Mhand"};for(r in o||(o={}),He)a="M"+He[r],t.append($("<img>").addClass("moremies moremi-"+a.slice(1)).attr("src",Fe(o[a],i[a]||a)).css({width:"100%",height:"100%"}));(a=o.BDG)&&t.append($("<img>").addClass("moremies moremi-badge").attr("src",Fe(a)).css({width:"100%",height:"100%"})),t.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",o.robot?"/img/kkutu/moremi/robot.png":"/img/kkutu/moremi/body.png").css({width:"100%",height:"100%"})),t.children(".moremi-rhand").css("transform","scaleX(-1)")}function Je(e){var o=/(^[+-]?\d+)(\d{3})/;if(null===e)return"?";for(e=e.toString();o.test(e);)e=e.replace(o,"$1,$2");return e}function Ue(e){return alert(L["error_"+e])}function Ve(e){eo.yell.show().css("opacity",1).html(e),p(function(){eo.yell.animate({opacity:0},3e3),p(function(){eo.yell.hide()},3e3)},1e3)}var We,He,Qe,ze,Ye,Xe,Ze,eo,oo,ro,ao=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],to={profile:{title:L.null},data:{score:0}},io=30,so=[],no=new RegExp(["느으*[^가-힣]*금마?","니[^가-힣]*(엄|앰|엠)","(ㅄ|ㅅㅂ|ㅂㅅ)","미친(년|놈)?","(병|븅|빙)[^가-힣]*신","보[^가-힣]*지","(새|섀|쌔|썌)[^가-힣]*(기|끼)","섹[^가-힣]*스","(시|씨|쉬|쒸)이*입?[^가-힣]*(발|빨|벌|뻘|팔|펄)","십[^가-힣]*새","씹","(애|에)[^가-힣]*미","자[^가-힣]*지","존[^가-힣]*나","좆|죶","지랄","창[^가-힣]*(녀|년|놈)","fuck","sex"].join("|"),"g"),lo={},mo={},co={},uo={Classic:{},Jaqwi:{},Crossword:{},Typing:{},Hunmin:{},Daneo:{},Sock:{}},po=!!window.hasOwnProperty("AudioContext")&&new AudioContext,go=window.WebSocket,fo=setInterval,ho=setTimeout;$(document).ready(function(){function e(e,o){var r,a;for(r in Ye)a=Ye[r].name.toLowerCase(),-1==e.indexOf(r)?$("#"+o+"-"+a+"-panel").hide():$("#"+o+"-"+a+"-panel").show()}function o(e){var o,r,a={};for(o in Ye)r=Ye[o].name.toLowerCase(),$("#"+e+"-"+r).is(":checked")&&(a[r]=!0);return a}function r(e,o,r,a){var t;if(!a){if(e.gaming)return!1;if(e.password)return!1;if(e.players.length>=e.limit)return!1}if(e.mode!=o)return!1;for(t in r)if(!e.opts[t])return!1;return!0}function a(e){$(".team-selector").hasClass("team-unable")||l("team",{value:$(e.currentTarget).attr("id").slice(5)})}function t(){(Xe=new go(co.URL)).onopen=function(e){d()},Xe.onmessage=_onMessage=function(e){f(JSON.parse(e.data))},Xe.onclose=function(e){var o=L.closed+" (#"+e.code+")";Ze&&Ze.close(),qe(),alert(o),$.get("/kkutu_notice.html",function(e){d(e)})},Xe.onerror=function(e){console.warn(L.error,e)}}var i;for(co.PUBLIC="true"==$("#PUBLIC").html(),co.URL=$("#URL").html(),co.version=$("#version").html(),co.server=location.href.match(/\?.*server=(\d+)/)[1],co.shop={},co._okg=0,co._playTime=0,co._kd="",co._timers=[],co._obtain=[],co._wblock={},co._shut={},co.usersR={},so.push(ke(1)),i=2;i<360;i++)so.push(so[i-2]+ke(i));if(so[359]=1/0,so.push(1/0),eo={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),chatLog:$("#chat-log-board"),talk:$("#Talk"),chatBtn:$("#ChatBtn"),menu:{help:$("#HelpBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),leaderboard:$("#LeaderboardBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),community:$("#CommunityDiag"),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},null==go)return d(L.websocketUnsupport),void alert(L.websocketUnsupport);for(co._soundList=[{key:"k",value:"/media/kkutu/k.mp3"},{key:"lobby",value:"/media/kkutu/LobbyBGM.mp3"},{key:"jaqwi",value:"/media/kkutu/JaqwiBGM.mp3"},{key:"jaqwiF",value:"/media/kkutu/JaqwiFastBGM.mp3"},{key:"game_start",value:"/media/kkutu/game_start.mp3"},{key:"round_start",value:"/media/kkutu/round_start.mp3"},{key:"fail",value:"/media/kkutu/fail.mp3"},{key:"timeout",value:"/media/kkutu/timeout.mp3"},{key:"lvup",value:"/media/kkutu/lvup.mp3"},{key:"Al",value:"/media/kkutu/Al.mp3"},{key:"success",value:"/media/kkutu/success.mp3"},{key:"missing",value:"/media/kkutu/missing.mp3"},{key:"mission",value:"/media/kkutu/mission.mp3"},{key:"kung",value:"/media/kkutu/kung.mp3"},{key:"horr",value:"/media/kkutu/horr.mp3"}],i=0;i<=10;i++)co._soundList.push({key:"T"+i,value:"/media/kkutu/T"+i+".mp3"},{key:"K"+i,value:"/media/kkutu/K"+i+".mp3"},{key:"As"+i,value:"/media/kkutu/As"+i+".mp3"});for(i in xe(co._soundList,function(){pe(t)}),delete co._soundList,He=$("#MOREMI_PART").html().split(","),Qe=$("#AVAIL_EQUIP").html().split(","),ze=JSON.parse($("#RULE").html()),Ye=JSON.parse($("#OPTIONS").html()),We=Object.keys(ze),(ro="true"==$("#mobile").html())&&(io=200),co._timePercent=function(){return 100-(co._turnSound.audio?co._turnSound.audio.currentTime:po.currentTime-co._turnSound.startedAt)/co.turnTime*1e5+"%"},co.setRoom=function(e,o){var r="for-lobby"==w();null==o?(delete co.rooms[e],r&&$("#room-"+e).remove()):(r&&!co.rooms[e]&&eo.lobby.roomList.append($("<div>").attr("id","room-"+e)),co.rooms[e]=o,r&&$("#room-"+e).replaceWith(A(o)))},co.setUser=function(e,o){var r,a=w(),t="for-lobby"==a||"for-master"==a;co._replay?oo.users[e]=o:null==o?(delete co.users[e],t&&$("#users-item-"+e+",#invite-item-"+e).remove()):(t&&!co.users[e]&&(r=q(o,"for-master"==a),"for-master"==a?eo.dialog.inviteList.append(r):eo.lobby.userList.append(r)),co.users[e]=o,t&&(r?$("#"+r.attr("id")).replaceWith(r):$("#"+("for-lobby"==a?"users-item-":"invite-item")+e).replaceWith(q(o,"for-master"==a))))},$(document).on("paste",function(e){if(co.room&&co.room.gaming)return e.preventDefault(),!1}),eo.talk.on("drop",function(e){if(co.room&&co.room.gaming)return e.preventDefault(),!1}),co.opts=$.cookie("kks"),co.opts&&c(JSON.parse(co.opts)),$(".dialog-head .dialog-title").on("mousedown",function(e){var o=$(e.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),o.addClass("dialog-front"),function(e,o,r){var a=e.position();$(window).on("mousemove",function(t){var i=t.pageX-o,s=t.pageY-r;e.css("left",a.left+i),e.css("top",a.top+s)})}(o,e.pageX,e.pageY)}).on("mouseup",function(e){$(window).off("mousemove")}),eo.chatBtn.on("click",function(e){var o=ro&&eo.game.here.is(":visible")?eo.game.hereText.val():eo.talk.val(),r={value:o};o&&("/"==r.value[0]?(r.cmd=r.value.split(" "),v(r.cmd)):((eo.game.here.is(":visible")||co._relay)&&(r.relay=!0),l("talk",r)),co._whisper?(eo.talk.val("/e "+co._whisper+" "),delete co._whisper):eo.talk.val(""),eo.game.hereText.val(""))}).hotkey(eo.talk,13).hotkey(eo.game.hereText,13),$("#cw-q-input").on("keydown",function(e){if(13==e.keyCode){var o=$(e.currentTarget),r=o.val(),a={relay:!0,data:co._sel,value:r};if(!r)return;l("talk",a),o.val("")}}).on("focusout",function(e){$(".cw-q-body").empty(),eo.game.cwcmd.css("opacity",0)}),$("#room-limit").on("change",function(e){var o=$(e.currentTarget),r=o.val();r<2||r>8?o.css("color","#FF4444"):o.css("color","")}),$("#room-round").on("change",function(e){var o=$(e.currentTarget),r=o.val();r<1||r>10?o.css("color","#FF4444"):o.css("color","")}),eo.game.here.on("click",function(e){ro||eo.talk.focus()}),eo.talk.on("keyup",function(e){eo.game.hereText.val(eo.talk.val())}),$(window).on("beforeunload",function(e){if(co.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),eo.dialog)eo.dialog[i].children(".dialog-head").hasClass("no-close")||eo.dialog[i].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(e){$(e.currentTarget).parent().parent().hide()}).hotkey(!1,27));for(eo.menu.help.on("click",function(e){$("#help-board").attr("src","/help"),m(eo.dialog.help)}),eo.menu.setting.on("click",function(e){m(eo.dialog.setting)}),eo.menu.community.on("click",function(e){if(co.guest)return Ue(451);m(eo.dialog.community)}),eo.dialog.commFriendAdd.on("click",function(e){var o=prompt(L.friendAddNotice);if(o)return co.users[o]?void l("friendAdd",{target:o},!0):Ue(450)}),eo.menu.newRoom.on("click",function(e){var o;eo.dialog.quick.hide(),co.typeRoom="enter",m(o=eo.dialog.room),o.find(".dialog-title").html(L.newRoom)}),eo.menu.setRoom.on("click",function(e){var o,r,a,t=ze[We[co.room.mode]];for(r in co.typeRoom="setRoom",$("#room-title").val(co.room.title),$("#room-limit").val(co.room.limit),$("#room-mode").val(co.room.mode).trigger("change"),$("#room-round").val(co.room.round),$("#room-time").val(co.room.time/t.time),Ye)a=Ye[r].name.toLowerCase(),$("#room-"+a).attr("checked",co.room.opts[a]);co._injpick=co.room.opts.injpick,m(o=eo.dialog.room),o.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(a){var t,i,s=$("#quick-mode").val(),n=0;for(t in"quick-mode"==a.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),i=o("quick"),e(ze[We[s]].opts,"quick"),co.rooms)r(co.rooms[t],s,i,!0)&&n++;$("#quick-status").html(L.quickStatus+" "+n)}),eo.menu.quickRoom.on("click",function(e){eo.dialog.room.hide(),m(eo.dialog.quick),eo.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-queue").html(""),eo.dialog.quickOK.removeClass("searching").html(L.OK))}),eo.dialog.quickOK.on("click",function(e){function a(){var e,o=[];if(eo.dialog.quick.is(":visible")){for(e in $("#quick-queue").html(L.quickQueue+" "+S(1e3*co._quickn++)),co.rooms)r(co.rooms[e],t,i)&&o.push(e);o.length&&(e=o[Math.floor(Math.random()*o.length)],co._preQuick=!0,$("#room-"+e).trigger("click"))}else clearTimeout(co._quickT)}var t=$("#quick-mode").val(),i=o("quick");if("for-lobby"==w()){if(eo.dialog.quickOK.hasClass("searching"))return eo.dialog.quick.hide(),a(),void eo.menu.quickRoom.trigger("click");$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),eo.dialog.quickOK.addClass("searching").html("<i class='fa fa-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),co._quickn=0,co._quickT=u(a,1e3)}}),$("#room-mode").on("change",function(o){var r=$("#room-mode").val(),a=ze[We[r]];$("#game-mode-expl").html(L["modex"+r]),e(a.opts,"room"),co._injpick=[],-1!=a.opts.indexOf("ijp")?$("#room-injpick-panel").show():$("#room-injpick-panel").hide(),"Typing"==a.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(e,o){$(o).html(Number($(o).val())*a.time+L.SECOND)})}).trigger("change"),eo.menu.spectate.on("click",function(e){eo.menu.spectate.hasClass("toggled")?(l("form",{mode:"J"}),eo.menu.spectate.removeClass("toggled")):(l("form",{mode:"S"}),eo.menu.spectate.addClass("toggled"))}),eo.menu.shop.on("click",function(e){(co._shop=!co._shop)?(function(){var e=$("#shop-shelf");e.html(L.LOADING),pe(function(o){if(e.empty(),co.guest&&(o.error=423),o.error)return eo.menu.shop.trigger("click"),Ue(o.error);o.goods.sort(function(e,o){return o.updatedAt-e.updatedAt}).forEach(function(o,r,a){if(!(o.cost<0)){var t=Fe(!1,o);e.append($("<div>").attr("id","goods_"+o._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+t+")")).append($("<div>").addClass("goods-title").html(Me(o._id))).append($("<div>").addClass("goods-cost").html(Je(o.cost)+L.ping)).append(ue(o,!1)).on("click",ge))}}),global.expl(e)}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}(),eo.menu.shop.addClass("toggled")):eo.menu.shop.removeClass("toggled"),C()}),$(".shop-type").on("click",function(e){var o=$(e.currentTarget),r=o.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),o.addClass("selected"),function(e){var o,r,a,t=!0===e;for(a in t||(e=e.split(",")),co.shop)(r=co.shop[a]).cost<0||(o=$("#goods_"+a).show(),t||-1==e.indexOf(r.group)&&o.hide())}("all"==r||o.attr("value"))}),eo.menu.dict.on("click",function(e){m(eo.dialog.dict)}),eo.menu.wordPlus.on("click",function(e){m(eo.dialog.wordPlus)}),eo.menu.invite.on("click",function(e){m(eo.dialog.invite),j(!0)}),eo.menu.practice.on("click",function(e){ze[We[co.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),m(eo.dialog.practice)):l("practice",{level:-1})}),eo.menu.ready.on("click",function(e){l("ready")}),eo.menu.start.on("click",function(e){l("start")}),eo.menu.exit.on("click",function(e){if(co.room.gaming){if(!confirm(L.sureExit))return;co._spaced&&uo.Typing.spaceOff(),clearInterval(co._tTime),co._relay=!1}l("leave")}),eo.menu.replay.on("click",function(e){co._replay&&re(),m(eo.dialog.replay),eo.dialog.replayView.attr("disabled",!0),eo.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),eo.menu.leaderboard.on("click",function(e){co._lbpage=0,eo.dialog.leaderboard.is(":visible")?eo.dialog.leaderboard.hide():$.get("/ranking",function(e){J(e),m(eo.dialog.leaderboard)})}),eo.dialog.lbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(co._lbpage-1),function(e){J(e)})}),eo.dialog.lbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?id="+co.id,function(e){J(e)})}),eo.dialog.lbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(co._lbpage+1),function(e){J(e)})}),eo.dialog.settingServer.on("click",function(e){location.href="/"}),eo.dialog.settingOK.on("click",function(e){c({mb:$("#mute-bgm").is(":checked"),me:$("#mute-effect").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),$.cookie("kks",JSON.stringify(co.opts)),eo.dialog.setting.hide()}),eo.dialog.profileLevel.on("click",function(e){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),m(eo.dialog.practice)}),eo.dialog.practiceOK.on("click",function(e){var o=$("#practice-level").val(),r=$("#ai-team").val();eo.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?l("setAI",{target:co._profiled,level:o,team:r}):l("practice",{level:o})}),eo.dialog.roomOK.on("click",function(e){var o,r,a={injpick:co._injpick};for(o in Ye)a[r=Ye[o].name.toLowerCase()]=$("#room-"+r).is(":checked");l(co.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),time:$("#room-time").val(),opts:a}),eo.dialog.room.hide()}),eo.dialog.resultOK.on("click",function(e){1==co._resultPage&&co._resultRank?me(co._resultRank[co.id]):(co.practicing&&(co.room.gaming=!0,l("leave")),co.resulting=!1,eo.dialog.result.hide(),delete co._replay,delete co._resultRank,eo.box.room.height(360),Te("lobby"),Ae(),C())}),eo.dialog.resultSave.on("click",function(e){var o=new Date(oo.time),r=new Blob([JSON.stringify(oo)],{type:"text/plain"}),a=URL.createObjectURL(r),t="KKuTu"+o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()+" "+o.getHours()+"-"+o.getMinutes()+"-"+o.getSeconds()+".kkt",i=$("<a>").attr({download:t,href:a}).on("click",function(e){i.remove()});$("#Jungle").append(i),i[0].click()}),eo.dialog.dictInjeong.on("click",function(e){var o=$(e.currentTarget);o.is(":disabled")||$("#dict-theme").val()&&(o.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(e){if(p(function(){o.prop("disabled",!1)},2e3),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(L.wpSuccess+"("+e.message+")")}))}),eo.dialog.dictSearch.on("click",function(e){var o=$(e.currentTarget);o.is(":disabled")||(o.prop("disabled",!0),$("#dict-output").html(L.searching),y($("#dict-input").val(),function(e){if(p(function(){o.prop("disabled",!1)},500),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(be(e.word,e.mean,e.theme,e.type.split(",")))}))}).hotkey($("#dict-input"),13),eo.dialog.wordPlusOK.on("click",function(e){var o;eo.dialog.wordPlusOK.hasClass("searching")||(o=$("#wp-input").val())&&((o=o.replace(/[^a-z가-힣]/g,"")).length<2||($("#wp-input").val(""),$(e.currentTarget).addClass("searching").html("<i class='fa fa-spin fa-spinner'></i>"),l("wp",{value:o})))}).hotkey($("#wp-input"),13),eo.dialog.inviteRobot.on("click",function(e){W("AI")}),eo.box.me.on("click",function(e){V(co.id)}),eo.dialog.roomInfoJoin.on("click",function(e){eo.dialog.roomInfo.hide(),Re(co._roominfo)}),eo.dialog.profileHandover.on("click",function(e){confirm(L.sureHandover)&&l("handover",{target:co._profiled})}),eo.dialog.profileKick.on("click",function(e){l("kick",{robot:co.robots.hasOwnProperty(co._profiled),target:co._profiled})}),eo.dialog.profileShut.on("click",function(e){var o=co.users[co._profiled];o&&_(o.profile.title||o.profile.name)}),eo.dialog.profileWhisper.on("click",function(e){var o=co.users[co._profiled];eo.talk.val("/e "+(o.profile.title||o.profile.name).replace(/\s/g,"")+" ").focus()}),eo.dialog.profileDress.on("click",function(e){return co.guest?Ue(421):co._gaming?Ue(438):void(m(eo.dialog.dress)&&$.get("/box",function(e){if(e.error)return Ue(e.error);co.box=e,F()}))}),eo.dialog.dressOK.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.post("/updateMe",{nickname:$("#dress-nickname").val(),exordial:$("#dress-exordial").val()},function(e){if(eo.dialog.dressOK.attr("disabled",!1),e.error)return Ue(e.error);$("#dress-nickname").val()!=co.nickname&&(alert(`닉네임이 ${$("#dress-nickname").val()}로 변경되었습니다.`),co.nickname=$("#dress-nickname").val()),eo.dialog.dress.hide()})}),$("#DressDiag .dress-type").on("click",function(e){var o=$(e.currentTarget),r=o.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),o.addClass("selected"),G("all"==r||o.attr("value"))}),$("#dress-cf").on("click",function(e){if(co._gaming)return Ue(438);m(eo.dialog.charFactory)&&K()}),eo.dialog.cfCompose.on("click",function(e){if(!eo.dialog.cfCompose.hasClass("cf-composable"))return Ue(436);confirm(L.cfSureCompose)&&$.post("/cf",{tray:co._tray.join("|")},function(e){var o;if(e.error)return Ue(e.error);for(o in l("refresh"),alert(L.cfComposed),co.users[co.id].money=e.money,co.box=e.box,e.gain)Ie(e.gain[o]);F(co._avGroup),T(),K()})}),$("#room-injeong-pick").on("click",function(e){var o,r=ze[We[$("#room-mode").val()]];for(o in $("#injpick-list>div").hide(),"ko"==r.lang?(co._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==r.lang&&(co._ijkey="#en-pick-",$("#en-pick-list").show()),eo.dialog.injPickNo.trigger("click"),co._injpick)$(co._ijkey+co._injpick[o]).prop("checked",!0);m(eo.dialog.injPick)}),eo.dialog.injPickAll.on("click",function(e){$("#injpick-list input").prop("checked",!0)}),eo.dialog.injPickNo.on("click",function(e){$("#injpick-list input").prop("checked",!1)}),eo.dialog.injPickOK.on("click",function(e){var o=$(co._ijkey+"list"),r=[];co._injpick=o.find("input").each(function(e,o){var a=$(o),t=a.attr("id").slice(8);a.is(":checked")&&r.push(t)}),co._injpick=r,eo.dialog.injPick.hide()}),eo.dialog.kickVoteY.on("click",function(e){l("kickVote",{agree:!0}),clearTimeout(co._kickTimer),eo.dialog.kickVote.hide()}),eo.dialog.kickVoteN.on("click",function(e){l("kickVote",{agree:!1}),clearTimeout(co._kickTimer),eo.dialog.kickVote.hide()}),eo.dialog.purchaseOK.on("click",function(e){$.post("/buy/"+co._sgood,function(e){var o=co.users[co.id];if(e.error)return Ue(e.error);alert(L.purchased),o.money=e.money,o.box=e.box,T()}),eo.dialog.purchase.hide()}),eo.dialog.purchaseNO.on("click",function(e){eo.dialog.purchase.hide()}),eo.dialog.obtainOK.on("click",function(e){var o=co._obtain.shift();o?Ge(o):eo.dialog.obtain.hide()}),i=0;i<5;i++)$("#team-"+i).on("click",a);$("#replay-file").on("change",function(e){var o=e.target.files[0],r=new FileReader,a=$("#replay-date").html("-"),t=$("#replay-version").html("-"),i=$("#replay-players").html("-");oo=!1,eo.dialog.replayView.attr("disabled",!0),o&&(r.readAsText(o),r.onload=function(e){var o,r;try{for(o in r=JSON.parse(e.target.result),a.html(new Date(r.time).toLocaleString()),t.html(r.version),i.empty(),r.players){var s,n=r.players[o];i.append(s=$("<div>").addClass("replay-player-bar ellipse").html(n.title).prepend(ye(n.data.score).addClass("users-level"))),n.id==r.me&&s.css("font-weight","bold")}oo=r,eo.dialog.replayView.attr("disabled",!1)}catch(e){return console.warn(e),alert(L.replayError)}})}),eo.dialog.replayView.on("click",function(e){!function(){var e;for(e in re(),co._replay=!0,co.room={title:oo.title,players:[],events:[],time:oo.roundTime,round:oo.round,mode:oo.mode,limit:oo.limit,game:oo.game,opts:oo.opts,readies:oo.readies},z(),oo.events)co.room.events.push(oo.events[e]);eo.box.userList.hide(),eo.box.roomList.hide(),eo.box.game.show(),eo.dialog.replay.hide(),Q(),P(!0),co.$gp=$(".GameBox .product-title").empty().append(co.$gpt=$("<div>").addClass("game-replay-title")).append(co.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",Z)).append($("<button>").html(L.replayPause).on("click",X)).append($("<button>").html(L.replayPrev).on("click",Y))),co._gpp=L.replay+" - "+new Date(oo.time).toLocaleString(),co._gtt=co.room.events[co.room.events.length-1].time,co._eventTime=0,co._rt=p(oe,2e3),co._rprev=0,co._rpause=!1,ee()}()}),u(function(){bo>0?bo=0:vo>0&&(vo-=.03)},1e3)}),uo.Classic.roundReady=function(e){co.room.game.title.length,te(),co._roundTime=1e3*co.room.time,eo.game.display.html($e(e.char,e.subChar)),eo.game.chain.show().html(co.chain=0),co.room.opts.mission&&eo.game.items.show().css("opacity",1).html(co.mission=e.mission),"KAP"==We[co.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),ie(e.round),je("round_start"),ae("roundReady")},uo.Classic.turnStart=function(e){co.room.game.turn=e.turn,e.seq&&(co.room.game.seq=e.seq),(co._tid=co.room.game.seq[e.turn])&&(co._tid.robot&&(co._tid=co._tid.id),e.id=co._tid,eo.game.display.html(co._char=$e(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),co._replay||(eo.game.here.css("display",e.id==co.id?"block":"none"),e.id==co.id&&(ro?eo.game.hereText.val("").focus():eo.talk.focus())),eo.game.items.html(co.mission=e.mission),Xe.onmessage=_onMessage,clearInterval(co._tTime),co._chars=[e.char,e.subChar],co._speed=e.speed,co._tTime=u(se,io),co.turnTime=e.turnTime,co._turnTime=e.turnTime,co._roundTime=e.roundTime,co._turnSound=je("T"+e.speed),ae("turnStart"))},uo.Classic.turnGoing=function(){co.room||clearInterval(co._tTime),co._turnTime-=io,co._roundTime-=io,eo.game.turnBar.width(co._timePercent()).html((.001*co._turnTime).toFixed(1)+L.SECOND),eo.game.roundBar.width(co._roundTime/co.room.time*.1+"%").html((.001*co._roundTime).toFixed(1)+L.SECOND),eo.game.roundBar.hasClass("round-extreme")||co._roundTime<=5e3&&eo.game.roundBar.addClass("round-extreme")},uo.Classic.turnEnd=function(e,o){var r,a=$("<div>").addClass("deltaScore").html(o.score>0?"+"+(o.score-o.bonus):o.score),t=$(".game-user-current");co._turnSound&&co._turnSound.stop(),le(e,o.score),clearInterval(co._tTime),o.ok?(H(),clearTimeout(co._fail),eo.game.here.hide(),eo.game.chain.html(++co.chain),he(o.value,o.mean,o.theme,o.wc)):(H(e),a.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),eo.game.here.hide(),je("timeout")),o.hint&&(o.hint=o.hint._id,-1==(r=o.hint.indexOf(co._chars[0]))&&(r=o.hint.indexOf(co._chars[1])),"KAP"==We[co.room.mode]?eo.game.display.empty().append($("<label>").css("color","#AAAAAA").html(o.hint.slice(0,r))).append($("<label>").html(o.hint.slice(r))):eo.game.display.empty().append($("<label>").html(o.hint.slice(0,r+1))).append($("<label>").css("color","#AAAAAA").html(o.hint.slice(r+1)))),o.bonus&&(ro?a.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+o.bonus);de(t,e)},500)),de(t,a).removeClass("game-user-current"),M(e,ne(e))},uo.Jaqwi.roundReady=function(e){var o=L.jqTheme+": "+L["theme_"+e.theme];te(),co._roundTime=1e3*co.room.time,co._fastTime=1e4,eo.game.display.html(o),eo.game.items.hide(),eo.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(o).css("text-align","center"),ie(e.round),je("round_start"),clearInterval(co._tTime)},uo.Jaqwi.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),co.room.game.seq.indexOf(co.id)>=0&&eo.game.here.show(),eo.game.display.html(co._char=e.char),clearInterval(co._tTime),co._tTime=u(se,io),Te("jaqwi")},uo.Jaqwi.turnGoing=function(){var e,o,r=eo.game.roundBar;co.room||clearInterval(co._tTime),co._roundTime-=io,o=co._spectate?L.stat_spectate:(.001*co._roundTime).toFixed(1)+L.SECOND,r.width(co._roundTime/co.room.time*.1+"%").html(o),r.hasClass("round-extreme")||co._roundTime<=co._fastTime&&(e=co.bgm.currentTime/co.bgm.duration,co.bgm.paused?Se():Te("jaqwiF"),co.bgm.currentTime=co.bgm.duration*e,r.addClass("round-extreme"))},uo.Jaqwi.turnHint=function(e){je("mission"),function(e){var o,r=be(0,e);eo.game.hints.append(o=$("<div>").addClass("hint-item").append($("<label>").html(r)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(r.html()))),ro||o.width(0).animate({width:215}),global.expl(o)}(e.hint)},uo.Jaqwi.turnEnd=function(e,o){var r=$("<div>").addClass("deltaScore").html("+"+o.score),a=$("#game-user-"+e);o.giveup?a.addClass("game-user-bomb"):o.answer?(eo.game.here.hide(),eo.game.display.html($("<label>").css("color","#FFFF44").html(o.answer)),Se(),je("horr")):(e==co.id&&eo.game.here.hide(),le(e,o.score),co._roundTime>1e4&&(co._roundTime=1e4),de(a,r),M(e,ne(e)).addClass("game-user-current"),je("success"))},uo.Crossword.roundReady=function(e,o){var r=e.seq?e.seq.indexOf(co.id):-1;te(),$(".jjoriping,.rounds,.game-body").addClass("cw"),co._roundTime=1e3*co.room.time,co._fastTime=3e4,co.selectedRound=-1==r?1:r%co.room.round+1,eo.game.items.hide(),eo.game.cwcmd.show().css("opacity",0),ie(co.selectedRound),o||je("round_start"),clearInterval(co._tTime)},uo.Crossword.turnEnd=function(e,o){var r,a,t=$("<div>").addClass("deltaScore").html("+"+o.score),i=$("#game-user-"+e);o.score?(a=o.pos.join(","),e==co.id?(eo.game.cwcmd.css("opacity",0),je("success")):(co._sel&&o.pos.join(",")==co._sel.join(",")&&eo.game.cwcmd.css("opacity",0),je("mission")),co._bdb[a][4]=o.value,co._bdb[a][5]=e,o.pos[0]==co.selectedRound-1?uo.Crossword.drawDisplay():(r=$(eo.game.round.children("label").get(o.pos[0])).addClass("round-effect"),p(function(){r.removeClass("round-effect")},800)),le(e,o.score),M(e,ne(e)),de(i,t)):(Se(),eo.game.round.empty(),je("horr"))},uo.Crossword.drawDisplay=function(){var e,o,r,a,t,i,s,n,l,d=co._boards[co.selectedRound-1],m=eo.game.display.empty(),c={};for(o in d)for(a=Number(d[o][0]),t=Number(d[o][1]),i="1"==d[o][2],s=Number(d[o][3]),n=d[o][4],m.append(e=$("<div>").addClass("cw-bar").attr("id","cw-"+a+"-"+t+"-"+d[o][2]).css({top:12.5*t+"%",left:12.5*a+"%",width:12.5*(i?1:s)+"%",height:12.5*(i?s:1)+"%"})),n&&e.addClass("cw-open"),d[o][5]==co.id?e.addClass("cw-my-open"):e.on("click",uo.Crossword.onBar).on("mouseleave",uo.Crossword.onSwap),r=0;r<s;r++)l=a+"-"+t,n&&(c[l]=n.charAt(r)),e.append($("<div>").addClass("cw-cell").attr("id","cwc-"+l).html(c[l]||"")),i?t++:a++},uo.Crossword.onSwap=function(e){eo.game.display.prepend($(e.currentTarget))},uo.Crossword.onRound=function(e){var o=$(e.currentTarget).html().charCodeAt(0)-9311;ie(co.selectedRound=o),$(".rounds label").on("click",uo.Crossword.onRound),uo.Crossword.drawDisplay()},uo.Crossword.onBar=function(e){var o=$(e.currentTarget).attr("id").slice(3).split("-"),r=co._means[co.selectedRound-1][o.join(",")],a="1"==r.dir;eo.game.cwcmd.css("opacity",1),co._sel=[co.selectedRound-1,o[0],o[1],o[2]],$(".cw-q-head").html(L[a?"cwVert":"cwHorz"]+r.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(be(0,r.mean,r.theme,r.type.split(",")))},uo.Crossword.turnStart=function(e,o){var r,a;for(r in co._bdb={},co._boards=e.boards,co._means=e.means,e.boards)for(a in e.boards[r])co._bdb[[r,e.boards[r][a][0],e.boards[r][a][1],e.boards[r][a][2]].join(",")]=e.boards[r][a];$(".rounds label").on("click",uo.Crossword.onRound),uo.Crossword.drawDisplay(),clearInterval(co._tTime),co._tTime=u(se,io),Te("jaqwi")},uo.Crossword.turnGoing=uo.Jaqwi.turnGoing,uo.Crossword.turnHint=function(e){je("fail")},uo.Typing.roundReady=function(e){co.room.game.title.length,co._chatter=ro?eo.game.hereText:eo.talk,te(),co._round=e.round,co._roundTime=1e3*co.room.time,co._fastTime=1e4,co._list=e.list.concat(e.list),co.chain=0,a(),ie(e.round),je("round_start"),ae("roundReady")},uo.Typing.spaceOn=function(){co.room.opts.proverb||(co._spaced=!0,$("body").on("keydown","#"+co._chatter.attr("id"),e))},uo.Typing.spaceOff=function(){delete co._spaced,$("body").off("keydown","#"+co._chatter.attr("id"),e)},uo.Typing.turnStart=function(e){co._spectate||(eo.game.here.show(),ro?eo.game.hereText.val("").focus():eo.talk.val("").focus(),uo.Typing.spaceOn()),Xe.onmessage=_onMessage,clearInterval(co._tTime),co._tTime=u(se,io),co._roundTime=e.roundTime,Te("jaqwi"),ae("turnStart")},uo.Typing.turnGoing=uo.Jaqwi.turnGoing,uo.Typing.turnEnd=function(e,o){var r=$("<div>").addClass("deltaScore").html("+"+o.score),i=$("#game-user-"+e);o.error?(co.chain++,a(),je("fail")):o.ok?(co.id==e?(co.chain++,a(),je("mission"),ve(o.value,"")):co._spectate&&je("mission"),le(e,o.score),de(i,r),M(e,ne(e))):(clearInterval(co._tTime),uo.Typing.spaceOff(),eo.game.here.hide(),Se(),je("horr"),p(s,1e3,o.speed),co._round<co.room.round&&t(10))},uo.Hunmin.roundReady=function(e){co.room.game.title.length,te(),co._roundTime=1e3*co.room.time,eo.game.display.html(co._char="&lt;"+e.theme+"&gt;"),eo.game.chain.show().html(co.chain=0),co.room.opts.mission&&eo.game.items.show().css("opacity",1).html(co.mission=e.mission),ie(e.round),je("round_start"),ae("roundReady")},uo.Hunmin.turnStart=function(e){co.room.game.turn=e.turn,e.seq&&(co.room.game.seq=e.seq),co._tid=co.room.game.seq[e.turn],co._tid.robot&&(co._tid=co._tid.id),e.id=co._tid,eo.game.display.html(co._char),$("#game-user-"+e.id).addClass("game-user-current"),co._replay||(eo.game.here.css("display",e.id==co.id?"block":"none"),e.id==co.id&&(ro?eo.game.hereText.val("").focus():eo.talk.focus())),eo.game.items.html(co.mission=e.mission),Xe.onmessage=_onMessage,clearInterval(co._tTime),co._chars=[e.char,e.subChar],co._speed=e.speed,co._tTime=u(se,io),co.turnTime=e.turnTime,co._turnTime=e.turnTime,co._roundTime=e.roundTime,co._turnSound=je("T"+e.speed),ae("turnStart")},uo.Hunmin.turnGoing=uo.Classic.turnGoing,uo.Hunmin.turnEnd=function(e,o){var r,a=$("<div>").addClass("deltaScore").html(o.score>0?"+"+(o.score-o.bonus):o.score),t=$(".game-user-current");co._turnSound.stop(),le(e,o.score),clearInterval(co._tTime),o.ok?(clearTimeout(co._fail),eo.game.here.hide(),eo.game.chain.html(++co.chain),he(o.value,o.mean,o.theme,o.wc)):(a.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),eo.game.here.hide(),je("timeout")),o.hint&&(o.hint=o.hint._id,-1==(r=o.hint.indexOf(co._chars[0]))&&(r=o.hint.indexOf(co._chars[1])),eo.game.display.empty().append($("<label>").html(o.hint.slice(0,r+1))).append($("<label>").css("color","#AAAAAA").html(o.hint.slice(r+1)))),o.bonus&&(ro?a.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+o.bonus);de(t,e)},500)),de(t,a).removeClass("game-user-current"),M(e,ne(e))},uo.Daneo.roundReady=function(e){co.room.game.title.length,te(),co._roundTime=1e3*co.room.time,eo.game.display.html(co._char="&lt;"+L["theme_"+e.theme]+"&gt;"),eo.game.chain.show().html(co.chain=0),co.room.opts.mission&&eo.game.items.show().css("opacity",1).html(co.mission=e.mission),ie(e.round),je("round_start"),ae("roundReady")},uo.Daneo.turnStart=function(e){co.room.game.turn=e.turn,e.seq&&(co.room.game.seq=e.seq),co._tid=co.room.game.seq[e.turn],co._tid.robot&&(co._tid=co._tid.id),e.id=co._tid,eo.game.display.html(co._char),$("#game-user-"+e.id).addClass("game-user-current"),co._replay||(eo.game.here.css("display",e.id==co.id?"block":"none"),e.id==co.id&&(ro?eo.game.hereText.val("").focus():eo.talk.focus())),eo.game.items.html(co.mission=e.mission),Xe.onmessage=_onMessage,clearInterval(co._tTime),co._chars=[e.char,e.subChar],co._speed=e.speed,co._tTime=u(se,io),co.turnTime=e.turnTime,co._turnTime=e.turnTime,co._roundTime=e.roundTime,co._turnSound=je("T"+e.speed),ae("turnStart")},uo.Daneo.turnGoing=uo.Classic.turnGoing,uo.Daneo.turnEnd=function(e,o){var r,a=$("<div>").addClass("deltaScore").html(o.score>0?"+"+(o.score-o.bonus):o.score),t=$(".game-user-current");co._turnSound.stop(),le(e,o.score),clearInterval(co._tTime),o.ok?(clearTimeout(co._fail),eo.game.here.hide(),eo.game.chain.html(++co.chain),he(o.value,o.mean,o.theme,o.wc)):(a.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),eo.game.here.hide(),je("timeout")),o.hint&&(o.hint=o.hint._id,-1==(r=o.hint.indexOf(co._chars[0]))&&(r=o.hint.indexOf(co._chars[1])),eo.game.display.empty().append($("<label>").html(o.hint.slice(0,r+1))).append($("<label>").css("color","#AAAAAA").html(o.hint.slice(r+1)))),o.bonus&&(ro?a.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+o.bonus);de(t,e)},500)),de(t,a).removeClass("game-user-current"),M(e,ne(e))},uo.Sock.roundReady=function(e,o){e.seq&&e.seq.indexOf(co.id),te(),co._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),co._va=[],co._lang=ze[We[co.room.mode]].lang,co._board=e.board,co._maps=[],co._roundTime=1e3*co.room.time,co._fastTime=1e4,eo.game.items.hide(),eo.game.bb.show(),uo.Sock.drawDisplay(),ie(e.round),o||je("round_start"),clearInterval(co._tTime)},uo.Sock.turnEnd=function(e,o){var r,a,t,i=$("<div>").addClass("deltaScore").html("+"+o.score),s=$("#game-user-"+e);if(o.score){for(t=(r=o.value).length,co._maps.push(r),a=0;a<t;a++)co._board=co._board.replace(r.charAt(a),"　");je(e==co.id?"success":"mission"),uo.Sock.drawDisplay(),le(e,o.score),M(e,ne(e)),de(s,i)}else Se(),co._relay=!1,je("horr")},uo.Sock.drawMaps=function(){eo.game.bb.empty(),co._maps.sort(function(e,o){return o.length-e.length}).forEach(function(e){eo.game.bb.append(function(e){var o,r=$("<div>").addClass("bb-word"),a=e.length;for(o=0;o<a;o++)r.append($("<div>").addClass("bb-char").html(e.charAt(o)));return r}(e))})},uo.Sock.drawDisplay=function(){var e,o=$("<div>").css("height","100%"),r=co._board.split(""),a="ko"==co._lang?"12.5%":"10%";r.forEach(function(r,t){o.append(e=$("<div>").addClass("sock-char sock-"+r).css({width:a,height:a}).html(r)),co._va[t]&&co._va[t]!=r&&e.html(co._va[t]).addClass("sock-picked").animate({opacity:0},500)}),co._va=r,eo.game.display.empty().append(o),uo.Sock.drawMaps()},uo.Sock.turnStart=function(e,o){clearInterval(co._tTime),co._tTime=u(se,io),Te("jaqwi")},uo.Sock.turnGoing=uo.Jaqwi.turnGoing,uo.Sock.turnHint=function(e){je("fail")};var vo=0,bo=0;delete window.WebSocket,delete window.setInterval}();