(function(){function e(e){32==e.keyCode&&(La.chatBtn.trigger("click"),e.preventDefault())}function t(){var e=Va._list.slice(Va.chain),a=Va.room.opts.proverb?1:5,t="",s=e[0].length;20<=s&&(t="18px"),50<=s&&(t="15px"),La.game.display.css("font-size",t),e[0]="<label style='color: #FFFF44;'>"+e[0]+"</label>",La.game.display.html(e.slice(0,a).join(" ")),La.game.chain.show().html(Va.chain),$(".jjo-turn-time .graph-bar").width("100%").html(e.slice(a,2*a).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function s(e){$(".jjo-turn-time .graph-bar").html(e+L.afterRun),0<e&&_(s,1e3,e-1)}function l(e){for(var a in e)$("#game-user-"+a+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(e[a]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}function m(e,a){var t=e.toString();return"000000000000000".slice(0,Math.max(0,a-t.length))+t}function n(t,a,s){var l,m={type:t},e=s?Da:Oa||Da;for(l in a)m[l]=a[l];if("test"!=t&&10<Ya++){if(3<=++Qa)return e.close();Ya=5}e.send(JSON.stringify(m))}function p(e){e?$("#Intro").is(":visible")?(La.loading.hide(),$("#intro-text").html(e)):La.loading.show().html(e):La.loading.hide()}function u(e,a){var t=[$(window).width(),$(window).height()];return!a&&e.is(":visible")?(e.hide(),!1):($(".dialog-front").removeClass("dialog-front"),e.show().addClass("dialog-front").css({left:.5*(t[0]-e.width()),top:.5*(t[1]-e.height())}),!0)}function g(e){Va.opts=e,Va.muteBGM=Va.opts.mb,Va.muteEff=Va.opts.me,$("#mute-bgm").attr("checked",Va.muteBGM),$("#mute-effect").attr("checked",Va.muteEff),$("#deny-invite").attr("checked",Va.opts.di),$("#deny-whisper").attr("checked",Va.opts.dw),$("#deny-friend").attr("checked",Va.opts.df),$("#auto-ready").attr("checked",Va.opts.ar),$("#sort-user").attr("checked",Va.opts.su),$("#only-waiting").attr("checked",Va.opts.ow),$("#only-unlock").attr("checked",Va.opts.ou),Va.bgm&&(Va.muteBGM?(Va.bgm.volume=0,Va.bgm.stop()):(Va.bgm.volume=1,Va.bgm=oa(Va.bgm.key,!0)))}function h(){}function k(t,a,s,l,d,e,m){var n=Ja(t,a,s,l,d,e,m);return Va._timers.push(n),n}function _(t,a,s,l,d,e,m){var n=$a(t,a,s,l,d,e,m);return Va._timers.push(n),n}function y(){}function v(t,a,s,l,d,e){if(Va.room){var m=Ra[ja[Va.room.mode]];if(!m)return null;Ua[m.rule][t].call(this,a,s,l,d,e)}}function C(e,a){var t=Va.URL.replace(/:(\d+)/,function(a,t){return":"+(+t+416+ +e-1)})+"&"+e+"&"+a;Oa||(Oa=new Ha(t),p(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){p(),Oa&&Oa.close()}),Oa.onopen=function(){console.log("room-conn",e,a)},Oa.onmessage=_onMessage,Oa.onclose=function(){console.log("room-disc",e,a),Oa=void 0},Oa.onerror=function(e){console.warn(L.error,e)})}function w(){if(!confirm(L.checkAgeAsk))return n("caj",{answer:"no"},!0);for(;;){for(var e,t=[],a=1;3>=a;)if(e=prompt(L["checkAgeInput"+a]),e&&!isNaN(e=+e))1==a&&(1e3>e||2999<e)?alert(e+"\n"+L.checkAgeNo):2==a&&(1>e||12<e)?alert(e+"\n"+L.checkAgeNo):3==a&&(1>e||31<e)?alert(e+"\n"+L.checkAgeNo):t[a++-1]=e;else if(1>--a)break;if(4==a){if(confirm(L.checkAgeSure+"\n"+t[0]+L.YEAR+" "+t[1]+L.MONTH+" "+t[2]+L.DATE))return n("caj",{answer:"yes",input:[t[1],t[2],t[0]]},!0);}else if(confirm(L.checkAgeCancel))return n("caj",{answer:"no"},!0)}}function x(t){function a(e){Da.send(JSON.stringify({type:"recaptcha",token:e}))}var s,l;switch(t.type){case"recaptcha":var m=$("#intro-text");m.empty(),m.html("\uAC8C\uC2A4\uD2B8\uB294 \uCEA1\uCC60 \uC778\uC99D\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.<br/>\uB85C\uADF8\uC778\uC744 \uD558\uC2DC\uBA74 \uCEA1\uCC60 \uC778\uC99D\uC744 \uAC74\uB108\uB6F0\uC2E4 \uC218 \uC788\uC2B5\uB2C8\uB2E4.<br/><br/>"),m.append($("<div class=\"g-recaptcha\" id=\"recaptcha\" style=\"display: table; margin: 0 auto;\"></div>")),grecaptcha.render("recaptcha",{sitekey:t.siteKey,callback:a});break;case"welcome":Va.id=t.id,Va.guest=t.guest,Va.admin=t.admin,Va.users=t.users,Va.robots={},Va.rooms=t.rooms,Va.place=0,Va.friends=t.friends,Va._friends={},Va._playTime=t.playTime,Va._okg=t.okg,Va._gaming=!1,Va.box=t.box,t.test&&alert(L.welcomeTestServer),location.hash[1]&&sa(location.hash.slice(1)),P(void 0,!0),T(),t.caj&&w(),se();break;case"conn":Va.setUser(t.user.id,t.user),K();break;case"disconn":Va.setUser(t.id,null),K();break;case"connRoom":Va._preQuick&&(ta("success"),La.dialog.quick.hide(),delete Va._preQuick),La.dialog.quick.hide(),Va.setUser(t.user.id,t.user),l=Va.usersR[t.user.id]=t.user,l.id==Va.id?p():ca((l.profile.title||l.profile.name)+L.hasJoined),K();break;case"disconnRoom":l=Va.usersR[t.id],l&&(delete Va.usersR[t.id],ca((l.profile.title||l.profile.name)+L.hasLeft),K());break;case"yell":Ta(t.value),ca(t.value,L.yell);break;case"dying":Ta(L.dying),ca(L.dying,L.yell);break;case"tail":ca(t.a+"|"+t.rid+"@"+t.id+": "+(t.msg instanceof String?t.msg:JSON.stringify(t.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"tail");break;case"chat":t.notice?ca(L["error_"+t.code]):pa(t.profile||{title:L.robot},t.value,t.from,t.timestamp);break;case"roomStuck":Oa.close();break;case"preRoom":C(t.channel,t.id);break;case"room":O(t),F(t.modify&&t.myRoom),P(t.myRoom),t.modify&&Va.room&&t.myRoom&&(Va._rTitle!=Va.room.title&&E(".room-head-title"),Va._rMode!=Xe(Va.room.mode,Va.room.opts,!0)&&E(".room-head-mode"),Va._rLimit!=Va.room.limit&&E(".room-head-limit"),Va._rRound!=Va.room.round&&E(".room-head-round"),Va._rTime!=Va.room.time&&E(".room-head-time"));break;case"user":Va.setUser(t.id,t),Va.room&&P(Va.room.id==t.place);break;case"friends":for(s in Va._friends={},t.list)t.list[s].forEach(function(e){Va._friends[e]={server:s}});se();break;case"friend":Va._friends[t.id]={server:"on"==t.stat&&t.s},Va._friends[t.id]&&Va.friends[t.id]&&ca(("on"==t.stat?"&lt;<b>"+L["server_"+Va._friends[t.id].server]+"</b>&gt; ":"")+L.friend+" "+Va.friends[t.id]+L["fstat_"+t.stat]),se();break;case"friendAdd":l=Va.users[t.from].profile,s=(l.title||l.name)+"(#"+t.from.substr(0,5)+")",n("friendAddRes",{from:t.from,res:!Va.opts.df&&confirm(s+L.attemptFriendAdd)},!0);break;case"friendAddRes":l=Va.users[t.target].profile,s=(l.title||l.name)+"(#"+t.target.substr(0,5)+")",ca(s+L["friendAddRes_"+(t.res?"ok":"no")]),t.res&&(Va.friends[t.target]=l.title||l.name,Va._friends[t.target]={server:Va.server},se());break;case"friendEdit":Va.friends=t.friends,se();break;case"starting":p(L.gameLoading);break;case"roundReady":v("roundReady",t);break;case"turnStart":v("turnStart",t);break;case"turnError":qe(t.code,t.value);break;case"turnHint":v("turnHint",t);break;case"turnEnd":t.score=+t.score,t.bonus=+t.bonus,Va.room&&(Va._tid=t.target||Va.room.game.seq[Va.room.game.turn],Va._tid&&(Va._tid.robot&&(Va._tid=Va._tid.id),De(Va._tid,t)),t.baby&&ta("success"));break;case"roundEnd":for(s in t.users)Va.setUser(s,t.users[s]);Va._resultRank=t.ranks,Oe(t.result,t.data);break;case"kickVote":Va._kickTarget=Va.users[t.target],Va.id!=t.target&&Va.id!=Va.room.master&&Be(t.target),ca((Va._kickTarget.profile.title||Va._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":ca(j(Va._kickTarget.profile,t));break;case"invited":n("inviteRes",{from:t.from,res:!Va.opts.di&&confirm(t.from+L.invited)});break;case"inviteNo":l=Va.users[t.target],ca((l.profile.title||l.profile.name)+L.inviteDenied);break;case"okg":Va._playTime>t.time?ca(L.okgExpired):Va._okg!=t.count&&ca(L.okgNotice+" ("+L.okgCurrent+t.count+")"),Va._playTime=t.time,Va._okg=t.count;break;case"obtain":_a(t);break;case"expired":for(s in t.list)ca(ha(t.list[s])+L.hasExpired);break;case"blocked":ca(L.blocked);break;case"test":(Va._test=!Va._test)?(Va._testt=k(function(){La.talk.val()!=Va._ttv&&(n("test",{ev:"c",v:La.talk.val()},!0),Va._ttv=La.talk.val())},100),document.onkeydown=function(e){n("test",{ev:"d",c:e.keyCode},!0)},document.onkeyup=function(e){n("test",{ev:"u",c:e.keyCode},!0)}):(clearInterval(Va._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":if(s=t.message||"",401==t.code);else if(403==t.code)p();else if(406==t.code){if(La.dialog.quick.is(":visible")){Va._preQuick=!1;break}}else if(409==t.code)s=L["server_"+s];else{if(416==t.code)return void(confirm(L["error_"+t.code])&&(ra(),Va._spectate=!0,Va._gaming=!0,n("enter",{id:t.target,password:Va._pw,spectate:!0},!0)));if(413==t.code)La.dialog.room.hide(),La.menu.setRoom.trigger("click");else if(429==t.code)oa("lobby");else if(430==t.code){if(Va.setRoom(t.message,null),La.dialog.quick.is(":visible")){Va._preQuick=!1;break}}else if(431==t.code||432==t.code||433==t.code)La.dialog.room.show();else if(444==t.code){if(s=t.message,-1!=s.indexOf("\uC0DD\uB144\uC6D4\uC77C")){alert("\uC0DD\uB144\uC6D4\uC77C\uC774 \uC62C\uBC14\uB974\uAC8C \uC785\uB825\uB418\uC9C0 \uC54A\uC544 \uAC8C\uC784 \uC774\uC6A9\uC774 \uC81C\uD55C\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574 \uC8FC\uC138\uC694.");break}}else if(447===t.code){alert("\uC790\uB3D9\uD654 \uBD07 \uBC29\uC9C0\uB97C \uC704\uD55C \uCEA1\uCC60 \uC778\uC99D\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uBA54\uC778 \uD654\uBA74\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574 \uC8FC\uC138\uC694.");break}}alert("[#"+t.code+"] "+L["error_"+t.code]+s);}Va._record&&we(t)}function T(){oa("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),_(function(){$("#Intro").hide()},2e3),Va.admin&&console.log("\uAD00\uB9AC\uC790 \uBAA8\uB4DC")}function j(e,a){var t=L.agree+" "+a.Y+", "+L.disagree+" "+a.N+L.kickCon;return t+=a.Y>=a.N?(e.title||e.name)+L.kicked:(e.title||e.name)+L.kickDenied,t}function q(e){var a,t,s={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(e[0].toLowerCase()){case"/\u3131":case"/r":Va.room&&(Va.room.master==Va.id?La.menu.start.trigger("click"):La.menu.ready.trigger("click"));break;case"/\uCCAD\uC18C":case"/cls":da();break;case"/\u3139":case"/f":u(La.dialog.chatLog),La.chatLog.scrollTop(999999999);break;case"/\uADD3":case"/\u3137":case"/e":S(e[1],e.slice(2).join(" "));break;case"/\uB2F5":case"/\u3137\u3137":case"/ee":Va._recentFrom?S(Va._recentFrom,e.slice(1).join(" ")):ca(L.error_425);break;case"/\uBB34\uC2DC":case"/wb":R(e[1]);break;case"/\uCC28\uB2E8":case"/shut":A(e.slice(1).join(" "));break;case"/id":if(e[1]){for(a in t=0,e[1]=e.slice(1).join(" "),Va.users)(Va.users[a].profile.title||Va.users[a].profile.name)==e[1]&&ca("["+ ++t+"] "+a);t||ca(L.error_405)}else ca(L.myId+Va.id);break;default:for(a in s)ca(s[a],a);}}function S(e,a){a.length&&(Va._whisper=e,n("talk",{whisper:e,value:a},!0),pa({title:"\u2192"+e},a,!0))}function R(e){Va._wblock.hasOwnProperty(e)?(delete Va._wblock[e],ca(e+L.wnblocked)):(Va._wblock[e]=!0,ca(e+L.wblocked))}function A(e){Va._shut.hasOwnProperty(e)?(delete Va._shut[e],ca(e+L.userNShut)):(Va._shut[e]=!0,ca(e+L.userShut))}function D(e,t){var e=e.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,""),s=e.match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";return 1>e.length?t({error:404}):void $.get("/dict/"+e+"?lang="+s,t)}function O(t){var a,s,l,m;if(t.myRoom=Va.place==t.room.id||t.target==Va.id,t.myRoom){if($target=Va.users[t.target],t.kickVote&&(ca(j($target.profile,t.kickVote)),$target.id==t.id&&alert(L.hasKicked)),-1==t.room.players.indexOf(Va.id))Va.room&&Va.room.gaming&&(ia(),Va.practicing=!1,Va._gaming=!1,La.box.room.height(360),oa("lobby")),Va.users[Va.id].game.ready=!1,Va.users[Va.id].game.team=0,Va.users[Va.id].game.form="J",La.menu.spectate.removeClass("toggled"),La.menu.ready.removeClass("toggled"),Va.room=null,Va.resulting=!1,Va._players=null,Va._master=null,Va.place=0,t.room.practice&&(delete Va.users[0],Va.room=Va._room,Va.place=Va._place,Va.master=Va.__master,Va._players=Va.__players,delete Va._room);else if(t.room.practice&&!Va.practicing&&(Va.practicing=!0,Va._room=Va.room,Va._place=Va.place,Va.__master=Va.master,Va.__players=Va._players),Va.room&&(Va._players=Va.room.players.toString(),Va._master=Va.room.master,Va._rTitle=Va.room.title,Va._rMode=Xe(Va.room.mode,Va.room.opts,!0),Va._rLimit=Va.room.limit,Va._rRound=Va.room.round,Va._rTime=Va.room.time),Va.room=t.room,Va.place=Va.room.id,Va.master=Va.room.master==Va.id,t.spec&&t.target==Va.id){if(Va._spectate||(Va._spectate=!0,xe(),Te()),t.boards){for(a in Va.selectedRound=1,t.prisoners)for(s in l=a.split(","),t.boards[l[0]])if(m=t.boards[l[0]][s],m[0]==l[1]&&m[1]==l[2]&&m[2]==l[3]){m[4]=t.prisoners[a];break}Ua.Crossword.roundReady(t,!0),Ua.Crossword.turnStart(t,!0)}for(a in t.spec)Va.users[a].game.score=t.spec[a]}t.modify||t.target!=Va.id||la()}if(t.target&&Va.users[t.target]&&(-1==t.room.players.indexOf(t.target)?Va.users[t.target].place=0:Va.users[t.target].place=t.room.id),!t.room.practice)if(t.room.players.length)for(a in Va.setRoom(t.room.id,t.room),t.room.readies)Va.users[a]&&(Va.users[a].game.ready=t.room.readies[a].r,Va.users[a].game.team=t.room.readies[a].t);else Va.setRoom(t.room.id,null)}function B(){return Va.place?Va.room.gaming||Va.resulting?"for-gaming":Va.master?"for-master":"for-normal":"for-lobby"}function P(e,a){var t,s=B();if(Va._replay){if(void 0!==e&&!e)return;ye()}if(!Va._replay&&("for-gaming"!=s||e)){for(t in Va.practicing&&(s="for-gaming"),$(".kkutu-menu button").hide(),La.box)La.box[t].hide();La.box.me.show(),La.box.chat.show().width(790).height(190),La.chat.height(120),"for-lobby"==s?(Va._ar_first=!0,La.box.userList.show(),Va._shop?(La.box.roomList.hide(),La.box.shop.show()):(La.box.roomList.show(),La.box.shop.hide()),K(a||s!=Va._only),V(a||s!=Va._only),G(),Va._jamsu&&(clearTimeout(Va._jamsu),delete Va._jamsu)):"for-master"==s||"for-normal"==s?($(".team-chosen").removeClass("team-chosen"),Va.users[Va.id].game.ready||"S"==Va.users[Va.id].game.form?(La.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):(La.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+Va.users[Va.id].game.team).addClass("team-chosen"),Va.opts.ar&&Va._ar_first&&(La.menu.ready.addClass("toggled"),La.menu.ready.trigger("click"),Va._ar_first=!1)),Va._shop=!1,La.box.room.show().height(360),"for-master"==s&&La.dialog.inviteList.is(":visible")&&K(),Q(!1),G()):"for-gaming"==s&&(Va._gAnim&&(La.box.room.show(),Va._gAnim=!1),Va._shop=!1,Va._ar_first=!0,La.box.me.hide(),La.box.game.show(),$(".ChatBox").width(1e3).height(140),La.chat.height(70),Q(!0)),Va._only=s,wa(Va.place),$(".kkutu-menu ."+s).show()}}function E(e){$(e).addClass("room-head-modified"),_(function(){$(e).removeClass("room-head-modified")},3e3)}function F(t){if(Va._players&&Va.room){var a,s,d=Va._players.split(","),e=d.length,l=Va.room.players.length;for(a in d)d[a]=="[object Object]"&&e--;for(a in Va.room.players)Va.room.players[a].robot&&l--;if(t){for(a in d)d[a]!="[object Object]"&&(Va.users[d[a]].game.ready=!1);ca(L.hasModified)}Va._gaming!=Va.room.gaming&&(Va.room.gaming?(ce(),Va._replay=!1,ve(Va.room.game.title)):(Va._spectate?(La.dialog.resultSave.hide(),Va._spectate=!1,oa("lobby")):(La.dialog.resultSave.show(),Va.resulting=!0),clearInterval(Va._tTime))),Va._master!=Va.room.master&&(s=Va.users[Va.room.master],ca((s.profile.title||s.profile.name)+L.hasMaster)),Va._players=Va.room.players.toString(),Va._master=Va.room.master,Va._gaming=Va.room.gaming}}function G(){var t,s=Va.users[Va.id],l=0,m=Qe(s.data.score),d=Ma[m-2]||0,e=Ma[m-1];for(t in s.data.record)l+=s.data.record[t][1];va(".my-image",s.equip),$(".my-stat-level").replaceWith(Ye(s.data.score).addClass("my-stat-level")),$(".my-stat-name").html(s.profile.title||s.profile.name),$(".my-stat-record").html(L.globalWin+" "+l+L.W),$(".my-stat-ping").html(Ca(s.money)+L.ping),$(".my-okg .graph-bar").width(Va._playTime%6e5/6e3+"%"),$(".my-okg-text").html(M(Va._playTime)),$(".my-level").html(L.LEVEL+" "+m),$(".my-gauge .graph-bar").width(190*((s.data.score-d)/(e-d))),$(".my-gauge-text").html(Ca(s.data.score)+" / "+Ca(e))}function M(t){var a=Math.floor(t/6e4)%60,s=Math.floor(.001*t)%60,l=Math.floor(t/36e5),d=[];return l&&d.push(l+L.HOURS),a&&d.push(a+L.MINUTE),l||d.push(s+L.SECOND),d.join(" ")}function K(t){var s,l,m,n=0;if(Va.opts.su){for(s in m=[],Va.users)n++,m.push(Va.users[s]);m.sort(function(e,a){return a.data.score-e.data.score}),t=!0}else for(s in m=Va.users,Va.users)n++;if(La.lobby.userListTitle.html("<i class='fa fa-users'></i>&lt;<b>"+L["server_"+Va.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+n+L.MN+"]"),t)for(s in La.lobby.userList.empty(),La.dialog.inviteList.empty(),m)l=m[s],l.robot||(La.lobby.userList.append(N(l)),0==l.place&&La.dialog.inviteList.append(N(l,!0)))}function N(e,a){var t;return t=a?$("<div>").attr("id","invite-item-"+e.id).addClass("invite-item users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Ye(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(e.profile.title||e.profile.name)).on("click",function(e){me($(e.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+e.id).addClass("users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Ye(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(e.profile.title||e.profile.name)).on("click",function(e){le($(e.currentTarget).attr("id").slice(11))}),I(t,e),t}function I(e,a){a.equip.NIK&&e.addClass("x-"+a.equip.NIK),"b1_gm"==a.equip.BDG&&e.addClass("x-gm")}function V(e){function a(){La.menu.newRoom.trigger("click")}var t,s=0;if(e)for(t in La.lobby.roomList.empty(),Va.rooms)La.lobby.roomList.append(U(Va.rooms[t])),s++;else for(t in $(".rooms-create").remove(),Va.rooms)s++;La.lobby.roomListTitle.html(L.RoomList.replace("FA{bars}","<i class='fa fa-bars'></i>")+" ["+s+L.GAE+"]"),s?($(".rooms-gaming").css("display",Va.opts.ow?"none":""),$(".rooms-locked").css("display",Va.opts.ou?"none":"")):La.lobby.roomList.append(La.lobby.createBanner.clone().on("click",a))}function U(e){var a,t,s=Xe(e.mode,e.opts);return a=$("<div>").attr("id","room-"+e.id).addClass("rooms-item").append(t=$("<div>").addClass("rooms-channel channel-"+e.channel).on("click",function(){de(e.id)})).append($("<div>").addClass("rooms-number").html(e.id)).append($("<div>").addClass("rooms-title ellipse").text(ma(e.title))).append($("<div>").addClass("rooms-limit").html(e.players.length+" / "+e.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(s.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+e.round)).append($("<div>").addClass("rooms-time").html(e.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(e.password?"<i class='fa fa-lock'></i>":"<i class='fa fa-unlock'></i>")).on("click",function(e){e.target!=t.get(0)&&sa($(e.currentTarget).attr("id").slice(5))}),e.gaming&&a.addClass("rooms-gaming"),e.password&&a.addClass("rooms-locked"),a}function W(t){var a,s,l,m=$("<div>").attr("id","game-user-"+t.id).addClass("game-user").append(a=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(Ye(t.data.score).addClass("game-user-level")).append(l=$("<div>").addClass("game-user-name ellipse").html(t.profile.title||t.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+Qe(t.data.score)))).append(s=$("<div>").addClass("game-user-score"));return va(a,t.equip),global.expl(m),I(l,t),t.game.team&&s.addClass("team-"+t.game.team),m}function H(e){var a,t,s=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(Ye(e.data.score).addClass("game-user-level")).append(t=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name))).append(a=$("<div>").addClass("game-user-score"));return e.id==Va.id&&t.addClass("game-user-my-name"),I(t,e),e.game.team&&a.addClass("team-"+e.game.team),s}function J(e){return{title:L["aiLevel"+e]+" "+L.robot,image:"/img/kkutu/robot.png"}}function Q(t){var a,s,p,u,y,v,C,w,x=Ra[ja[Va.room.mode]],T=Pa||x.big?H:W,k=!1,j=!0;if(Ze($(".RoomBox .product-title"),Va.room),Ze($(".GameBox .product-title"),Va.room),t){for(a in p=$(".GameBox .game-body").empty(),Va.room.game.seq)s=Va._replay?Ba.users[Va.room.game.seq[a]]||Va.room.game.seq[a]:Va.users[Va.room.game.seq[a]]||Va.robots[Va.room.game.seq[a].id]||Va.room.game.seq[a],s.robot&&!s.profile&&(s.profile=J(s.level),Va.robots[s.id]=s),p.append(T(s)),z(s.id,s.game.score||0);clearTimeout(Va._jamsu),delete Va._jamsu}else{for(a in p=$(".room-users").empty(),w="S"==Va.users[Va.id].game.form,Va.room.players)if(s=Va.users[Va.room.players[a]]||Va.room.players[a],s.game){var q=s.game.practice?"/"+L.stat_practice:"",w="S"==s.game.form&&"/"+L.stat_spectate;s.robot&&(s.profile=J(s.level),Va.robots[s.id]=s),p.append($("<div>").attr("id","room-user-"+s.id).addClass("room-user").append(v=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(u=$("<div>").addClass("room-user-ready")).append(y=$("<div>").addClass("room-user-team team-"+s.game.team).html($("#team-"+s.game.team).html()))).append($("<div>").addClass("room-user-title").append(Ye(s.data.score).addClass("room-user-level")).append(C=$("<div>").addClass("room-user-name").html(s.profile.title||s.profile.name))).on("click",function(e){le($(e.currentTarget).attr("id").slice(10))})),va(v,s.equip),w&&y.hide(),s.id==Va.room.master?u.addClass("room-user-master").html(L.master+q+(w||"")):w?u.addClass("room-user-spectate").html(L.stat_spectate+q):s.game.ready||s.robot?(u.addClass("room-user-readied").html(L.stat_ready),s.robot||(k=!0)):s.game.practice?(u.addClass("room-user-practice").html(L.stat_practice),j=!1):(u.html(L.stat_noready),j=!1),I(C,s)}k&&Va.room.master==Va.id&&j?Va._jamsu||(Va._jamsu=_(Y,5e3)):(clearTimeout(Va._jamsu),delete Va._jamsu)}La.dialog.profile.is(":visible")&&le(Va._profiled)}function Y(){ca(L.subJamsu),Va._jamsu=_(function(){n("leave"),alert(L.masterJamsu)},3e4)}function z(e,a){var t;return(t=Va["_s"+e])?(clearTimeout(t.timer),t.$obj=$("#game-user-"+e+" .game-user-score"),t.goal=a):t=Va["_s"+e]={$obj:$("#game-user-"+e+" .game-user-score"),goal:a,now:0},X(t),$("#game-user-"+e)}function X(e){var a=(e.goal-e.now)*Math.min(1,.01*Ga);.1>a?a=e.goal-e.now:e.timer=_(X,Ga,e),e.now+=a,Z(e.$obj,Math.round(e.now))}function Z(e,a){var t,s=99999<a?m(Math.round(.001*a),4)+"k":m(a,5);for(e.empty(),t=0;t<s.length;t++)e.append($("<div>").addClass("game-user-score-char").html(s[t]))}function ee(e){var a=$("#dress-view"),t=Va.users[Va.id];va(a,t.equip),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-exordial").val(t.exordial),oe(e||!0)}function ae(t,a,s,m,n){var e,p,c,u,_,y,v=[];for(y in t.empty(),m||(m={}),m)Va.box.hasOwnProperty(m[y])||(Va.box[m[y]]={value:0});for(y in Va.box)v.push({key:y,obj:ga(y),value:Va.box[y]});for(y in v.sort(function(e,a){return e.obj.name<a.obj.name?-1:1}),v)p=v[y].obj,c=v[y].value,u=p.group,"BDG"==u.substr(0,3)&&(u="BDG"),_="Mhand"==u?m.Mlhand==v[y].key||m.Mrhand==v[y].key:m[u]==v[y].key,"number"==typeof c&&(c={value:c}),(c.hasOwnProperty("value")||_)&&(!0===s||-1!=s.indexOf(p.group))&&(t.append(e=$("<div>").addClass("dress-item").append(ze(p.image).addClass("dress-item-image").html("x"+c.value)).append(Ge(p,_,c.expire))),e.attr("id",a+"-"+p._id).on("click",n),_&&e.addClass("dress-equipped"));global.expl(t)}function oe(e){var a,t=Va.users[Va.id].equip||{};Va._avGroup=e,a=!!(!0===e)||(e||"").split(","),ae($("#dress-goods"),"dress",a,t,function(t){var a,s=$(t.currentTarget),l=s.attr("id").slice(6),d=ga(l);if(t.ctrlKey){if(s.hasClass("dress-equipped"))return xa(426);if(!confirm(L.surePayback+Ca(Math.round(.2*(d.cost||0)))+L.ping))return;$.post("/payback/"+l,function(e){return e.error?xa(e.error):void(alert(L.painback),Va.box=e.box,Va.users[Va.id].money=e.money,ee(Va._avGroup),P(!1))})}else if(-1!=Sa.indexOf(d.group))"Mhand"==d.group&&(a=confirm(L.dressWhichHand)),re(l,a);else if("CNS"==d.group){if(!confirm(L.sureConsume))return;$.post("/consume/"+l,function(e){e.exp&&ca(L.obtainExp+": "+Ca(e.exp)),e.money&&ca(L.obtainMoney+": "+Ca(e.money)),e.gain.forEach(function(e){_a(e)}),Va.box=e.box,Va.users[Va.id].data=e.data,n("refresh"),ee(Va._avGroup),G()})}})}function re(t,a){var s=Va.users[Va.id],l=Va.shop[t].group;"Mhand"==l&&(l=a?"Mlhand":"Mrhand"),"BDG"==l.substr(0,3)&&(l="BDG");var m=s.equip[l]==t;confirm(L[m?"sureUnequip":"sureEquip"]+": "+L[t][0])&&$.post("/equip/"+t,{isLeft:a},function(e){return e.error?xa(e.error):void(Va.box=e.box,s.equip=e.equip,ee(Va._avGroup),n("refresh"),P(!1))})}function te(){function t(){d.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function s(){var s,c={WPC:1,WPB:2,WPA:3},u="",g=0;d.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),Va._tray.forEach(function(e){s=ga(e),u+=e.slice(4),g+=c[e.slice(1,4)],d.append($("<div>").addClass("jt-image").css("background-image","url("+s.image+")").attr("id","cf-tray-"+e).on("click",m)),$("#cf-\\"+e).addClass("cf-tray-selected")}),e.html(L.searching),n.empty(),La.dialog.cfCompose.removeClass("cf-composable"),p.html(""),D(u,function(t){var a=!1;if(t.error){if(3!=u.length)return e.html(L["wpFail_"+t.error]);a=!0,e.html(L.cfBlend)}l(u,g,a),La.dialog.cfCompose.addClass("cf-composable"),t.error||e.html(He(t.word,t.mean,t.theme,t.type.split(",")))}),""==u&&t()}function l(e,a,t){$.get("/cf/"+e+"?l="+a+"&b="+(t?"1":""),function(e){return e.error?xa(e.error):void(n.empty(),e.data.forEach(function(e){var a=ga(e.key),t=1<=e.rate?L.cfRewAlways:(100*e.rate).toFixed(1)+"%";n.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+a.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(a.name)).append($("<div>").addClass("cf-rew-value").html("x"+e.value))).append($("<div>").addClass("cf-rew-rate").html(t)))}),p.html(L.cfCost+": "+e.cost+L.ping))})}function m(e){var a=$(e.currentTarget).attr("id").slice(8),t=Va._tray.indexOf(a);-1!=t&&(Va._tray.splice(t,1),s())}var d=$("#cf-tray"),e=$("#cf-dict"),n=$("#cf-reward"),a=$("#cf-goods"),p=$("#cf-cost");Va._tray=[],e.empty(),n.empty(),p.html(""),La.dialog.cfCompose.removeClass("cf-composable"),ae(a,"cf",["PIX","PIY","PIZ"],null,function(t){var a,l=$(t.currentTarget),d=l.attr("id").slice(3),e=Va.box[d],m=0;if(6<=Va._tray.length)return xa(435);for(a in Va._tray)Va._tray[a]==d&&m++;0<e-m?(Va._tray.push(d),s()):xa(434)}),t()}function ie(e){var t=La.dialog.lbTable.empty(),a=e.data[0]?e.data[0].rank:0,s=(e.page||Math.floor(a/20))+1;e.data.forEach(function(e){var a=Va.users[e.id];a=a?a.profile.title||a.profile.name:L.hidden,e.score=+e.score,t.append($("<tr>").attr("id","ranking-"+e.id).addClass("ranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(Ye(e.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html(Qe(e.score)))).append($("<td>").html(a)).append($("<td>").html(Ca(e.score))))}),$("#ranking-"+Va.id).addClass("ranking-me"),La.dialog.lbPage.html(L.page+" "+s),La.dialog.lbPrev.attr("disabled",1>=s),La.dialog.lbNext.attr("disabled",15>e.data.length),La.dialog.lbMe.attr("disabled",!!Va.guest),Va._lbpage=s-1}function se(){function t(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),t=Va.friends[a],s=prompt(L.friendEditMemo,t);s&&n("friendEdit",{id:a,memo:s},!0)}function a(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),t=Va.friends[a];return Va._friends[a].server?xa(455):void(confirm(t+"(#"+a.substr(0,5)+")\n"+L.friendSureRemove)&&n("friendRemove",{id:a},!0))}var s,l,m,p,u=0;for(s in La.dialog.commFriends.empty(),Va.friends)u++,p=Va.friends[s],l=Va._friends[s]||{},m=(Va.users[s]||{}).profile,La.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+s).append($("<div>").addClass("cfi-status cfi-stat-"+(l.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(l.server?L["server_"+l.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(m?m.title||m.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(p)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("fa fa-pencil").on("click",t)).append($("<i>").addClass("fa fa-remove").on("click",a))));$("#CommunityDiag .dialog-title").html(L.communityText+" ("+u+" / 100)")}function de(e){var t=Va.rooms[e],s=$("#ri-players").empty();Va._roominfo=e,$("#RoomInfoDiag .dialog-title").html(e+L.sRoomInfo),$("#ri-title").html((t.password?"<i class='fa fa-lock'></i>&nbsp;":"")+t.title),$("#ri-mode").html(L["mode"+ja[t.mode]]),$("#ri-round").html(t.round+", "+t.time+L.SECOND),$("#ri-limit").html(t.players.length+" / "+t.limit),t.players.forEach(function(l,m){var d,n,p=t.readies[l]||{};l=Va.users[l]||Fa,t.players[m].robot?(l.profile={title:L.robot},l.equip={robot:!0}):p.t=p.t||0,s.append($("<div>").addClass("ri-player").append(n=$("<div>").addClass("moremi rip-moremi")).append(d=$("<div>").addClass("ellipse rip-title").html(l.profile.title||l.profile.name)).append($("<div>").addClass("rip-team team-"+p.t).html($("#team-"+p.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+p.f]))),l.id==t.master&&d.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),d.prepend(Ye(l.data.score).addClass("profile-level rip-level")),va(n,l.equip)}),u(La.dialog.roomInfo),La.dialog.roomInfo.show()}function le(t){var a,s,l,m=Va.users[t]||Va.robots[t],e=$("#profile-record").empty();if(!m)return void ca(L.error_405);if($("#ProfileDiag .dialog-title").html((m.profile.title||m.profile.name)+L.sProfile),$(".profile-head").empty().append(a=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append(ze(m.profile.image).addClass("profile-image")).append($("<div>").addClass("profile-title ellipse").html(m.profile.title||m.profile.name).append($("<label>").addClass("profile-tag").html(" #"+m.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").append(Ye(m.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(l=Qe(m.data.score)))).append($("<div>").addClass("profile-score-text").html(Ca(m.data.score)+" / "+Ca(Ma[l-1])+L.PTS))).append(s=$("<div>").addClass("profile-head-item profile-exordial ellipse").text(ma(m.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(m.exordial))),m.robot)La.dialog.profileLevel.show(),La.dialog.profileLevel.prop("disabled",Va.id!=Va.room.master),$("#profile-place").html(Va.room.id+L.roomNumber);else{for(l in La.dialog.profileLevel.hide(),$("#profile-place").html(m.place?m.place+L.roomNumber:L.lobby),m.data.record){var n=m.data.record[l];e.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+l])).append($("<div>").addClass("profile-field-record").html(n[0]+L.P+" "+n[1]+L.W)).append($("<div>").addClass("profile-field-score").html(Ca(n[2])+L.PTS)))}va(a,m.equip)}Va._profiled=t,La.dialog.profileKick.hide(),La.dialog.profileShut.hide(),La.dialog.profileDress.hide(),La.dialog.profileWhisper.hide(),La.dialog.profileHandover.hide(),Va.id==t?La.dialog.profileDress.show():m.robot||(La.dialog.profileShut.show(),La.dialog.profileWhisper.show()),Va.room&&Va.id!=t&&Va.id==Va.room.master&&(La.dialog.profileKick.show(),La.dialog.profileHandover.show()),u(La.dialog.profile),La.dialog.profile.show(),global.expl(s)}function me(e){var a;("AI"==e||(a=Va.users[e].profile.title||Va.users[e].profile.name,confirm(a+L.sureInvite)))&&n("invite",{target:e})}function ne(e){Va._replay||Va.lastFail!=Va.id||Va.id!=e?Va.failCombo=0:(Va.failCombo++,1==Va.failCombo&&ca(L.trollWarning),1<Va.failCombo&&(n("leave"),xa(437))),Va.lastFail=e}function pe(){Va._spaced&&Ua.Typing.spaceOff(),clearInterval(Va._tTime),Va._relay=!1}function ce(){var e,t;for(e in Va.room.players)t=Va._replay?Ba.users[Va.room.players[e]]||Va.room.players[e]:Va.users[Va.room.players[e]]||Va.robots[Va.room.players[e].id],t.game.score=0,delete Va["_s"+Va.room.players[e]];delete Va.lastFail,Va.failCombo=0,Va._spectate=-1==Va.room.game.seq.indexOf(Va.id),Va._gAnim=!0,La.box.room.show().height(360).animate({height:1},500),La.box.game.height(1).animate({height:410},500),ra(),La.dialog.resultSave.attr("disabled",!1),xe(),La.game.display.html(L.soon),ta("game_start"),la(),_(function(){La.box.room.height(360).hide(),La.chat.scrollTop(999999999)},500)}function ue(){for(var t in Va.room.game.seq)Va.room.game.seq[t].robot&&(Va.room.game.seq[t].game.score=0);for(t in Ba.users={},Ba.players){var s=Ba.players[t].id,l=Ba.readies[s]||{},m=Va.users[s]||Va.robots[s],n=s;Ba.players[t].robot?(m=Ba.users[s]={robot:!0},n=Ba.players[t],n.game={}):m=Ba.users[s]={},Va.room.players.push(n),m.id=n,m.profile=Ba.players[t],m.data=m.profile.data,m.equip=m.profile.equip,m.game={score:0,team:l.t}}Va._rf=0}function ge(){for(var e in ye(),Va._replay=!0,Va.room={title:Ba.title,players:[],events:[],time:Ba.roundTime,round:Ba.round,mode:Ba.mode,limit:Ba.limit,game:Ba.game,opts:Ba.opts,readies:Ba.readies},ue(),Ba.events)Va.room.events.push(Ba.events[e]);La.box.userList.hide(),La.box.roomList.hide(),La.box.game.show(),La.dialog.replay.hide(),ce(),Q(!0),Va.$gp=$(".GameBox .product-title").empty().append(Va.$gpt=$("<div>").addClass("game-replay-title")).append(Va.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",fe)).append($("<button>").html(L.replayPause).on("click",be)).append($("<button>").html(L.replayPrev).on("click",he))),Va._gpp=L.replay+" - "+new Date(Ba.time).toLocaleString(),Va._gtt=Va.room.events[Va.room.events.length-1].time,Va._eventTime=0,Va._rt=_(_e,2e3),Va._rprev=0,Va._rpause=!1,ke()}function he(){var e,a,t=Va.room.events[--Va._rf];if(t){e=t.time;do if(!(t=Va.room.events[--Va._rf]))break;while(1e3>e-t.time);for(a=Va._rf-1,ue(),e=Va.muteEff,Va.muteEff=!0,i=0;i<a;i++)_e();$(".deltaScore").remove(),Va.muteEff=e,_e()}}function be(e){var a=Va._rpause=!Va._rpause;$(e.target).html(a?L.replayResume:L.replayPause)}function fe(){clearTimeout(Va._rt),_e()}function ke(){Va.$gpt.html(Va._gpp+" ("+(.001*Va._eventTime).toFixed(1)+L.SECOND+" / "+(.001*Va._gtt).toFixed(1)+L.SECOND+")")}function _e(e){var a,t=Va.room.events[Va._rf];return clearTimeout(Va._rt),e||Va._rf++,t?Va._rpause?(Va._rf--,Va._rt=_(_e,100)):(a=t.data,a.hint&&(a.hint={_id:a.hint}),"chat"==a.type&&(a.timestamp=Ba.time+t.time),x(a),Va._eventTime=t.time,ke(),void(Va.room.events.length>Va._rf?Va._rt=_(_e,Va.room.events[Va._rf].time-t.time):ye())):void ye()}function ye(){delete Va.room,Va._replay=!1,La.box.room.height(360),clearTimeout(Va._rt),P(),oa("lobby")}function ve(){var e,a;for(e in Ba={version:Va.version,me:Va.id,players:[],events:[],title:Va.room.title,roundTime:Va.room.time,round:Va.room.round,mode:Va.room.mode,limit:Va.room.limit,game:Va.room.game,opts:Va.room.opts,readies:Va.room.readies,time:new Date().getTime()},Va.room.players){var t;a=Va.users[Va.room.players[e]]||Va.room.players[e],t={id:a.id,score:0},a.robot?(t.id=a.id,t.robot=!0,t.data={score:0},a={profile:J(a.level)}):(t.data=a.data,t.equip=a.equip),t.title="#"+a.id,Ba.players.push(t)}Va._record=!0}function Ce(){Va._record=!1}function we(e){if(!Va._replay&&Ba){var t,s=e;if(e.hasOwnProperty("type")&&"room"!=e.type&&"obtain"!=e.type){for(t in e={},s)e[t]=s[t];e.profile&&(e.profile={id:e.profile.id,title:"#"+e.profile.id}),e.user&&(e.user={id:e.user.profile.id,profile:{id:e.user.profile.id,title:"#"+e.user.profile.id},data:{score:0},equip:{}}),Ba.events.push({data:e,time:new Date().getTime()-Ba.time})}}}function xe(){Va._relay=!1,p(),La.game.here.hide(),La.dialog.result.hide(),La.dialog.dress.hide(),La.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),La.game.display.empty(),La.game.chain.hide(),La.game.hints.empty().hide(),La.game.cwcmd.hide(),La.game.bb.hide(),La.game.round.empty(),La.game.history.empty(),La.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function Te(e){var a;for(La.game.round.empty(),a=0;a<Va.room.round;a++)La.game.round.append($l=$("<label>").html(Va.room.game.title[a])),a+1==e&&$l.addClass("rounds-current")}function je(){v("turnGoing")}function qe(e,a){La.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+e]?L["turnError_"+e]+": ":"")+a)),ta("fail"),clearTimeout(Va._fail),Va._fail=_(function(){La.game.display.html(Va._char)},1800)}function Se(e){return Va._replay?Ba.users[e].game.score:(Va.users[e]||Va.robots[e]).game.score}function Re(e,a){Va._replay?Ba.users[e].game.score+=a:(Va.users[e]||Va.robots[e]).game.score+=a}function Ae(e,a){return e.append(a),_(function(){a.remove()},2e3),e}function De(e,a){v("turnEnd",e,a)}function Oe(t,a){function s(){var a,t,d;Va._result.goal=Ma[Va._result.level-1],Va._result.before=Ma[Va._result.level-2]||0,0<Va._result.reward.score&&(a=Va._result.reward.score*Va._coef,.05>a&&Va._coef&&(a=Va._result.reward.score),Va._result.reward.score-=a,Va._result.exp+=a,t=Qe(Va._result.exp),Va._result.level!=t&&(Va._result._boing-=Va._result.goal-Va._result._exp,Va._result._exp=Va._result.goal,ta("lvup")),Va._result.level=t,_(s,50)),d=Va._result.exp-Va._result._exp,p("before",Va._result._exp,Va._result.before,Va._result.goal),p("current",Math.min(d,Va._result._boing),0,Va._result.goal-Va._result.before),p("bonus",Math.max(0,d-Va._result._boing),0,Va._result.goal-Va._result.before),$(".result-me-level-body").html(Va._result.level),$(".result-me-score-text").html(Ca(Math.round(Va._result.exp))+" / "+Ca(Va._result.goal))}function p(e,a,t,s){$(".result-me-"+e+"-bar").width(100*((a-t)/(s-t))+"%")}a||(a={});var d,c,y,v,C,w,x,T,q,S=$(".result-board").empty();for(d in $(".result-me-expl").empty(),La.game.display.html(L.roundEnd),Va._resultPage=1,Va._result=null,t)y=t[d],c=Va._replay?Ba.users[y.id]:Va.users[y.id],c||(c=Fa),c.data&&y.reward&&(y.reward.score=Va._replay?0:Math.round(y.reward.score),w=Qe(x=c.data.score)>Qe(c.data.score-y.reward.score),S.append(v=$("<div>").addClass("result-board-item").append(C=$("<div>").addClass("result-board-rank").html(y.rank+1)).append(Ye(x).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(c.profile.title||c.profile.name)).append($("<div>").addClass("result-board-score").html(a.scores?L.avg+" "+Ca(a.scores[y.id])+L.kpm:Ca(y.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(y.reward.score?"+"+Ca(y.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",w?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(L.lvUp)))),c.game.team&&C.addClass("team-"+c.game.team),y.id==Va.id&&(y.exp=c.data.score-y.reward.score,y.level=Qe(y.exp),Va._result=y,v.addClass("result-board-me"),$(".result-me-expl").append(function(t,a,s){function n(e,a,t){e.append($("<h5>").addClass("result-me-blog-head").html(a)).append($("<h5>").addClass("result-me-blog-body").html(t))}var d,p,l=$("<div>").append($("<h4>").html(L.scoreGain)).append(d=$("<div>")).append($("<h4>").html(L.moneyGain)).append(p=$("<div>"));return n(d,L.scoreOrigin,t),n(p,L.moneyOrigin,a),s.forEach(function(e){var s,c,u,f=e.charAt(0),_=e.charAt(1),k=e.slice(2,5),l=+e.slice(5);"EXP"==k?(s=d,u=t):"MNY"==k&&(s=p,u=a),"g"==_?c="+"+(u*l).toFixed(1):"h"==_&&(c="+"+Math.floor(l)),n(s,L["bonusFrom_"+f],c)}),l}(y.reward._score,y.reward._money,y.reward._blog))));$(".result-me").css("opacity",0),Va._coef=0,Va._result&&(T=Va._result.reward.score-Va._result.reward._score,q=Va._result.reward.money-Va._result.reward._money,Va._result._exp=Va._result.exp,Va._result._score=Va._result.reward.score,Va._result._bonus=T,Va._result._boing=Va._result.reward._score,Va._result._addit=T,Va._result._addp=q,T=0<T?"<label class='result-me-bonus'>(+"+Ca(T)+")</label>":"",q=0<q?"<label class='result-me-bonus'>(+"+Ca(q)+")</label>":"",ca(L.scoreGain+": "+Ca(Va._result.reward.score)+", "+L.moneyGain+": "+Ca(Va._result.reward.money)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+Ca(Va._result.reward.score)+T),$(".result-me-money").html(L.moneyGain+" +"+Ca(Va._result.reward.money)+q)),_(function(){u(La.dialog.result),Va._result&&s(!0),La.dialog.result.css("opacity",0).animate({opacity:1},500),_(function(){Va._coef=.05},500)},2e3),Ce()}function Le(t){var a,s,l,m=$(".result-board").empty();if(Va._resultPage=2,!t)return La.dialog.resultOK.trigger("click");for(i in t.list)r=t.list[i],o=Va.users[r.id]||{profile:{title:L.hidden}},l=r.id==Va.id,m.append(a=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(Ye(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(Ca(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(s=$("<div>").addClass("result-board-lvup").css("display",l?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(t.prev-r.rank)))),l&&(0>=t.prev-r.rank&&s.hide(),a.addClass("result-board-me"))}function Be(e){var a=Va.users[e].profile;$("#kick-vote-text").html((a.title||a.name)+L.kickVoteText),Va.kickTime=10,Va._kickTime=10,Va._kickTimer=_(Pe,1e3),u(La.dialog.kickVote)}function Pe(){$(".kick-vote-time .graph-bar").width(300*(Va.kickTime/Va._kickTime)),0<--Va.kickTime?Va._kickTimer=_(Pe,1e3):La.dialog.kickVoteY.trigger("click")}function Ee(){var t=$("#shop-shelf");t.html(L.LOADING),Me(function(e){return(t.empty(),Va.guest&&(e.error=423),e.error)?(La.menu.shop.trigger("click"),xa(e.error)):void(e.goods.sort(function(e,a){return a.updatedAt-e.updatedAt}).forEach(function(a){if(!(0>a.cost)){var s=fa(!1,a);t.append($("<div>").attr("id","goods_"+a._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+s+")")).append($("<div>").addClass("goods-title").html(ha(a._id))).append($("<div>").addClass("goods-cost").html(Ca(a.cost)+L.ping)).append(Ge(a,!1)).on("click",Ke))}}),global.expl(t))}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}function Fe(t){var s,l,m,n=!0===t;for(m in n||(t=t.split(",")),Va.shop)l=Va.shop[m],0>l.cost||(s=$("#goods_"+m).show(),n||-1==t.indexOf(l.group)&&s.hide())}function Ge(t,a,s){var l,m,n=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(ha(t._id)+(a?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+t.group])).append($("<div>").addClass("dress-item-expl").html(ba(t._id))),p=$("<div>").addClass("dress-item-opts");for(l in t.term&&n.append($("<div>").addClass("dress-item-term").html(Math.floor(t.term/86400)+L.DATE+" "+L.ITEM_TERM)),s&&n.append($("<div>").addClass("dress-item-term").html(new Date(1e3*s).toLocaleString()+L.ITEM_TERMED)),t.options)if("gif"!=l){var c=l.charAt(0);m=t.options[l],"g"==c?m="+"+(100*m).toFixed(1)+"%p":"h"==c&&(m="+"+m),p.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+l])).append($("<label>").addClass("item-opts-body").html(m)).append($("<br>"))}return m&&n.append(p),n}function Me(e){var a;$.get("/shop",function(t){for(a in Va.shop={},t.goods)Va.shop[t.goods[a]._id]=t.goods[a];e&&e(t)})}function Ke(t){var a,s,l=$(t.currentTarget).attr("id").slice(6),d=Va.shop[l],e=Va.users[Va.id],m=e.money,n=m-d.cost,p=L.surePurchase,g={};for(s in Va.box&&Va.box[l]&&(p=L.alreadyGot+" "+p),u(La.dialog.purchase,!0),$("#purchase-ping-before").html(Ca(m)+L.ping),$("#purchase-ping-cost").html(Ca(d.cost)+L.ping),$("#purchase-item-name").html(L[l][0]),a=$("#purchase-ping-after").html(Ca(n)+L.ping),$("#purchase-item-desc").html(0>n?L.notEnoughMoney:p),e.equip)g[s]=e.equip[s];g["Mhand"==d.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:d.group]=l,va("#moremi-after",g),Va._sgood=l,La.dialog.purchaseOK.attr("disabled",0>n),0>n?a.addClass("purchase-not-enough"):a.removeClass("purchase-not-enough")}function Ne(e){1>e||($("#Middle").css("padding-top",e),_(function(){$("#Middle").css("padding-top",0),_(Ne,50,.7*e)},50))}function Ie(t,a,s,c){var d,u,y,v,C,w=ja[Va.room.mode],x="KKT"==w,k="KAP"==w,l=Ea[d=t.length],T=0,j=Va.turnTime/96,q=Va.turnTime/12;if(La.game.display.empty(),l?(u="As"+Va._speed,l=l.split("")):"en"==Ra[w].lang&&10>d?u="As"+Va._speed:(u="Al",Ne(d)),y="K"+Va._speed,l){for(v in l)"0"!=l[v]&&(La.game.display.append(C=$("<div>").addClass("display-text").css({float:k?"right":"left","margin-top":-6,"font-size":36}).hide().html(k?t.charAt(d-T-1):t.charAt(T))),T++,_(function(e,a){var t={"margin-top":0};ta(a),e.html()==Va.mission?(ta("mission"),e.css({color:"#66FF66"}),t["font-size"]=24):t["font-size"]=20,e.show().animate(t,100)},+v*j,C,u));v=La.game.display.children("div").get(0),$(v).css(k?"margin-right":"margin-left",.5*(La.game.display.width()-20*d))}else if(T="",k)for(v=0;v<d;v++)_(function(e){ta(u),e==Va.mission?(ta("mission"),T="<label style='color: #66FF66;'>"+e+"</label>"+T):T=e+T,La.game.display.html(T)},+v*q/d,t[d-v-1]);else for(v=0;v<d;v++)_(function(e){ta(u),e==Va.mission?(ta("mission"),T+="<label style='color: #66FF66;'>"+e+"</label>"):T+=e,La.game.display.html(T)},+v*q/d,t[v]);_(function(){for(v=0;3>v;v++)_(function(e){if(x){if(1==e)return;ta("kung")}(l?La.game.display.children(".display-text"):La.game.display).css("font-size",21).animate({"font-size":20},j)},2*(v*j),v);_(Ue,4*j,t,a,s,c),x||ta(y)},q)}function Ve(e){var a,t=He("",e);La.game.hints.append(a=$("<div>").addClass("hint-item").append($("<label>").html(t)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(t.html()))),Pa||a.width(0).animate({width:215}),global.expl(a)}function Ue(t,a,s,l){var d,m,n,p=l?l.split(","):[],c={};La.game.history.prepend(d=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(t)),m=La.game.history.children(),6<m.length&&m.last().remove(),n=He(t,a,s,p),p.forEach(function(e){c[e]||L["class_"+e]&&(c[e]=!0,d.append($("<label>").addClass("history-class").html(L["class_"+e])))}),d.append(m=$("<div>").addClass("history-mean ellipse").append(n)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+n.html()+"</h5>")),global.expl(d)}function We(e,a){return $("<label>").addClass("word").html(a)}function He(t,a,s,l){function m(e){return e.replace(/\$\$[^\$]+\$\$/g,function(e){return"<equ>"+e.slice(2,e.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"\u2265")+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>")}if(!a||-1==a.indexOf("\uFF02"))return We(t,a);var e=$("<label>").addClass("word"),d=a.split(/＂[0-9]+＂/).slice(1).map(function(e){return-1==e.indexOf("\uFF3B")?[[e]]:e.split(/［[0-9]+］/).slice(1).map(function(e){return e.split(/（[0-9]+）/).slice(1)})}),n=(l&&l.map(function(e){return L["class_"+e]}),s?s.split(",").map(function(e){return L["theme_"+e]}):[]),p=1<d.length;return d.forEach(function(t,a){var s=$("<label>").addClass("word-m1"),l=1<t.length;p&&s.append($("<label>").addClass("word-head word-m1-head").html(a+1)),t.forEach(function(e,a){var t=$("<label>").addClass("word-m2"),p=e.length,u=n.splice(0,p);l&&t.append($("<label>").addClass("word-head word-m2-head").html(a+1)),e.forEach(function(e,a){var s=$("<label>").addClass("word-m3"),l=u.shift();1<p&&s.append($("<label>").addClass("word-head word-m3-head").html(a+1)),l&&s.append($("<label>").addClass("word-theme").html(l)),s.append($("<label>").addClass("word-m3-body").html(m(e))),t.append(s)}),s.append(t)}),e.append(s)}),e}function Je(e,a,t){var s=e+(a?"("+a+")":"");return t&&(s+="<label class='jjo-display-word-length'>("+t+")</label>"),s}function $e(e){return Math.round((.3*!(e%5)+1)*(.4*!(e%15)+1)*(.5*!(e%45)+1)*(120+60*Math.floor(e/5)+120*Math.floor(e*e/225)+180*Math.floor(e*e/2025)))}function Qe(e){var a,t=Ma.length;for(a=0;a<t&&!(e<Ma[a]);a++);return a+1}function Ye(e){var a=Qe(e)-1,t=-100*Math.floor(.04*a);return $("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/newlv.png')","background-position":-100*(a%25)+"% "+t+"%","background-size":"2560%"})}function ze(e){return $("<div>").addClass("jt-image").css("background-image","url('"+e+"')")}function Xe(t,a,s){var l,m,n=[L["mode"+ja[t]]];for(l in Aa)m=Aa[l].name.toLowerCase(),a[m]&&n.push(L["opt"+Aa[l].name]);return s&&n.push(a.injpick.join("|")),s?n.toString():n}function Ze(t,a){var s,l=Xe(a.mode,a.opts),d=Ra[ja[a.mode]];t.empty().append($("<h5>").addClass("room-head-number").html("["+(a.practice?L.practice:a.id)+"]")).append($("<h5>").addClass("room-head-title").text(ma(a.title))).append(s=$("<h5>").addClass("room-head-mode").html(l.join(" / "))).append($("<h5>").addClass("room-head-limit").html((Pa?"":L.players+" ")+a.players.length+" / "+a.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+a.round)).append($("<h5>").addClass("room-head-time").html(a.time+L.SECOND)),-1!=d.opts.indexOf("ijp")&&(s.append($("<div>").addClass("expl").html("<h5>"+a.opts.injpick.map(function(e){return L["theme_"+e]})+"</h5>")),global.expl(t))}function ea(e,t){Va._lsRemain=e.length,e.forEach(function(e){aa(e.key,e.value,t)})}function aa(t,a,s){function l(){Na[t]=new e(a),d()}function d(){0==--Va._lsRemain?s&&s():p(L.loadRemain+Va._lsRemain)}function e(e){var a=this;this.audio=new Audio(e),this.audio.load(),this.start=function(){a.audio.play()},this.stop=function(){a.audio.currentTime=0,a.audio.pause()}}var m=new XMLHttpRequest;m.open("GET",a),m.responseType="arraybuffer",m.onload=function(e){Wa?Wa.decodeAudioData(e.target.response,function(e){Na[t]=e,d()},l):l()},m.send()}function oa(e){return Va.bgm&&Va.bgm.stop(),Va.bgm=ta(e,!0)}function ra(){Va.bgm&&(Va.bgm.stop(),delete Va.bgm)}function ta(t,a){var s,l,m=a&&Va.muteBGM||!a&&Va.muteEff;return l=Na[t]||Na.missing,window.hasOwnProperty("AudioBuffer")&&l instanceof AudioBuffer?(s=Wa.createBufferSource(),s.startedAt=Wa.currentTime,s.loop=a,s.buffer=m?Wa.createBuffer(2,l.length,Wa.sampleRate):l,s.connect(Wa.destination)):(l.readyState&&(l.audio.currentTime=0),l.audio.loop=a||!1,l.audio.volume=m?0:1,s=l),Ia[t]&&Ia[t].stop(),Ia[t]=s,s.key=t,s.start(),s}function ia(){for(var e in Ia)Ia[e].stop()}function sa(e){var a;Va.rooms[e]&&(Va.rooms[e].password&&!(a=prompt(L.putPassword))||(Va._pw=a,n("enter",{id:e,password:a})))}function da(){$("#Chat").empty()}function la(){var e=$("#Chat,#chat-log-board"),a=e.children(".chat-item").last().get(0);a&&"HR"==a.tagName||(e.append($("<hr>").addClass("chat-item")),La.chat.scrollTop(999999999))}function ma(e){return e.replace(Ka,"\u2665\u2665")}function na(t,a,s){$("#cb-"+a).remove();var l,m,n=(2&s?$("#game-user-"+a):$("#room-user-"+a)).offset(),p=2==s?"chat-balloon-bot":"chat-balloon-tip",c=$("<div>").addClass("chat-balloon").attr("id","cb-"+a).append($("<div>").addClass("jt-image "+p))[2==s?"prepend":"append"]($("<h4>").text(t));n&&(La.balloons.append(c),1==s?(l=0,m=220):2==s?(l=35-c.height(),m=-2):3==s?(l=5,m=210):(l=40,m=110),c.css({top:n.top+l,left:n.left+m}),_(function(){c.animate({opacity:0},500,function(){c.remove()})},2500))}function pa(t,s,a,l){var d,m,n,p,c=l?new Date(l):new Date,u=Va.users[t.id]?Va.users[t.id].equip:{};if(!Va._shut[t.title||t.name]){if(a){if(Va.opts.dw)return;if(Va._wblock[a])return}s=ma(s),ta("k"),ua(),!Pa&&Va.room&&(d=(Va.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),na(s,t.id,d)),La.chat.append(n=$("<div>").addClass("chat-item").append(d=$("<div>").addClass("chat-head ellipse").text(t.title||t.name)).append(m=$("<div>").addClass("chat-body").text(s)).append($("<div>").addClass("chat-stamp").text(c.toLocaleTimeString()))),l&&d.prepend($("<i>").addClass("fa fa-video-camera")),d.on("click",function(){le(t.id)}),La.chatLog.append(n=n.clone()),n.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(t.id||"").substr(0,5))),(p=s.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(s=m.html(),p.forEach(function(e){s=s.replace(e,"<a href='#' style='color: #2222FF;' onclick='if(confirm(\""+L.linkWarning+"\")) window.open(\""+e+"\");'>"+e+"</a>")}),m.html(s)),a&&(!0!==a&&(Va._recentFrom=a),m.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+m.html())),I(d,{equip:u}),La.chat.scrollTop(999999999)}}function ca(e,a){var t=new Date;ta("k"),ua(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(a||L.notice)).append($("<div>").addClass("chat-body").html(e)).append($("<div>").addClass("chat-stamp").text(t.toLocaleTimeString()))),La.chat.scrollTop(999999999),"tail"==a&&console.warn(t.toLocaleString(),e)}function ua(){var e=$("#Chat .chat-item"),a=$("#chat-log-board .chat-item");99<e.length&&e.first().remove(),199<a.length&&a.first().remove()}function ga(e){var a;return a="$"==e.charAt()?Va.shop[e.slice(0,4)]:Va.shop[e],{_id:e,group:a.group,term:a.term,name:ha(e),cost:a.cost,image:fa(e,a),desc:ba(e),options:a.options}}function ha(e){return"$"==e.charAt()?L[e.slice(0,4)][0]+" - "+e.slice(4):L[e][0]}function ba(e){return"$"==e.charAt()?L[e.slice(0,4)][1]:L[e][1]}function fa(e,a){var t,s;if(!e)"string"==typeof a&&(a={_id:"def",group:a,options:{}});else if("$"==e.charAt())return ka(e.slice(1,4),e.slice(4));return t=Va.shop[e]||a,s=t.options.hasOwnProperty("gif")?".gif":".png","BDG"==t.group.slice(0,3)?"/img/kkutu/moremi/badge/"+t._id+s:"M"==t.group.charAt(0)?"/img/kkutu/moremi/"+t.group.slice(1)+"/"+t._id+s:"/img/kkutu/shop/"+t._id+".png"}function ka(t,a){var s,l=document.createElement("canvas"),d=l.getContext("2d");switch(l.width=l.height=50,d.font="24px NBGothic",d.textAlign="center",d.textBaseline="middle",t){case"WPC":case"WPB":case"WPA":s=["WPC","WPB","WPA"].indexOf(t),d.beginPath(),d.arc(25,25,25,0,2*Math.PI),d.fillStyle=["#DDDDDD","#A6C5FF","#FFEF31"][s],d.fill(),d.fillStyle=["#000000","#4465C3","#E69D12"][s],d.fillText(a,25,25);}return l.toDataURL()}function _a(e){La.dialog.obtain.is(":visible")?Va._obtain.push(e):(ya(e),u(La.dialog.obtain,!0))}function ya(e){ta("success"),$("#obtain-image").css("background-image","url("+fa(e.key)+")"),$("#obtain-name").html(ha(e.key))}function va(t,a){var s,l,m=$(t).empty(),e={Mlhand:"Mhand",Mrhand:"Mhand"};for(s in a||(a={}),qa)l="M"+qa[s],m.append($("<img>").addClass("moremies moremi-"+l.slice(1)).attr("src",fa(a[l],e[l]||l)).css({width:"100%",height:"100%"}));(l=a.BDG)&&m.append($("<img>").addClass("moremies moremi-badge").attr("src",fa(l)).css({width:"100%",height:"100%"})),m.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",a.robot?"/img/kkutu/moremi/robot.png":"/img/kkutu/moremi/body.png").css({width:"100%",height:"100%"})),m.children(".moremi-rhand").css("transform","scaleX(-1)")}function Ca(e){var t=/(^[+-]?\d+)(\d{3})/;if(null===e)return"?";for(e=e.toString();t.test(e);)e=e.replace(t,"$1,$2");return e}function wa(e){location.hash=e?"#"+e:""}function xa(e){return alert(L["error_"+e])}function Ta(e){La.yell.show().css("opacity",1).html(e),_(function(){La.yell.animate({opacity:0},3e3),_(function(){La.yell.hide()},3e3)},1e3)}var ja,qa,Sa,Ra,Aa,Da,Oa,La,Ba,Pa,Ea=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],Fa={profile:{title:L.null},data:{score:0}},Ga=30,Ma=[],Ka=new RegExp("\uB290\uC73C*[^\uAC00-\uD7A3]*\uAE08\uB9C8?|\uB2C8[^\uAC00-\uD7A3]*(\uC5C4|\uC570|\uC5E0)|(\u3144|\u3145\u3142|\u3142\u3145)|\uBBF8\uCE5C(\uB144|\uB188)?|(\uBCD1|\uBE05|\uBE59)[^\uAC00-\uD7A3]*\uC2E0|\uBCF4[^\uAC00-\uD7A3]*\uC9C0|(\uC0C8|\uC100|\uC314|\uC34C)[^\uAC00-\uD7A3]*(\uAE30|\uB07C)|\uC139[^\uAC00-\uD7A3]*\uC2A4|(\uC2DC|\uC528|\uC26C|\uC4B8)\uC774*\uC785?[^\uAC00-\uD7A3]*(\uBC1C|\uBE68|\uBC8C|\uBED8|\uD314|\uD384)|\uC2ED[^\uAC00-\uD7A3]*\uC0C8|\uC539|(\uC560|\uC5D0)[^\uAC00-\uD7A3]*\uBBF8|\uC790[^\uAC00-\uD7A3]*\uC9C0|\uC874[^\uAC00-\uD7A3]*\uB098|\uC886|\uC8F6|\uC9C0\uB784|\uCC3D[^\uAC00-\uD7A3]*(\uB140|\uB144|\uB188)|fuck|sex","g"),Na={},Ia={},Va={},Ua={Classic:{},Jaqwi:{},Crossword:{},Typing:{},Hunmin:{},Daneo:{},Sock:{}},Wa=!!window.hasOwnProperty("AudioContext")&&new AudioContext,Ha=window.WebSocket,Ja=setInterval,$a=setTimeout;$(document).ready(function(){function t(t,a,s){var l=t.position();$(window).on("mousemove",function(d){var e=d.pageX-a,m=d.pageY-s;t.css("left",l.left+e),t.css("top",l.top+m)})}function a(){$(window).off("mousemove")}function s(e,a){var t,s;for(t in Aa)s=Aa[t].name.toLowerCase(),-1==e.indexOf(t)?$("#"+a+"-"+s+"-panel").hide():$("#"+a+"-"+s+"-panel").show()}function l(e){var a,t,s={};for(a in Aa)t=Aa[a].name.toLowerCase(),$("#"+e+"-"+t).is(":checked")&&(s[t]=!0);return s}function d(t,a,s,l){if(!l){if(t.gaming)return!1;if(t.password)return!1;if(t.players.length>=t.limit)return!1}if(t.mode!=a)return!1;for(var d in s)if(!t.opts[d])return!1;return!0}function e(e){$(".team-selector").hasClass("team-unable")||n("team",{value:$(e.currentTarget).attr("id").slice(5)})}function m(){La.dialog.replayView.attr("disabled",!0)}function c(){Da=new Ha(Va.URL),Da.onopen=function(){p()},Da.onmessage=_onMessage=function(e){x(JSON.parse(e.data))},Da.onclose=function(e){var a=L.closed+" (#"+e.code+")";Oa&&Oa.close(),ia(),alert(a),$.get("/kkutu_notice.html",function(e){p(e)})},Da.onerror=function(e){console.warn(L.error,e)}}for(Va.PUBLIC="true"==$("#PUBLIC").html(),Va.URL=$("#URL").html(),Va.version=$("#version").html(),Va.server=location.href.match(/\?.*server=(\d+)/)[1],Va.shop={},Va._okg=0,Va._playTime=0,Va._kd="",Va._timers=[],Va._obtain=[],Va._wblock={},Va._shut={},Va.usersR={},Ma.push($e(1)),f=2;360>f;f++)Ma.push(Ma[f-2]+$e(f));if(Ma[359]=1/0,Ma.push(1/0),La={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),chatLog:$("#chat-log-board"),talk:$("#Talk"),chatBtn:$("#ChatBtn"),menu:{help:$("#HelpBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),leaderboard:$("#LeaderboardBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),community:$("#CommunityDiag"),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},null==Ha)return p(L.websocketUnsupport),void alert(L.websocketUnsupport);for(Va._soundList=[{key:"k",value:"/media/kkutu/k.mp3"},{key:"lobby",value:"/media/kkutu/LobbyBGM.mp3"},{key:"jaqwi",value:"/media/kkutu/JaqwiBGM.mp3"},{key:"jaqwiF",value:"/media/kkutu/JaqwiFastBGM.mp3"},{key:"game_start",value:"/media/kkutu/game_start.mp3"},{key:"round_start",value:"/media/kkutu/round_start.mp3"},{key:"fail",value:"/media/kkutu/fail.mp3"},{key:"timeout",value:"/media/kkutu/timeout.mp3"},{key:"lvup",value:"/media/kkutu/lvup.mp3"},{key:"Al",value:"/media/kkutu/Al.mp3"},{key:"success",value:"/media/kkutu/success.mp3"},{key:"missing",value:"/media/kkutu/missing.mp3"},{key:"mission",value:"/media/kkutu/mission.mp3"},{key:"kung",value:"/media/kkutu/kung.mp3"},{key:"horr",value:"/media/kkutu/horr.mp3"}],f=0;10>=f;f++)Va._soundList.push({key:"T"+f,value:"/media/kkutu/T"+f+".mp3"},{key:"K"+f,value:"/media/kkutu/K"+f+".mp3"},{key:"As"+f,value:"/media/kkutu/As"+f+".mp3"});for(var f in ea(Va._soundList,function(){Me(c)}),delete Va._soundList,qa=$("#MOREMI_PART").html().split(","),Sa=$("#AVAIL_EQUIP").html().split(","),Ra=JSON.parse($("#RULE").html()),Aa=JSON.parse($("#OPTIONS").html()),ja=Object.keys(Ra),Pa="true"==$("#mobile").html(),Pa&&(Ga=200),Va._timePercent=function(){return 100-1e5*((Va._turnSound.audio?Va._turnSound.audio.currentTime:Wa.currentTime-Va._turnSound.startedAt)/Va.turnTime)+"%"},Va.setRoom=function(e,a){var t="for-lobby"==B();null==a?(delete Va.rooms[e],t&&$("#room-"+e).remove()):(t&&!Va.rooms[e]&&La.lobby.roomList.append($("<div>").attr("id","room-"+e)),Va.rooms[e]=a,t&&$("#room-"+e).replaceWith(U(a)))},Va.setUser=function(t,a){var s,l=B(),d="for-lobby"==l||"for-master"==l;return Va._replay?void(Ba.users[t]=a):void(null==a?(delete Va.users[t],d&&$("#users-item-"+t+",#invite-item-"+t).remove()):(d&&!Va.users[t]&&(s=N(a,"for-master"==l),"for-master"==l?La.dialog.inviteList.append(s):La.lobby.userList.append(s)),Va.users[t]=a,d&&(s?$("#"+s.attr("id")).replaceWith(s):$("#"+("for-lobby"==l?"users-item-":"invite-item")+t).replaceWith(N(a,"for-master"==l)))))},$(document).on("paste",function(e){if(Va.room&&Va.room.gaming)return e.preventDefault(),!1}),La.talk.on("drop",function(e){if(Va.room&&Va.room.gaming)return e.preventDefault(),!1}),Va.opts=$.cookie("kks"),Va.opts&&g(JSON.parse(Va.opts)),$(".dialog-head .dialog-title").on("mousedown",function(e){var a=$(e.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),a.addClass("dialog-front"),t(a,e.pageX,e.pageY)}).on("mouseup",function(){a()}),La.chatBtn.on("click",function(){h();var e=Pa&&La.game.here.is(":visible")?La.game.hereText.val():La.talk.val(),a={value:e};e&&("/"==a.value[0]?(a.cmd=a.value.split(" "),q(a.cmd)):((La.game.here.is(":visible")||Va._relay)&&(a.relay=!0),n("talk",a)),Va._whisper?(La.talk.val("/e "+Va._whisper+" "),delete Va._whisper):La.talk.val(""),La.game.hereText.val(""))}).hotkey(La.talk,13).hotkey(La.game.hereText,13),$("#cw-q-input").on("keydown",function(e){if(13==e.keyCode){var a=$(e.currentTarget),t=a.val(),s={relay:!0,data:Va._sel,value:t};if(!t)return;n("talk",s),a.val("")}}).on("focusout",function(){$(".cw-q-body").empty(),La.game.cwcmd.css("opacity",0)}),$("#room-limit").on("change",function(e){var a=$(e.currentTarget),t=a.val();2>t||8<t?a.css("color","#FF4444"):a.css("color","")}),$("#room-round").on("change",function(e){var a=$(e.currentTarget),t=a.val();1>t||10<t?a.css("color","#FF4444"):a.css("color","")}),La.game.here.on("click",function(){Pa||La.talk.focus()}),La.talk.on("keyup",function(){La.game.hereText.val(La.talk.val())}),$(window).on("beforeunload",function(){if(Va.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),La.dialog)La.dialog[f].children(".dialog-head").hasClass("no-close")||La.dialog[f].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(e){$(e.currentTarget).parent().parent().hide()}).hotkey(!1,27));for(La.menu.help.on("click",function(){$("#help-board").attr("src","/help"),u(La.dialog.help)}),La.menu.setting.on("click",function(){u(La.dialog.setting)}),La.menu.community.on("click",function(){return Va.guest?xa(451):void u(La.dialog.community)}),La.dialog.commFriendAdd.on("click",function(){var e=prompt(L.friendAddNotice);if(e)return Va.users[e]?void n("friendAdd",{target:e},!0):xa(450)}),La.menu.newRoom.on("click",function(){var e;La.dialog.quick.hide(),Va.typeRoom="enter",u(e=La.dialog.room),e.find(".dialog-title").html(L.newRoom)}),La.menu.setRoom.on("click",function(){var a,t,s,l=Ra[ja[Va.room.mode]];for(t in Va.typeRoom="setRoom",$("#room-title").val(Va.room.title),$("#room-limit").val(Va.room.limit),$("#room-mode").val(Va.room.mode).trigger("change"),$("#room-round").val(Va.room.round),$("#room-time").val(Va.room.time/l.time),Aa)s=Aa[t].name.toLowerCase(),$("#room-"+s).attr("checked",Va.room.opts[s]);Va._injpick=Va.room.opts.injpick,u(a=La.dialog.room),a.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(e){var a,t,m=$("#quick-mode").val(),n=0;for(a in"quick-mode"==e.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),t=l("quick"),s(Ra[ja[m]].opts,"quick"),Va.rooms)d(Va.rooms[a],m,t,!0)&&n++;$("#quick-status").html(L.quickStatus+" "+n)}),La.menu.quickRoom.on("click",function(){La.dialog.room.hide(),u(La.dialog.quick),La.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-queue").html(""),La.dialog.quickOK.removeClass("searching").html(L.OK))}),La.dialog.quickOK.on("click",function(){function e(){var e,l=[];if(!La.dialog.quick.is(":visible"))return void clearTimeout(Va._quickT);for(e in $("#quick-queue").html(L.quickQueue+" "+M(1e3*Va._quickn++)),Va.rooms)d(Va.rooms[e],t,s)&&l.push(e);l.length&&(e=l[Math.floor(Math.random()*l.length)],Va._preQuick=!0,$("#room-"+e).trigger("click"))}var t=$("#quick-mode").val(),s=l("quick");if("for-lobby"==B()){if(La.dialog.quickOK.hasClass("searching"))return La.dialog.quick.hide(),e(),void La.menu.quickRoom.trigger("click");$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),La.dialog.quickOK.addClass("searching").html("<i class='fa fa-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),Va._quickn=0,Va._quickT=k(e,1e3)}}),$("#room-mode").on("change",function(){var e=$("#room-mode").val(),t=Ra[ja[e]];$("#game-mode-expl").html(L["modex"+e]),s(t.opts,"room"),Va._injpick=[],-1==t.opts.indexOf("ijp")?$("#room-injpick-panel").hide():$("#room-injpick-panel").show(),"Typing"==t.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(e,a){$(a).html(+$(a).val()*t.time+L.SECOND)})}).trigger("change"),La.menu.spectate.on("click",function(){La.menu.spectate.hasClass("toggled")?(n("form",{mode:"J"}),La.menu.spectate.removeClass("toggled")):(n("form",{mode:"S"}),La.menu.spectate.addClass("toggled"))}),La.menu.shop.on("click",function(){(Va._shop=!Va._shop)?(Ee(),La.menu.shop.addClass("toggled")):La.menu.shop.removeClass("toggled"),P()}),$(".shop-type").on("click",function(e){var a=$(e.currentTarget),t=a.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),a.addClass("selected"),Fe("all"==t||a.attr("value"))}),La.menu.dict.on("click",function(){u(La.dialog.dict)}),La.menu.wordPlus.on("click",function(){u(La.dialog.wordPlus)}),La.menu.invite.on("click",function(){u(La.dialog.invite),K(!0)}),La.menu.practice.on("click",function(){Ra[ja[Va.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),u(La.dialog.practice)):n("practice",{level:-1})}),La.menu.ready.on("click",function(){n("ready")}),La.menu.start.on("click",function(){n("start")}),La.menu.exit.on("click",function(){if(Va.room.gaming){if(!confirm(L.sureExit))return;pe()}n("leave")}),La.menu.replay.on("click",function(){Va._replay&&ye(),u(La.dialog.replay),m(),La.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),La.menu.leaderboard.on("click",function(){Va._lbpage=0,La.dialog.leaderboard.is(":visible")?La.dialog.leaderboard.hide():$.get("/ranking",function(e){ie(e),u(La.dialog.leaderboard)})}),La.dialog.lbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(Va._lbpage-1),function(e){ie(e)})}),La.dialog.lbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?id="+Va.id,function(e){ie(e)})}),La.dialog.lbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(Va._lbpage+1),function(e){ie(e)})}),La.dialog.settingServer.on("click",function(){location.href="/"}),La.dialog.settingOK.on("click",function(){g({mb:$("#mute-bgm").is(":checked"),me:$("#mute-effect").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),$.cookie("kks",JSON.stringify(Va.opts)),La.dialog.setting.hide()}),La.dialog.profileLevel.on("click",function(){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),u(La.dialog.practice)}),La.dialog.practiceOK.on("click",function(){var e=$("#practice-level").val(),a=$("#ai-team").val();La.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?n("setAI",{target:Va._profiled,level:e,team:a}):n("practice",{level:e})}),La.dialog.roomOK.on("click",function(){var e,a,t={injpick:Va._injpick};for(e in Aa)a=Aa[e].name.toLowerCase(),t[a]=$("#room-"+a).is(":checked");n(Va.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),time:$("#room-time").val(),opts:t}),La.dialog.room.hide()}),La.dialog.resultOK.on("click",function(){return 1==Va._resultPage&&Va._resultRank?void Le(Va._resultRank[Va.id]):void(Va.practicing&&(Va.room.gaming=!0,n("leave")),Va.resulting=!1,La.dialog.result.hide(),delete Va._replay,delete Va._resultRank,La.box.room.height(360),oa("lobby"),la(),P())}),La.dialog.resultSave.on("click",function(){var a=new Date(Ba.time),t=new Blob([JSON.stringify(Ba)],{type:"text/plain"}),s=URL.createObjectURL(t),d="KKuTu"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+"-"+a.getMinutes()+"-"+a.getSeconds()+".kkt",e=$("<a>").attr({download:d,href:s}).on("click",function(){e.remove()});$("#Jungle").append(e),e[0].click()}),La.dialog.dictInjeong.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||$("#dict-theme").val()&&(a.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(e){return(_(function(){a.prop("disabled",!1)},2e3),e.error)?$("#dict-output").html(e.error+": "+L["wpFail_"+e.error]):void $("#dict-output").html(L.wpSuccess+"("+e.message+")")}))}),La.dialog.dictSearch.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||(a.prop("disabled",!0),$("#dict-output").html(L.searching),D($("#dict-input").val(),function(e){return(_(function(){a.prop("disabled",!1)},500),e.error)?$("#dict-output").html(e.error+": "+L["wpFail_"+e.error]):void $("#dict-output").html(He(e.word,e.mean,e.theme,e.type.split(",")))}))}).hotkey($("#dict-input"),13),La.dialog.wordPlusOK.on("click",function(e){var a;La.dialog.wordPlusOK.hasClass("searching")||(a=$("#wp-input").val())&&(a=a.replace(/[^a-z가-힣]/g,""),2>a.length||($("#wp-input").val(""),$(e.currentTarget).addClass("searching").html("<i class='fa fa-spin fa-spinner'></i>"),n("wp",{value:a})))}).hotkey($("#wp-input"),13),La.dialog.inviteRobot.on("click",function(){me("AI")}),La.box.me.on("click",function(){le(Va.id)}),La.dialog.roomInfoJoin.on("click",function(){La.dialog.roomInfo.hide(),sa(Va._roominfo)}),La.dialog.profileHandover.on("click",function(){confirm(L.sureHandover)&&n("handover",{target:Va._profiled})}),La.dialog.profileKick.on("click",function(){n("kick",{robot:Va.robots.hasOwnProperty(Va._profiled),target:Va._profiled})}),La.dialog.profileShut.on("click",function(){var e=Va.users[Va._profiled];e&&A(e.profile.title||e.profile.name)}),La.dialog.profileWhisper.on("click",function(){var e=Va.users[Va._profiled];La.talk.val("/e "+(e.profile.title||e.profile.name).replace(/\s/g,"")+" ").focus()}),La.dialog.profileDress.on("click",function(){return Va.guest?xa(421):Va._gaming?xa(438):void(u(La.dialog.dress)&&$.get("/box",function(e){return e.error?xa(e.error):void(Va.box=e,ee())}))}),La.dialog.dressOK.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.post("/exordial",{data:$("#dress-exordial").val()},function(e){return(La.dialog.dressOK.attr("disabled",!1),e.error)?xa(e.error):void La.dialog.dress.hide()})}),$("#DressDiag .dress-type").on("click",function(e){var a=$(e.currentTarget),t=a.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),a.addClass("selected"),oe("all"==t||a.attr("value"))}),$("#dress-cf").on("click",function(){return Va._gaming?xa(438):void(u(La.dialog.charFactory)&&te())}),La.dialog.cfCompose.on("click",function(){return La.dialog.cfCompose.hasClass("cf-composable")?void(confirm(L.cfSureCompose)&&$.post("/cf",{tray:Va._tray.join("|")},function(e){if(e.error)return xa(e.error);for(var a in n("refresh"),alert(L.cfComposed),Va.users[Va.id].money=e.money,Va.box=e.box,e.gain)_a(e.gain[a]);ee(Va._avGroup),G(),te()})):xa(436)}),$("#room-injeong-pick").on("click",function(){var e,a=Ra[ja[$("#room-mode").val()]];for(e in $("#injpick-list>div").hide(),"ko"==a.lang?(Va._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==a.lang&&(Va._ijkey="#en-pick-",$("#en-pick-list").show()),La.dialog.injPickNo.trigger("click"),Va._injpick)$(Va._ijkey+Va._injpick[e]).prop("checked",!0);u(La.dialog.injPick)}),La.dialog.injPickAll.on("click",function(){$("#injpick-list input").prop("checked",!0)}),La.dialog.injPickNo.on("click",function(){$("#injpick-list input").prop("checked",!1)}),La.dialog.injPickOK.on("click",function(){var e=$(Va._ijkey+"list"),t=[];Va._injpick=e.find("input").each(function(s,a){var l=$(a),d=l.attr("id").slice(8);l.is(":checked")&&t.push(d)}),Va._injpick=t,La.dialog.injPick.hide()}),La.dialog.kickVoteY.on("click",function(){n("kickVote",{agree:!0}),clearTimeout(Va._kickTimer),La.dialog.kickVote.hide()}),La.dialog.kickVoteN.on("click",function(){n("kickVote",{agree:!1}),clearTimeout(Va._kickTimer),La.dialog.kickVote.hide()}),La.dialog.purchaseOK.on("click",function(){$.post("/buy/"+Va._sgood,function(e){var a=Va.users[Va.id];return e.error?xa(e.error):void(alert(L.purchased),a.money=e.money,a.box=e.box,G())}),La.dialog.purchase.hide()}),La.dialog.purchaseNO.on("click",function(){La.dialog.purchase.hide()}),La.dialog.obtainOK.on("click",function(){var e=Va._obtain.shift();e?ya(e):La.dialog.obtain.hide()}),f=0;5>f;f++)$("#team-"+f).on("click",e);$("#replay-file").on("change",function(t){var a=t.target.files[0],s=new FileReader,l=$("#replay-date").html("-"),d=$("#replay-version").html("-"),e=$("#replay-players").html("-");Ba=!1,La.dialog.replayView.attr("disabled",!0),a&&(s.readAsText(a),s.onload=function(t){var a,s;try{for(a in s=JSON.parse(t.target.result),l.html(new Date(s.time).toLocaleString()),d.html(s.version),e.empty(),s.players){var m,n=s.players[a];e.append(m=$("<div>").addClass("replay-player-bar ellipse").html(n.title).prepend(Ye(n.data.score).addClass("users-level"))),n.id==s.me&&m.css("font-weight","bold")}Ba=s,La.dialog.replayView.attr("disabled",!1)}catch(e){return console.warn(e),alert(L.replayError)}})}),La.dialog.replayView.on("click",function(){ge()}),k(function(){0<Ya?Ya=0:0<Qa&&(Qa-=.03)},1e3)}),Ua.Classic.roundReady=function(e){Va.room.game.title.length,xe(),Va._roundTime=1e3*Va.room.time,La.game.display.html(Je(e.char,e.subChar)),La.game.chain.show().html(Va.chain=0),Va.room.opts.mission&&La.game.items.show().css("opacity",1).html(Va.mission=e.mission),"KAP"==ja[Va.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),Te(e.round),ta("round_start"),we("roundReady",{data:e})},Ua.Classic.turnStart=function(e){Va.room.game.turn=e.turn,e.seq&&(Va.room.game.seq=e.seq),(Va._tid=Va.room.game.seq[e.turn])&&(Va._tid.robot&&(Va._tid=Va._tid.id),e.id=Va._tid,La.game.display.html(Va._char=Je(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),Va._replay||(La.game.here.css("display",e.id==Va.id?"block":"none"),e.id==Va.id&&(Pa?La.game.hereText.val("").focus():La.talk.focus())),La.game.items.html(Va.mission=e.mission),Da.onmessage=_onMessage,clearInterval(Va._tTime),y(),Va._chars=[e.char,e.subChar],Va._speed=e.speed,Va._tTime=k(je,Ga),Va.turnTime=e.turnTime,Va._turnTime=e.turnTime,Va._roundTime=e.roundTime,Va._turnSound=ta("T"+e.speed),we("turnStart",{data:e}))},Ua.Classic.turnGoing=function(){Va.room||clearInterval(Va._tTime),Va._turnTime-=Ga,Va._roundTime-=Ga,La.game.turnBar.width(Va._timePercent()).html((.001*Va._turnTime).toFixed(1)+L.SECOND),La.game.roundBar.width(.1*(Va._roundTime/Va.room.time)+"%").html((.001*Va._roundTime).toFixed(1)+L.SECOND),La.game.roundBar.hasClass("round-extreme")||5e3>=Va._roundTime&&La.game.roundBar.addClass("round-extreme")},Ua.Classic.turnEnd=function(t,s){var a,l=$("<div>").addClass("deltaScore").html(0<s.score?"+"+(s.score-s.bonus):s.score),e=$(".game-user-current");Va._turnSound&&Va._turnSound.stop(),Re(t,s.score),clearInterval(Va._tTime),s.ok?(ne(),clearTimeout(Va._fail),La.game.here.hide(),La.game.chain.html(++Va.chain),Ie(s.value,s.mean,s.theme,s.wc)):(ne(t),l.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),La.game.here.hide(),ta("timeout")),s.hint&&(s.hint=s.hint._id,a=s.hint.indexOf(Va._chars[0]),-1==a&&(a=s.hint.indexOf(Va._chars[1])),"KAP"==ja[Va.room.mode]?La.game.display.empty().append($("<label>").css("color","#AAAAAA").html(s.hint.slice(0,a))).append($("<label>").html(s.hint.slice(a))):La.game.display.empty().append($("<label>").html(s.hint.slice(0,a+1))).append($("<label>").css("color","#AAAAAA").html(s.hint.slice(a+1)))),s.bonus&&(Pa?l.html("+"+(b.score-b.bonus)+"+"+b.bonus):_(function(){var t=$("<div>").addClass("deltaScore bonus").html("+"+s.bonus);Ae(e,t)},500)),Ae(e,l).removeClass("game-user-current"),z(t,Se(t))},Ua.Jaqwi.roundReady=function(e){var a=L.jqTheme+": "+L["theme_"+e.theme];xe(),Va._roundTime=1e3*Va.room.time,Va._fastTime=1e4,La.game.display.html(a),La.game.items.hide(),La.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(a).css("text-align","center"),Te(e.round),ta("round_start"),clearInterval(Va._tTime)},Ua.Jaqwi.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),0<=Va.room.game.seq.indexOf(Va.id)&&La.game.here.show(),La.game.display.html(Va._char=e.char),clearInterval(Va._tTime),Va._tTime=k(je,Ga),oa("jaqwi")},Ua.Jaqwi.turnGoing=function(){var e,t,s=La.game.roundBar;Va.room||clearInterval(Va._tTime),Va._roundTime-=Ga,t=Va._spectate?L.stat_spectate:(.001*Va._roundTime).toFixed(1)+L.SECOND,s.width(.1*(Va._roundTime/Va.room.time)+"%").html(t),s.hasClass("round-extreme")||Va._roundTime<=Va._fastTime&&(e=Va.bgm.currentTime/Va.bgm.duration,Va.bgm.paused?ra():oa("jaqwiF"),Va.bgm.currentTime=Va.bgm.duration*e,s.addClass("round-extreme"))},Ua.Jaqwi.turnHint=function(e){ta("mission"),Ve(e.hint)},Ua.Jaqwi.turnEnd=function(e,a){var t=$("<div>").addClass("deltaScore").html("+"+a.score),s=$("#game-user-"+e);a.giveup?s.addClass("game-user-bomb"):a.answer?(La.game.here.hide(),La.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),ra(),ta("horr")):(e==Va.id&&La.game.here.hide(),Re(e,a.score),1e4<Va._roundTime&&(Va._roundTime=1e4),Ae(s,t),z(e,Se(e)).addClass("game-user-current"),ta("success"))},Ua.Crossword.roundReady=function(e,a){var t=e.seq?e.seq.indexOf(Va.id):-1;xe(),$(".jjoriping,.rounds,.game-body").addClass("cw"),Va._roundTime=1e3*Va.room.time,Va._fastTime=3e4,Va.selectedRound=-1==t?1:t%Va.room.round+1,La.game.items.hide(),La.game.cwcmd.show().css("opacity",0),Te(Va.selectedRound),a||ta("round_start"),clearInterval(Va._tTime)},Ua.Crossword.turnEnd=function(t,a){var s,l,m=$("<div>").addClass("deltaScore").html("+"+a.score),e=$("#game-user-"+t);a.score?(l=a.pos.join(","),t==Va.id?(La.game.cwcmd.css("opacity",0),ta("success")):(Va._sel&&a.pos.join(",")==Va._sel.join(",")&&La.game.cwcmd.css("opacity",0),ta("mission")),Va._bdb[l][4]=a.value,Va._bdb[l][5]=t,a.pos[0]==Va.selectedRound-1?Ua.Crossword.drawDisplay():(s=$(La.game.round.children("label").get(a.pos[0])).addClass("round-effect"),_(function(){s.removeClass("round-effect")},800)),Re(t,a.score),z(t,Se(t)),Ae(e,m)):(ra(),La.game.round.empty(),ta("horr"))},Ua.Crossword.drawDisplay=function(){var t,s,m,n,p,u,_,y,v,C=Va._boards[Va.selectedRound-1],w=La.game.display.empty(),k={};for(s in C)for(n=+C[s][0],p=+C[s][1],u="1"==C[s][2],_=+C[s][3],y=C[s][4],w.append(t=$("<div>").addClass("cw-bar").attr("id","cw-"+n+"-"+p+"-"+C[s][2]).css({top:12.5*p+"%",left:12.5*n+"%",width:12.5*(u?1:_)+"%",height:12.5*(u?_:1)+"%"})),y&&t.addClass("cw-open"),C[s][5]==Va.id?t.addClass("cw-my-open"):t.on("click",Ua.Crossword.onBar).on("mouseleave",Ua.Crossword.onSwap),m=0;m<_;m++)v=n+"-"+p,y&&(k[v]=y.charAt(m)),t.append($("<div>").addClass("cw-cell").attr("id","cwc-"+v).html(k[v]||"")),u?p++:n++},Ua.Crossword.onSwap=function(e){La.game.display.prepend($(e.currentTarget))},Ua.Crossword.onRound=function(e){var a=$(e.currentTarget).html().charCodeAt(0)-9311;Te(Va.selectedRound=a),$(".rounds label").on("click",Ua.Crossword.onRound),Ua.Crossword.drawDisplay()},Ua.Crossword.onBar=function(t){var a=$(t.currentTarget),s=a.attr("id").slice(3).split("-"),l=Va._means[Va.selectedRound-1][s.join(",")],d="1"==l.dir;La.game.cwcmd.css("opacity",1),Va._sel=[Va.selectedRound-1,s[0],s[1],s[2]],$(".cw-q-head").html(L[d?"cwVert":"cwHorz"]+l.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(He("\u2605",l.mean,l.theme,l.type.split(",")))},Ua.Crossword.turnStart=function(e){var a,t;for(a in Va._bdb={},Va._boards=e.boards,Va._means=e.means,e.boards)for(t in e.boards[a])Va._bdb[[a,e.boards[a][t][0],e.boards[a][t][1],e.boards[a][t][2]].join(",")]=e.boards[a][t];$(".rounds label").on("click",Ua.Crossword.onRound),Ua.Crossword.drawDisplay(),clearInterval(Va._tTime),Va._tTime=k(je,Ga),oa("jaqwi")},Ua.Crossword.turnGoing=Ua.Jaqwi.turnGoing,Ua.Crossword.turnHint=function(){ta("fail")},Ua.Typing.roundReady=function(e){Va.room.game.title.length,Va._chatter=Pa?La.game.hereText:La.talk,xe(),Va._round=e.round,Va._roundTime=1e3*Va.room.time,Va._fastTime=1e4,Va._list=e.list.concat(e.list),Va.chain=0,t(),Te(e.round),ta("round_start"),we("roundReady",{data:e})},Ua.Typing.spaceOn=function(){Va.room.opts.proverb||(Va._spaced=!0,$("body").on("keydown","#"+Va._chatter.attr("id"),e))},Ua.Typing.spaceOff=function(){delete Va._spaced,$("body").off("keydown","#"+Va._chatter.attr("id"),e)},Ua.Typing.turnStart=function(e){Va._spectate||(La.game.here.show(),Pa?La.game.hereText.val("").focus():La.talk.val("").focus(),Ua.Typing.spaceOn()),Da.onmessage=_onMessage,clearInterval(Va._tTime),y(),Va._tTime=k(je,Ga),Va._roundTime=e.roundTime,oa("jaqwi"),we("turnStart",{data:e})},Ua.Typing.turnGoing=Ua.Jaqwi.turnGoing,Ua.Typing.turnEnd=function(e,a){var m=$("<div>").addClass("deltaScore").html("+"+a.score),n=$("#game-user-"+e);a.error?(Va.chain++,t(),ta("fail")):a.ok?(Va.id==e?(Va.chain++,t(),ta("mission"),Ue(a.value,"")):Va._spectate&&ta("mission"),Re(e,a.score),Ae(n,m),z(e,Se(e))):(clearInterval(Va._tTime),Ua.Typing.spaceOff(),La.game.here.hide(),ra(),ta("horr"),_(l,1e3,a.speed),Va._round<Va.room.round&&s(10))},Ua.Hunmin.roundReady=function(e){Va.room.game.title.length,xe(),Va._roundTime=1e3*Va.room.time,La.game.display.html(Va._char="&lt;"+e.theme+"&gt;"),La.game.chain.show().html(Va.chain=0),Va.room.opts.mission&&La.game.items.show().css("opacity",1).html(Va.mission=e.mission),Te(e.round),ta("round_start"),we("roundReady",{data:e})},Ua.Hunmin.turnStart=function(e){Va.room.game.turn=e.turn,e.seq&&(Va.room.game.seq=e.seq),Va._tid=Va.room.game.seq[e.turn],Va._tid.robot&&(Va._tid=Va._tid.id),e.id=Va._tid,La.game.display.html(Va._char),$("#game-user-"+e.id).addClass("game-user-current"),Va._replay||(La.game.here.css("display",e.id==Va.id?"block":"none"),e.id==Va.id&&(Pa?La.game.hereText.val("").focus():La.talk.focus())),La.game.items.html(Va.mission=e.mission),Da.onmessage=_onMessage,clearInterval(Va._tTime),y(),Va._chars=[e.char,e.subChar],Va._speed=e.speed,Va._tTime=k(je,Ga),Va.turnTime=e.turnTime,Va._turnTime=e.turnTime,Va._roundTime=e.roundTime,Va._turnSound=ta("T"+e.speed),we("turnStart",{data:e})},Ua.Hunmin.turnGoing=Ua.Classic.turnGoing,Ua.Hunmin.turnEnd=function(t,s){var a,l=$("<div>").addClass("deltaScore").html(0<s.score?"+"+(s.score-s.bonus):s.score),e=$(".game-user-current");Va._turnSound.stop(),Re(t,s.score),clearInterval(Va._tTime),s.ok?(clearTimeout(Va._fail),La.game.here.hide(),La.game.chain.html(++Va.chain),Ie(s.value,s.mean,s.theme,s.wc)):(l.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),La.game.here.hide(),ta("timeout")),s.hint&&(s.hint=s.hint._id,a=s.hint.indexOf(Va._chars[0]),-1==a&&(a=s.hint.indexOf(Va._chars[1])),La.game.display.empty().append($("<label>").html(s.hint.slice(0,a+1))).append($("<label>").css("color","#AAAAAA").html(s.hint.slice(a+1)))),s.bonus&&(Pa?l.html("+"+(b.score-b.bonus)+"+"+b.bonus):_(function(){var t=$("<div>").addClass("deltaScore bonus").html("+"+s.bonus);Ae(e,t)},500)),Ae(e,l).removeClass("game-user-current"),z(t,Se(t))},Ua.Daneo.roundReady=function(e){Va.room.game.title.length,xe(),Va._roundTime=1e3*Va.room.time,La.game.display.html(Va._char="&lt;"+L["theme_"+e.theme]+"&gt;"),La.game.chain.show().html(Va.chain=0),Va.room.opts.mission&&La.game.items.show().css("opacity",1).html(Va.mission=e.mission),Te(e.round),ta("round_start"),we("roundReady",{data:e})},Ua.Daneo.turnStart=function(e){Va.room.game.turn=e.turn,e.seq&&(Va.room.game.seq=e.seq),Va._tid=Va.room.game.seq[e.turn],Va._tid.robot&&(Va._tid=Va._tid.id),e.id=Va._tid,La.game.display.html(Va._char),$("#game-user-"+e.id).addClass("game-user-current"),Va._replay||(La.game.here.css("display",e.id==Va.id?"block":"none"),e.id==Va.id&&(Pa?La.game.hereText.val("").focus():La.talk.focus())),La.game.items.html(Va.mission=e.mission),Da.onmessage=_onMessage,clearInterval(Va._tTime),y(),Va._chars=[e.char,e.subChar],Va._speed=e.speed,Va._tTime=k(je,Ga),Va.turnTime=e.turnTime,Va._turnTime=e.turnTime,Va._roundTime=e.roundTime,Va._turnSound=ta("T"+e.speed),we("turnStart",{data:e})},Ua.Daneo.turnGoing=Ua.Classic.turnGoing,Ua.Daneo.turnEnd=function(t,s){var a,l=$("<div>").addClass("deltaScore").html(0<s.score?"+"+(s.score-s.bonus):s.score),e=$(".game-user-current");Va._turnSound.stop(),Re(t,s.score),clearInterval(Va._tTime),s.ok?(clearTimeout(Va._fail),La.game.here.hide(),La.game.chain.html(++Va.chain),Ie(s.value,s.mean,s.theme,s.wc)):(l.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),La.game.here.hide(),ta("timeout")),s.hint&&(s.hint=s.hint._id,a=s.hint.indexOf(Va._chars[0]),-1==a&&(a=s.hint.indexOf(Va._chars[1])),La.game.display.empty().append($("<label>").html(s.hint.slice(0,a+1))).append($("<label>").css("color","#AAAAAA").html(s.hint.slice(a+1)))),s.bonus&&(Pa?l.html("+"+(b.score-b.bonus)+"+"+b.bonus):_(function(){var t=$("<div>").addClass("deltaScore bonus").html("+"+s.bonus);Ae(e,t)},500)),Ae(e,l).removeClass("game-user-current"),z(t,Se(t))},Ua.Sock.roundReady=function(e,a){e.seq&&e.seq.indexOf(Va.id),xe(),Va._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),Va._va=[],Va._lang=Ra[ja[Va.room.mode]].lang,Va._board=e.board,Va._maps=[],Va._roundTime=1e3*Va.room.time,Va._fastTime=1e4,La.game.items.hide(),La.game.bb.show(),Ua.Sock.drawDisplay(),Te(e.round),a||ta("round_start"),clearInterval(Va._tTime)},Ua.Sock.turnEnd=function(t,a){var s,l,m,n=$("<div>").addClass("deltaScore").html("+"+a.score),p=$("#game-user-"+t);if(a.score){for(s=a.value,m=s.length,Va._maps.push(s),l=0;l<m;l++)Va._board=Va._board.replace(s.charAt(l),"\u3000");ta(t==Va.id?"success":"mission"),Ua.Sock.drawDisplay(),Re(t,a.score),z(t,Se(t)),Ae(p,n)}else ra(),Va._relay=!1,ta("horr")},Ua.Sock.drawMaps=function(){function e(e){var a,t=$("<div>").addClass("bb-word"),s=e.length;for(a=0;a<s;a++)t.append($("<div>").addClass("bb-char").html(e.charAt(a)));return t}La.game.bb.empty(),Va._maps.sort(function(e,a){return a.length-e.length}).forEach(function(a){La.game.bb.append(e(a))})},Ua.Sock.drawDisplay=function(){var t,s=$("<div>").css("height","100%"),e=Va._board.split(""),l="ko"==Va._lang?"12.5%":"10%";e.forEach(function(a,d){s.append(t=$("<div>").addClass("sock-char sock-"+a).css({width:l,height:l}).html(a)),Va._va[d]&&Va._va[d]!=a&&t.html(Va._va[d]).addClass("sock-picked").animate({opacity:0},500)}),Va._va=e,La.game.display.empty().append(s),Ua.Sock.drawMaps()},Ua.Sock.turnStart=function(){clearInterval(Va._tTime),Va._tTime=k(je,Ga),oa("jaqwi")},Ua.Sock.turnGoing=Ua.Jaqwi.turnGoing,Ua.Sock.turnHint=function(){ta("fail")};var Qa=0,Ya=0;$(document).ready(function(){$(document).bind("keydown",function(a){123==a.keyCode&&(a.preventDefault(),a.returnValue=!1)})}),$(document).ready(function(){$(document).on("contextmenu dragstart selectstart",function(){return!1})}),delete window.WebSocket,delete window.setInterval})();